THREE.MD2Character=function(){function e(e,t){var r=new THREE.UVMapping;var n=[];for(var o=0;o<t.length;o++){n[o]=THREE.ImageUtils.loadTexture(e+t[o],r,i);n[o].name=t[o]}return n}function t(e,t){e.computeMorphNormals();var i=THREE.ImageUtils.generateDataTexture(1,1,new THREE.Color(16777215));var n=new THREE.MeshPhongMaterial({color:16755200,specular:1118481,shininess:50,wireframe:!0,shading:THREE.SmoothShading,map:i,morphTargets:!0,morphNormals:!0,metal:!1});var o=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:50,wireframe:!1,shading:THREE.SmoothShading,map:t,morphTargets:!0,morphNormals:!0,metal:!1});o.wrapAround=!0;var a=new THREE.MorphAnimMesh(e,o);a.rotation.y=-Math.PI/2;a.castShadow=!0;a.receiveShadow=!0;a.materialTexture=o;a.materialWireframe=n;a.parseAnimations();a.playAnimation(e.firstAnimation,r.animationFPS);a.baseDuration=a.duration;return a}function i(){r.loadCounter-=1;if(0===r.loadCounter)r.onLoadComplete()}var r=this;this.scale=1;this.animationFPS=6;this.root=new THREE.Object3D;this.meshBody=null;this.meshWeapon=null;this.skinsBody=[];this.skinsWeapon=[];this.weapons=[];this.activeAnimation=null;this.onLoadComplete=function(){};this.loadCounter=0;this.loadParts=function(n){this.loadCounter=2*n.weapons.length+n.skins.length+1;var o=[];for(var a=0;a<n.weapons.length;a++)o[a]=n.weapons[a][1];this.skinsBody=e(n.baseUrl+"skins/",n.skins);this.skinsWeapon=e(n.baseUrl+"skins/",o);var s=new THREE.JSONLoader;s.load(n.baseUrl+n.body,function(e){e.computeBoundingBox();r.root.position.y=-r.scale*e.boundingBox.min.y;var n=t(e,r.skinsBody[0]);n.scale.set(r.scale,r.scale,r.scale);r.root.add(n);r.meshBody=n;r.activeAnimation=e.firstAnimation;i()});var l=function(e,n){return function(o){var a=t(o,r.skinsWeapon[e]);a.scale.set(r.scale,r.scale,r.scale);a.visible=!1;a.name=n;r.root.add(a);r.weapons[e]=a;r.meshWeapon=a;i()}};for(var a=0;a<n.weapons.length;a++)s.load(n.baseUrl+n.weapons[a][0],l(a,n.weapons[a][0]))};this.setPlaybackRate=function(e){if(this.meshBody)this.meshBody.duration=this.meshBody.baseDuration/e;if(this.meshWeapon)this.meshWeapon.duration=this.meshWeapon.baseDuration/e};this.setWireframe=function(e){if(e){if(this.meshBody)this.meshBody.material=this.meshBody.materialWireframe;if(this.meshWeapon)this.meshWeapon.material=this.meshWeapon.materialWireframe}else{if(this.meshBody)this.meshBody.material=this.meshBody.materialTexture;if(this.meshWeapon)this.meshWeapon.material=this.meshWeapon.materialTexture}};this.setSkin=function(e){if(this.meshBody&&this.meshBody.material.wireframe===!1)this.meshBody.material.map=this.skinsBody[e]};this.setWeapon=function(e){for(var t=0;t<this.weapons.length;t++)this.weapons[t].visible=!1;var i=this.weapons[e];if(i){i.visible=!0;this.meshWeapon=i;i.playAnimation(this.activeAnimation,this.animationFPS);this.meshWeapon.baseDuration=this.meshWeapon.duration;this.meshWeapon.time=this.meshBody.time;this.meshWeapon.duration=this.meshBody.duration}};this.setAnimation=function(e){if(this.meshBody){this.meshBody.playAnimation(e,this.animationFPS);this.meshBody.baseDuration=this.meshBody.duration}if(this.meshWeapon){this.meshWeapon.playAnimation(e,this.animationFPS);this.meshWeapon.baseDuration=this.meshWeapon.duration;this.meshWeapon.time=this.meshBody.time}this.activeAnimation=e};this.update=function(e){if(this.meshBody)this.meshBody.updateAnimation(1e3*e);if(this.meshWeapon)this.meshWeapon.updateAnimation(1e3*e)}};