THREE.SoftwareRenderer=function(){function e(e){var t=e.id;var i=a[t];if(void 0===a[t]){if(e instanceof THREE.MeshBasicMaterial||e instanceof THREE.MeshLambertMaterial||e instanceof THREE.MeshPhongMaterial){var r;if(e.vertexColors===THREE.FaceColors)r=["buffer[ offset ] = face.color.r * 255;","buffer[ offset + 1 ] = face.color.g * 255;","buffer[ offset + 2 ] = face.color.b * 255;","buffer[ offset + 3 ] = material.opacity * 255;"].join("\n");else r=["buffer[ offset ] = material.color.r * 255;","buffer[ offset + 1 ] = material.color.g * 255;","buffer[ offset + 2 ] = material.color.b * 255;","buffer[ offset + 3 ] = material.opacity * 255;"].join("\n");i=new Function("buffer, offset, u, v, face, material",r)}else{var r=["buffer[ offset ] = u * 255;","buffer[ offset + 1 ] = v * 255;","buffer[ offset + 2 ] = 0;","buffer[ offset + 3 ] = 255;"].join("\n");i=new Function("buffer, offset, u, v",r)}a[t]=i}return i}function t(e,t,r,n,o,a){if(!(e.z<-1||e.z>1||t.z<-1||t.z>1||r.z<-1||r.z>1)){var c=0|e.x*u+p;var g=0|t.x*u+p;var T=0|r.x*u+p;var C=0|e.y*f+m;var k=0|t.y*f+m;var N=0|r.y*f+m;var O=0|e.z*d+v;var I=0|t.z*d+v;var F=0|r.z*d+v;var z=c-g,V=k-C;var B=g-T,U=N-k;var j=T-c,W=C-N;var G=Math.max(Math.min(c,g,T)+H>>w,0);var X=Math.min(Math.max(c,g,T)+H>>w,s);var Y=Math.max(Math.min(C,k,N)+H>>w,0);var q=Math.min(Math.max(C,k,N)+H>>w,l);A=Math.min(G,A);P=Math.max(X,P);D=Math.min(Y,D);L=Math.max(q,L);var K=M;G&=~(K-1);Y&=~(K-1);var Z=V*((G<<w)-c)+z*((Y<<w)-C);var Q=U*((G<<w)-g)+B*((Y<<w)-k);var $=W*((G<<w)-T)+j*((Y<<w)-N);if(V>0||0==V&&z>0)Z++;if(U>0||0==U&&B>0)Q++;if(W>0||0==W&&j>0)$++;Z=Z-1>>w;Q=Q-1>>w;$=$-1>>w;var J=O-I,et=F-O;var tt=1/(z*W-j*V);var it=tt*(J*W-et*V);var rt=tt*(J*j-z*et);var nt=0|O+((G<<w)-c)*it+((Y<<w)-C)*rt;var ot=1<<w;it=0|it*ot;rt=0|rt*ot;var at=K-1;var st=0,lt=0;var ht=0,ct=0;var ut=0,ft=0;var dt=0,pt=0;if(z>=0)lt-=at*z;else st-=at*z;if(V>=0)lt-=at*V;else st-=at*V;if(B>=0)ct-=at*B;else ht-=at*B;if(U>=0)ct-=at*U;else ht-=at*U;if(j>=0)ft-=at*j;else ut-=at*j;if(W>=0)ft-=at*W;else ut-=at*W;if(it>=0)pt+=at*it;else dt+=at*it;if(rt>=0)pt+=at*rt;else dt+=at*rt;var mt=s-K;var vt=1/(Z+Q+$);var gt=Z;var Et=Q;var yt=$;var Tt=nt;var _t=-K;var bt=_t*V;var xt=_t*U;var Rt=_t*W;var wt=_t*it;var Ht=G;for(var St=Y;q>St;St+=K){for(;Ht>=G&&X>Ht&&gt>=lt&&Et>=ct&&yt>=ft;){Ht+=_t;gt+=bt;Et+=xt;yt+=Rt;Tt+=wt}_t=-_t;bt=-bt;xt=-xt;Rt=-Rt;wt=-wt;for(;;){Ht+=_t;gt+=bt;Et+=xt;yt+=Rt;Tt+=wt;if(G>Ht||Ht>=X)break;if(!(lt>gt))if(!(ct>Et))if(!(ft>yt)){var Mt=Ht>>S;var Ct=St>>S;var At=Mt+Ct*h;var Dt=Tt+dt;if(!(_[At]<Dt)){var Pt=b[At];if(Pt&R)i(Mt,Ct);b[At]=Pt&~(x|R);var Lt=Ht+St*s;if(gt>=st&&Et>=ht&&yt>=ut){var kt=Tt+pt;_[At]=Math.min(_[At],kt);var Nt=gt;var Ot=Et;var It=Tt;for(var Ft=0;K>Ft;Ft++){var zt=Nt;var Vt=Ot;var Bt=It;for(var Ut=0;K>Ut;Ut++){var jt=Bt;if(jt<y[Lt]){y[Lt]=jt;var Wt=zt*vt;var Gt=Vt*vt;n(E,4*Lt,Wt,Gt,o,a)}zt+=V;Vt+=U;Bt+=it;Lt++}Nt+=z;Ot+=B;It+=rt;Lt+=mt}}else{var Nt=gt;var Ot=Et;var Xt=yt;var It=Tt;for(var Ft=0;K>Ft;Ft++){var zt=Nt;var Vt=Ot;var Yt=Xt;var Bt=It;for(var Ut=0;K>Ut;Ut++){if((zt|Vt|Yt)>=0){var jt=Bt;if(jt<y[Lt]){var Wt=zt*vt;var Gt=Vt*vt;y[Lt]=jt;n(E,4*Lt,Wt,Gt,o,a)}}zt+=V;Vt+=U;Yt+=W;Bt+=it;Lt++}Nt+=z;Ot+=B;Xt+=j;It+=rt;Lt+=mt}}}else;}else;else;else;}gt+=K*z;Et+=K*B;yt+=K*j;Tt+=K*rt}}}function i(e,t){var i=e*M+t*M*s;var r=4*i+3;var n=s-M;var o=4*n;for(var a=0;M>a;a++){for(var l=0;M>l;l++){y[i]=C;E[r]=0;i++;r+=4}i+=n;r+=o}}function r(){var e=0;for(var t=0;c>t;t++)for(var r=0;h>r;r++){if(b[e]&R){i(r,t);b[e]=x}e++}}console.log("THREE.SoftwareRenderer",THREE.REVISION);var n=document.createElement("canvas");var o=n.getContext("2d");var a={};var s,l;var h,c;var u,f,d;var p,m,v;var g,E,y;var T,_,b;var x=1;var R=2;var w=4;var H=(1<<w)-1;var S=3;var M=1<<S;var C=1<<24;var A=1/0,D=1/0;var P=0,L=0;var k=1/0,N=1/0;var O=0,I=0;var F=new THREE.Projector;this.domElement=n;this.autoClear=!0;this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.setClearColor=function(){};this.setSize=function(e,t){h=Math.floor(e/M);c=Math.floor(t/M);s=h*M;l=c*M;var i=1<<w;u=i*s/2;f=-i*l/2;d=C/2;p=i*s/2+.5;m=i*l/2+.5;v=C/2+.5;n.width=s;n.height=l;g=o.getImageData(0,0,s,l);E=g.data;y=new Int32Array(E.length/4);T=h*c;_=new Int32Array(T);b=new Uint8Array(T);for(var r=0,a=y.length;a>r;r++)y[r]=C;for(var r=0;T>r;r++)b[r]=x};this.setSize(n.width,n.height);this.clear=function(){A=1/0;D=1/0;P=0;L=0;for(var e=0;T>e;e++){_[e]=C;b[e]=b[e]&x?x:R}};this.render=function(i,n){if(this.autoClear===!0)this.clear();var a=F.projectScene(i,n);var s=a.elements;for(var l=0,h=s.length;h>l;l++){var c=s[l];var u=c.material;var f=e(u);if(c instanceof THREE.RenderableFace3)t(c.v1.positionScreen,c.v2.positionScreen,c.v3.positionScreen,f,c,u);else if(c instanceof THREE.RenderableFace4){t(c.v1.positionScreen,c.v2.positionScreen,c.v4.positionScreen,f,c,u);t(c.v2.positionScreen,c.v3.positionScreen,c.v4.positionScreen,f,c,u)}}r();var d=Math.min(A,k);var p=Math.min(D,N);var m=Math.max(P,O)-d;var v=Math.max(L,I)-p;if(1/0!==d)o.putImageData(g,0,0,d,p,m,v);k=A;N=D;O=P;I=L}};