THREE.WebGLRenderer=function(e){function t(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)G.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function i(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function r(e){var t,i;for(t in e.attributes)i=e.attributes[t],void 0===i.numItems&&(i.numItems=i.array.length),i.buffer=G.createBuffer(),"index"===t?G.setStaticIndexBuffer(i.buffer,i.array):G.setStaticArrayBuffer(i.buffer,i.array)}function n(e,t){var i,r,n=e.attributes;for(i in n)r=n[i],r.needsUpdate&&("index"===i?G.setDynamicIndexBuffer(r.buffer,r.array):G.setDynamicArrayBuffer(r.buffer,r.array),r.needsUpdate=!1),t&&!r.dynamic&&delete r.array}function o(e,t,i){var r=e.program.attributes;if(-1!==i.morphTargetBase&&r.position>=0?G.setFloatAttribute(r.position,t.__webglMorphTargetsBuffers[i.morphTargetBase],3,0):r.position>=0&&G.setFloatAttribute(r.position,t.__webglVertexBuffer,3,0),i.morphTargetForcedOrder.length)for(var n=0,o=i.morphTargetForcedOrder,a=i.morphTargetInfluences;n<e.numSupportedMorphTargets&&n<o.length;)r["morphTarget"+n]>=0&&G.setFloatAttribute(r["morphTarget"+n],t.__webglMorphTargetsBuffers[o[n]],3,0),r["morphNormal"+n]>=0&&e.morphNormals&&G.setFloatAttribute(r["morphNormal"+n],t.__webglMorphNormalsBuffers[o[n]],3,0),i.__webglMorphTargetInfluences[n]=a[o[n]],n++;else{var l,h,c=[],a=i.morphTargetInfluences,u=a.length;for(h=0;u>h;h++)l=a[h],l>0&&c.push([l,h]);c.length>e.numSupportedMorphTargets?(c.sort(s),c.length=e.numSupportedMorphTargets):c.length>e.numSupportedMorphNormals?c.sort(s):0===c.length&&c.push([0,0]);for(var d,n=0;n<e.numSupportedMorphTargets;)c[n]?(d=c[n][1],r["morphTarget"+n]>=0&&G.setFloatAttribute(r["morphTarget"+n],t.__webglMorphTargetsBuffers[d],3,0),r["morphNormal"+n]>=0&&e.morphNormals&&G.setFloatAttribute(r["morphNormal"+n],t.__webglMorphNormalsBuffers[d],3,0),i.__webglMorphTargetInfluences[n]=a[d]):i.__webglMorphTargetInfluences[n]=0,n++}null!==e.program.uniforms.morphTargetInfluences&&G.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}function a(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function s(e,t){return t[0]-e[0]}function l(e,t,i){if(e.length)for(var r=0,n=e.length;n>r;r++)$=null,tt=null,et=-1,J=-1,lt=!0,G.resetState(),e[r].render(t,i,G.getCurrentWidth(),G.getCurrentHeight()),$=null,tt=null,et=-1,J=-1,lt=!0,G.resetState()}function h(e,t,i,r,n,o,a,s){var l,h,c,u,d,p,f;t?(d=e.length-1,p=-1,f=-1):(d=0,p=e.length,f=1);for(var m=d;m!==p;m+=f)if(l=e[m],l.render){if(h=l.object,c=l.buffer,s)u=s;else{if(u=l[i],!u)continue;a&&G.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),G.setDepthTest(u.depthTest),G.setDepthWrite(u.depthWrite),G.setPolygonOffset(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}G.setMaterialFaces(u),c instanceof THREE.BufferGeometry?Q.renderBufferDirect(r,n,o,u,c,h):Q.renderBuffer(r,n,o,u,c,h)}}function c(e,t,i,r,n,o,a){for(var s,l,h,c=0,u=e.length;u>c;c++)if(s=e[c],l=s.object,l.visible){if(a)h=a;else{if(h=s[t],!h)continue;o&&G.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),G.setDepthTest(h.depthTest),G.setDepthWrite(h.depthWrite),G.setPolygonOffset(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}Q.renderImmediateObject(i,r,n,h,l)}}function u(e){var t=e.object,i=t.material;i.transparent?(e.transparent=i,e.opaque=null):(e.opaque=i,e.transparent=null)}function d(e){var t,i,r,n=e.object,o=e.buffer;r=n.material,r instanceof THREE.MeshFaceMaterial?(i=o.materialIndex,t=r.materials[i],t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=r,t&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)))}function p(e,t){var i,r,n,o,a,s,l={},h=e.morphTargets.length,c=e.morphNormals.length,u=t instanceof THREE.MeshFaceMaterial;for(e.geometryGroups={},i=0,r=e.faces.length;r>i;i++)n=e.faces[i],o=u?n.materialIndex:0,void 0===l[o]&&(l[o]={hash:o,counter:0}),s=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:h,numMorphNormals:c}),a=n instanceof THREE.Face3?3:4,e.geometryGroups[s].vertices+a>65535&&(l[o].counter+=1,s=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:h,numMorphNormals:c})),n instanceof THREE.Face3?e.geometryGroups[s].faces3.push(i):e.geometryGroups[s].faces4.push(i),e.geometryGroups[s].vertices+=a;e.geometryGroupsList=[];for(var d in e.geometryGroups)e.geometryGroups[d].id=it++,e.geometryGroupsList.push(e.geometryGroups[d])}function f(e,t){var i,n,o,a;if(!e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new THREE.Matrix4,e._normalMatrix=new THREE.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",ct)),e instanceof THREE.Mesh)if(n=e.geometry,o=e.material,n instanceof THREE.Geometry){void 0===n.geometryGroups&&p(n,o);for(i in n.geometryGroups)a=n.geometryGroups[i],a.__webglVertexBuffer||(X.createBuffers(a),X.initBuffers(a,e),n.verticesNeedUpdate=!0,n.morphTargetsNeedUpdate=!0,n.elementsNeedUpdate=!0,n.uvsNeedUpdate=!0,n.normalsNeedUpdate=!0,n.tangentsNeedUpdate=!0,n.colorsNeedUpdate=!0)}else n instanceof THREE.BufferGeometry&&r(n);else e instanceof THREE.Ribbon?(n=e.geometry,n.__webglVertexBuffer||(K.createBuffers(n),K.initBuffers(n,e),n.verticesNeedUpdate=!0,n.colorsNeedUpdate=!0,n.normalsNeedUpdate=!0)):e instanceof THREE.Line?(n=e.geometry,n.__webglVertexBuffer||(n instanceof THREE.Geometry?(q.createBuffers(n),q.initBuffers(n,e),n.verticesNeedUpdate=!0,n.colorsNeedUpdate=!0,n.lineDistancesNeedUpdate=!0):n instanceof THREE.BufferGeometry&&r(n))):e instanceof THREE.ParticleSystem&&(n=e.geometry,n.__webglVertexBuffer||(n instanceof THREE.Geometry?(Y.createBuffers(n),Y.initBuffers(n,e),n.verticesNeedUpdate=!0,n.colorsNeedUpdate=!0):n instanceof THREE.BufferGeometry&&r(n)));if(!e.__webglActive){if(e instanceof THREE.Mesh){if(n=e.geometry,n instanceof THREE.BufferGeometry)m(t.__webglObjects,n,e);else if(n instanceof THREE.Geometry)for(i in n.geometryGroups)a=n.geometryGroups[i],m(t.__webglObjects,a,e)}else e instanceof THREE.Ribbon||e instanceof THREE.Line||e instanceof THREE.ParticleSystem?(n=e.geometry,m(t.__webglObjects,n,e)):e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback?g(t.__webglObjectsImmediate,e):e instanceof THREE.Sprite?t.__webglSprites.push(e):e instanceof THREE.LensFlare&&t.__webglFlares.push(e);e.__webglActive=!0}}function m(e,t,i){e.push({id:null,buffer:t,object:i,opaque:null,transparent:null,render:!1,z:0})}function g(e,t){e.push({object:t,opaque:null,transparent:null})}function v(e){var t,r,o,a=e.geometry;if(e instanceof THREE.Mesh)if(a instanceof THREE.BufferGeometry)(a.verticesNeedUpdate||a.elementsNeedUpdate||a.uvsNeedUpdate||a.normalsNeedUpdate||a.colorsNeedUpdate||a.tangentsNeedUpdate)&&n(a,!a.dynamic),a.verticesNeedUpdate=!1,a.elementsNeedUpdate=!1,a.uvsNeedUpdate=!1,a.normalsNeedUpdate=!1,a.colorsNeedUpdate=!1,a.tangentsNeedUpdate=!1;else{for(var s=0,l=a.geometryGroupsList.length;l>s;s++)t=a.geometryGroupsList[s],o=i(e,t),a.buffersNeedUpdate&&X.initBuffers(t,e),r=o.attributes&&E(o),(a.verticesNeedUpdate||a.morphTargetsNeedUpdate||a.elementsNeedUpdate||a.uvsNeedUpdate||a.normalsNeedUpdate||a.colorsNeedUpdate||a.tangentsNeedUpdate||r)&&X.setBuffers(t,e,!a.dynamic,o);a.verticesNeedUpdate=!1,a.morphTargetsNeedUpdate=!1,a.elementsNeedUpdate=!1,a.uvsNeedUpdate=!1,a.normalsNeedUpdate=!1,a.colorsNeedUpdate=!1,a.tangentsNeedUpdate=!1,a.buffersNeedUpdate=!1,o.attributes&&y(o)}else e instanceof THREE.Ribbon?(o=i(e,a),r=o.attributes&&E(o),(a.verticesNeedUpdate||a.colorsNeedUpdate||a.normalsNeedUpdate||r)&&K.setBuffers(a),a.verticesNeedUpdate=!1,a.colorsNeedUpdate=!1,a.normalsNeedUpdate=!1,o.attributes&&y(o)):e instanceof THREE.Line?a instanceof THREE.BufferGeometry?((a.verticesNeedUpdate||a.colorsNeedUpdate)&&n(a,!a.dynamic),a.verticesNeedUpdate=!1,a.colorsNeedUpdate=!1):(o=i(e,a),r=o.attributes&&E(o),(a.verticesNeedUpdate||a.colorsNeedUpdate||a.lineDistancesNeedUpdate||r)&&q.setBuffers(a),a.verticesNeedUpdate=!1,a.colorsNeedUpdate=!1,a.lineDistancesNeedUpdate=!1,o.attributes&&y(o)):e instanceof THREE.ParticleSystem&&(a instanceof THREE.BufferGeometry?((a.verticesNeedUpdate||a.colorsNeedUpdate)&&n(a,!a.dynamic),a.verticesNeedUpdate=!1,a.colorsNeedUpdate=!1):(o=i(e,a),r=o.attributes&&E(o),(a.verticesNeedUpdate||a.colorsNeedUpdate||e.sortParticles||r)&&Y.setBuffers(a,e,ot),a.verticesNeedUpdate=!1,a.colorsNeedUpdate=!1,o.attributes&&y(o)))}function E(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function y(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function T(e,t){e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Ribbon||e instanceof THREE.Line?_(t.__webglObjects,e):e instanceof THREE.Sprite?b(t.__webglSprites,e):e instanceof THREE.LensFlare?b(t.__webglFlares,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&_(t.__webglObjectsImmediate,e),e.__webglActive=!1}function _(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function b(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function x(e,t){e.uniforms=THREE.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader}function R(e,t,i,r,n){rt=0,r.needsUpdate&&(r.program&&pt(r),Q.initMaterial(r,t,i,n),r.needsUpdate=!1),r.morphTargets&&(n.__webglMorphTargetInfluences||(n.__webglMorphTargetInfluences=new Float32Array(Q.maxMorphTargets)));var o=!1,a=r.program,s=a.uniforms,l=r.uniforms;if(a!==$&&(G.useProgram(a),$=a,o=!0),r.id!==J&&(J=r.id,o=!0),(o||e!==tt)&&(G.uniformMatrix4fv(s.projectionMatrix,e.projectionMatrix.elements),e!==tt&&(tt=e)),r.skinning)if(G.supportsBoneTextures&&n.useVertexTexture){if(null!==s.boneTexture){var h=N();G.uniform1i(s.boneTexture,h),G.setTexture(n.boneTexture,h)}}else null!==s.boneGlobalMatrices&&G.uniformMatrix4fv(s.boneGlobalMatrices,n.boneMatrices);return o&&(i&&r.fog&&C(l,i),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights)&&(lt&&(V(a,t),lt=!1),L(l,ht)),(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)&&w(l,r),r instanceof THREE.LineBasicMaterial?H(l,r):r instanceof THREE.LineDashedMaterial?(H(l,r),S(l,r)):r instanceof THREE.ParticleBasicMaterial?M(l,r):r instanceof THREE.MeshPhongMaterial?A(l,r):r instanceof THREE.MeshLambertMaterial?D(l,r):r instanceof THREE.MeshDepthMaterial?(l.mNear.value=e.near,l.mFar.value=e.far,l.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(l.opacity.value=r.opacity),n.receiveShadow&&!r._shadowPass&&P(l,t),I(a,r.uniformsList),(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&null!==s.cameraPosition&&(at.getPositionFromMatrix(e.matrixWorld),G.uniform3f(s.cameraPosition,at.x,at.y,at.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&null!==s.viewMatrix&&G.uniformMatrix4fv(s.viewMatrix,e.matrixWorldInverse.elements)),k(s,n),null!==s.modelMatrix&&G.uniformMatrix4fv(s.modelMatrix,n.matrixWorld.elements),a}function w(e,t){e.opacity.value=t.opacity,Q.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var i;if(t.map?i=t.map:t.specularMap?i=t.specularMap:t.normalMap?i=t.normalMap:t.bumpMap&&(i=t.bumpMap),void 0!==i){var r=i.offset,n=i.repeat;e.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,e.reflectivity.value=Q.gammaInput?t.reflectivity:t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof THREE.CubeRefractionMapping}function H(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function S(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function M(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=G.getDomElement().height/2,e.map.value=t.map}function C(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}function A(e,t){e.shininess.value=t.shininess,Q.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function D(e,t){Q.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function L(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function P(e,t){if(e.shadowMatrix)for(var i=0,r=0,n=t.length;n>r;r++){var o=t[r];o.castShadow&&(o instanceof THREE.SpotLight||o instanceof THREE.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[i]=o.shadowMap,e.shadowMapSize.value[i]=o.shadowMapSize,e.shadowMatrix.value[i]=o.shadowMatrix,e.shadowDarkness.value[i]=o.shadowDarkness,e.shadowBias.value[i]=o.shadowBias,i++)}}function k(e,t){G.uniformMatrix4fv(e.modelViewMatrix,t._modelViewMatrix.elements),e.normalMatrix&&G.uniformMatrix3fv(e.normalMatrix,t._normalMatrix.elements)}function N(){var e=rt;return e>=G.maxTextures&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+G.maxTextures),rt+=1,e}function I(e,t){var i,r,n,o,a,s,l,h,c,u,d;for(c=0,u=t.length;u>c;c++)if(o=e.uniforms[t[c][1]])if(i=t[c][0],n=i.type,r=i.value,"i"===n)G.uniform1i(o,r);else if("f"===n)G.uniform1f(o,r);else if("v2"===n)G.uniform2f(o,r.x,r.y);else if("v3"===n)G.uniform3f(o,r.x,r.y,r.z);else if("v4"===n)G.uniform4f(o,r.x,r.y,r.z,r.w);else if("c"===n)G.uniform3f(o,r.r,r.g,r.b);else if("iv1"===n)G.uniform1iv(o,r);else if("iv"===n)G.uniform3iv(o,r);else if("fv1"===n)G.uniform1fv(o,r);else if("fv"===n)G.uniform3fv(o,r);else if("v2v"===n){for(void 0===i._array&&(i._array=new Float32Array(2*r.length)),l=0,h=r.length;h>l;l++)d=2*l,i._array[d]=r[l].x,i._array[d+1]=r[l].y;G.uniform2fv(o,i._array)}else if("v3v"===n){for(void 0===i._array&&(i._array=new Float32Array(3*r.length)),l=0,h=r.length;h>l;l++)d=3*l,i._array[d]=r[l].x,i._array[d+1]=r[l].y,i._array[d+2]=r[l].z;G.uniform3fv(o,i._array)}else if("v4v"===n){for(void 0===i._array&&(i._array=new Float32Array(4*r.length)),l=0,h=r.length;h>l;l++)d=4*l,i._array[d]=r[l].x,i._array[d+1]=r[l].y,i._array[d+2]=r[l].z,i._array[d+3]=r[l].w;G.uniform4fv(o,i._array)}else if("m4"===n)void 0===i._array&&(i._array=new Float32Array(16)),r.flattenToArray(i._array),G.uniformMatrix4fv(o,i._array);else if("m4v"===n){for(void 0===i._array&&(i._array=new Float32Array(16*r.length)),l=0,h=r.length;h>l;l++)r[l].flattenToArrayOffset(i._array,16*l);G.uniformMatrix4fv(o,i._array)}else if("t"===n){if(a=r,s=N(),G.uniform1i(o,s),!a)continue;a.image instanceof Array&&6===a.image.length?G.setCubeTexture(a,s):a instanceof THREE.WebGLRenderTargetCube?G.setCubeTextureDynamic(a,s):G.setTexture(a,s)}else if("tv"===n){for(void 0===i._array&&(i._array=[]),l=0,h=i.value.length;h>l;l++)i._array[l]=N();for(G.uniform1iv(o,i._array),l=0,h=i.value.length;h>l;l++)a=i.value[l],s=i._array[l],a&&G.setTexture(a,s)}}function O(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function F(e,t,i,r){e[t]=i.r*i.r*r,e[t+1]=i.g*i.g*r,e[t+2]=i.b*i.b*r}function z(e,t,i,r){e[t]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function V(e,t){var i,r,n,o,a,s,l,h,c,u=0,d=0,p=0,f=ht,m=f.directional.colors,g=f.directional.positions,v=f.point.colors,E=f.point.positions,y=f.point.distances,T=f.spot.colors,_=f.spot.positions,b=f.spot.distances,x=f.spot.directions,R=f.spot.anglesCos,w=f.spot.exponents,H=f.hemi.skyColors,S=f.hemi.groundColors,M=f.hemi.positions,C=0,A=0,D=0,L=0,P=0,k=0,N=0,I=0,O=0,V=0,B=0,U=0;for(i=0,r=t.length;r>i;i++)if(n=t[i],!n.onlyShadow)if(o=n.color,l=n.intensity,c=n.distance,n instanceof THREE.AmbientLight){if(!n.visible)continue;Q.gammaInput?(u+=o.r*o.r,d+=o.g*o.g,p+=o.b*o.b):(u+=o.r,d+=o.g,p+=o.b)}else if(n instanceof THREE.DirectionalLight){if(P+=1,!n.visible)continue;if(st.getPositionFromMatrix(n.matrixWorld),at.getPositionFromMatrix(n.target.matrixWorld),st.sub(at),st.normalize(),0===st.x&&0===st.y&&0===st.z)continue;O=3*C,g[O]=st.x,g[O+1]=st.y,g[O+2]=st.z,Q.gammaInput?F(m,O,o,l*l):z(m,O,o,l),C+=1}else if(n instanceof THREE.PointLight){if(k+=1,!n.visible)continue;V=3*A,Q.gammaInput?F(v,V,o,l*l):z(v,V,o,l),at.getPositionFromMatrix(n.matrixWorld),E[V]=at.x,E[V+1]=at.y,E[V+2]=at.z,y[A]=c,A+=1}else if(n instanceof THREE.SpotLight){if(N+=1,!n.visible)continue;B=3*D,Q.gammaInput?F(T,B,o,l*l):z(T,B,o,l),at.getPositionFromMatrix(n.matrixWorld),_[B]=at.x,_[B+1]=at.y,_[B+2]=at.z,b[D]=c,st.copy(at),at.getPositionFromMatrix(n.target.matrixWorld),st.sub(at),st.normalize(),x[B]=st.x,x[B+1]=st.y,x[B+2]=st.z,R[D]=Math.cos(n.angle),w[D]=n.exponent,D+=1}else if(n instanceof THREE.HemisphereLight){if(I+=1,!n.visible)continue;if(st.getPositionFromMatrix(n.matrixWorld),st.normalize(),0===st.x&&0===st.y&&0===st.z)continue;U=3*L,M[U]=st.x,M[U+1]=st.y,M[U+2]=st.z,a=n.color,s=n.groundColor,Q.gammaInput?(h=l*l,F(H,U,a,h),F(S,U,s,h)):(z(H,U,a,l),z(S,U,s,l)),L+=1}for(i=3*C,r=Math.max(m.length,3*P);r>i;i++)m[i]=0;for(i=3*A,r=Math.max(v.length,3*k);r>i;i++)v[i]=0;for(i=3*D,r=Math.max(T.length,3*N);r>i;i++)T[i]=0;for(i=3*L,r=Math.max(H.length,3*I);r>i;i++)H[i]=0;for(i=3*L,r=Math.max(S.length,3*I);r>i;i++)S[i]=0;f.directional.length=C,f.point.length=A,f.spot.length=D,f.hemi.length=L,f.ambient[0]=u,f.ambient[1]=d,f.ambient[2]=p}function B(e){if(G.supportsBoneTextures&&e&&e.useVertexTexture)return 1024;var t=G.maxVertexUniformVectors,i=Math.floor((t-20)/4),r=i;return void 0!==e&&e instanceof THREE.SkinnedMesh&&(r=Math.min(e.bones.length,r),r<e.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")),r}function U(e){var t,i,r,n,o,a,s;for(n=o=a=s=0,t=0,i=e.length;i>t;t++)r=e[t],r.onlyShadow||(r instanceof THREE.DirectionalLight&&n++,r instanceof THREE.PointLight&&o++,r instanceof THREE.SpotLight&&a++,r instanceof THREE.HemisphereLight&&s++);return{directional:n,point:o,spot:a,hemi:s}}function j(e){var t,i,r,n=0;for(t=0,i=e.length;i>t;t++)r=e[t],r.castShadow&&(r instanceof THREE.SpotLight&&n++,r instanceof THREE.DirectionalLight&&!r.shadowCascade&&n++);return n}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var W={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},G=new THREE.WebGLRenderer.LowLevelRenderer(e),X=new THREE.WebGLRenderer.MeshRenderer(G,W),Y=new THREE.WebGLRenderer.ParticleRenderer(G,W),q=new THREE.WebGLRenderer.LineRenderer(G,W),K=new THREE.WebGLRenderer.RibbonRenderer(G,W),Z=new THREE.WebGLRenderer.ShaderBuilder(G,W);this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info=W;var Q=this,$=null,J=-1,et=null,tt=null,it=0,rt=0,nt=new THREE.Frustum,ot=new THREE.Matrix4,at=(new THREE.Matrix4,new THREE.Vector3),st=new THREE.Vector3,lt=!0,ht={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};this.context=G.getContext(),this.domElement=G.getDomElement(),this.getPrecision=G.getPrecision,this.getPrecision=G.getPrecision,this.getContext=G.getContext,this.supportsVertexTextures=G.supportsVertexTextures,this.supportsFloatTextures=G.supportsFloatTextures,this.supportsStandardDerivatives=G.supportsStandardDerivatives,this.supportsCompressedTextureS3TC=G.supportsCompressedTextureS3TC,this.getMaxAnisotropy=G.getMaxAnisotropy,this.setSize=G.setSize,this.setViewport=G.setViewport,this.setScissor=G.setScissor,this.enableScissorTest=G.enableScissorTest,this.setDepthWrite=G.setDepthWrite,this.setDepthTest=G.setDepthTest,this.setRenderTarget=G.setRenderTarget,this.setBlending=G.setBlending,this.setTexture=G.setTexture,this.setMaterialFaces=G.setMaterialFaces,this.setFaceCulling=G.setFaceCulling,this.setClearColorHex=G.setClearColorHex,this.setClearColor=G.setClearColor,this.getClearColor=G.getClearColor,this.getClearAlpha=G.getClearAlpha,this.clear=G.clear,this.clearTarget=G.clearTarget,this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){$=null,et=-1,J=-1,lt=!0,G.resetState(),this.shadowMapPlugin.update(e,t)};var ct=function(e){var t=e.target;t.removeEventListener("dispose",ct),dt(t),Q.info.memory.geometries--},ut=function(e){var t=e.target;t.removeEventListener("dispose",ut),pt(t)},dt=function(e){var i,r;if(e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&G.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&G.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&G.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&G.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&G.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&G.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&G.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&G.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&G.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&G.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&G.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.geometryGroups)for(var n in e.geometryGroups){var o=e.geometryGroups[n];if(void 0!==o.numMorphTargets)for(i=0,r=o.numMorphTargets;r>i;i++)G.deleteBuffer(o.__webglMorphTargetsBuffers[i]);if(void 0!==o.numMorphNormals)for(i=0,r=o.numMorphNormals;r>i;i++)G.deleteBuffer(o.__webglMorphNormalsBuffers[i]);t(o)}t(e)},pt=function(e){var t=e.program;void 0!==t&&(e.program=void 0,Z.removeProgram(t))};this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=G.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=G.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=G.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=G.createBuffer()),e.hasPositions&&(G.setDynamicArrayBuffer(e.__webglVertexBuffer,e.positionArray),G.setFloatAttribute(t.attributes.position,e.__webglVertexBuffer,3,0)),e.hasNormals){if(i.shading===THREE.FlatShading){var r,n,o,a,s,l,h,c,u,d,p,f,m,g,v=3*e.count;for(g=0;v>g;g+=9)m=e.normalArray,a=m[g],h=m[g+1],d=m[g+2],s=m[g+3],c=m[g+4],p=m[g+5],l=m[g+6],u=m[g+7],f=m[g+8],r=(a+s+l)/3,n=(h+c+u)/3,o=(d+p+f)/3,m[g]=r,m[g+1]=n,m[g+2]=o,m[g+3]=r,m[g+4]=n,m[g+5]=o,m[g+6]=r,m[g+7]=n,m[g+8]=o}G.setDynamicArrayBuffer(e.__webglNormalBuffer,e.normalArray),G.setFloatAttribute(t.attributes.normal,e.__webglNormalBuffer,3,0)}e.hasUvs&&i.map&&(G.setDynamicArrayBuffer(e.__webglUvBuffer,e.uvArray),G.setFloatAttribute(t.attributes.uv,e.__webglUvBuffer,2,0)),e.hasColors&&i.vertexColors!==THREE.NoColors&&(G.setDynamicArrayBuffer(e.__webglColorBuffer,e.colorArray),G.setFloatAttribute(t.attributes.color,e.__webglColorBuffer,3,0)),G.drawTriangles(e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,n,o){if(r.visible!==!1){var a,s,l,h,c,u,d;a=R(e,t,i,r,o),s=a.attributes,l=n.attributes;var p=!1,f=r.wireframe?1:0,m=16777215*n.id+2*a.id+f;if(m!==et&&(et=m,p=!0),p&&G.disableAttributes(),o instanceof THREE.Mesh){var g=l.index;if(g){var v=n.offsets;v.length>1&&(p=!0);for(var E=0,y=v.length;y>E;E++){var T=v[E].index;if(p)for(c in l)"index"!==c&&(u=s[c],h=l[c],d=h.itemSize,u>=0&&G.setFloatAttribute(u,h.buffer,d,4*T*d));G.drawTriangleElements(g.buffer,v[E].count,2*v[E].start),Q.info.render.calls++,Q.info.render.vertices+=v[E].count,Q.info.render.faces+=v[E].count/3}}else{if(p)for(c in l)u=s[c],h=l[c],d=h.itemSize,u>=0&&G.setFloatAttribute(u,h.buffer,d,0);var _=n.attributes.position;G.drawTriangles(_.numItems/3),Q.info.render.calls++,Q.info.render.vertices+=_.numItems/3,Q.info.render.faces+=_.numItems/3/3}}else if(o instanceof THREE.ParticleSystem){if(p){for(c in l)u=s[c],h=l[c],d=h.itemSize,u>=0&&G.setFloatAttribute(u,h.buffer,d,0);var _=l.position;G.drawPoints(_.numItems/3),Q.info.render.calls++,Q.info.render.points+=_.numItems/3}}else if(o instanceof THREE.Line&&p){for(c in l)u=s[c],h=l[c],d=h.itemSize,u>=0&&G.setFloatAttribute(u,h.buffer,d,0);var _=l.position;G.setLineWidth(r.linewidth),G.drawLineStrip(_.numItems/3),Q.info.render.calls++,Q.info.render.points+=_.numItems}}},this.renderBuffer=function(e,t,i,r,n,a){if(r.visible!==!1){var s,l,h,c,u;s=R(e,t,i,r,a),l=s.attributes;var d=!1,p=r.wireframe?1:0,f=16777215*n.id+2*s.id+p;if(f!==et&&(et=f,d=!0),d&&G.disableAttributes(),!r.morphTargets&&l.position>=0?d&&G.setFloatAttribute(l.position,n.__webglVertexBuffer,3,0):a.morphTargetBase&&o(r,n,a),d){if(n.__webglCustomAttributesList)for(c=0,u=n.__webglCustomAttributesList.length;u>c;c++)h=n.__webglCustomAttributesList[c],l[h.buffer.belongsToAttribute]>=0&&G.setFloatAttribute(l[h.buffer.belongsToAttribute],h.buffer,h.size,0);l.color>=0&&G.setFloatAttribute(l.color,n.__webglColorBuffer,3,0),l.normal>=0&&G.setFloatAttribute(l.normal,n.__webglNormalBuffer,3,0),l.tangent>=0&&G.setFloatAttribute(l.tangent,n.__webglTangentBuffer,4,0),l.uv>=0&&G.setFloatAttribute(l.uv,n.__webglUVBuffer,2,0),l.uv2>=0&&G.setFloatAttribute(l.uv2,n.__webglUV2Buffer,2,0),r.skinning&&l.skinIndex>=0&&l.skinWeight>=0&&(G.setFloatAttribute(l.skinIndex,n.__webglSkinIndicesBuffer,4,0),G.setFloatAttribute(l.skinWeight,n.__webglSkinWeightsBuffer,4,0)),l.lineDistance>=0&&G.setFloatAttribute(l.lineDistance,n.__webglLineDistanceBuffer,1,0)}a instanceof THREE.Mesh?(r.wireframe?(G.setLineWidth(r.wireframeLinewidth),G.drawLineElements(n.__webglLineBuffer,n.__webglLineCount,0)):G.drawTriangleElements(n.__webglFaceBuffer,n.__webglFaceCount,0),Q.info.render.calls++,Q.info.render.vertices+=n.__webglFaceCount,Q.info.render.faces+=n.__webglFaceCount/3):a instanceof THREE.Line?(G.setLineWidth(r.linewidth),a.type===THREE.LineStrip?G.drawLineStrip(n.__webglLineCount):G.drawLines(n.__webglLineCount),Q.info.render.calls++):a instanceof THREE.ParticleSystem?(G.drawPoints(n.__webglParticleCount),Q.info.render.calls++,Q.info.render.points+=n.__webglParticleCount):a instanceof THREE.Ribbon&&(G.drawTriangleStrip(n.__webglVertexCount),Q.info.render.calls++)}},this.render=function(e,t,i,r){if(t instanceof THREE.Camera==!1)return console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera."),void 0;var n,o,s,p,f,m=e.__lights,g=e.fog;for(J=-1,lt=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),ot.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),nt.setFromMatrix(ot),this.autoUpdateObjects&&this.initWebGLObjects(e),l(this.renderPluginsPre,e,t),Q.info.render.calls=0,Q.info.render.vertices=0,Q.info.render.faces=0,Q.info.render.points=0,G.setRenderTarget(i),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),f=e.__webglObjects,n=0,o=f.length;o>n;n++)s=f[n],p=s.object,s.id=n,s.render=!1,p.visible&&((p instanceof THREE.Mesh||p instanceof THREE.ParticleSystem)&&p.frustumCulled&&!nt.intersectsObject(p)||(O(p,t),d(s),s.render=!0,this.sortObjects===!0&&(null!==p.renderDepth?s.z=p.renderDepth:(at.getPositionFromMatrix(p.matrixWorld),at.applyProjection(ot),s.z=at.z))));for(this.sortObjects&&f.sort(a),f=e.__webglObjectsImmediate,n=0,o=f.length;o>n;n++)s=f[n],p=s.object,p.visible&&(O(p,t),u(s));if(e.overrideMaterial){var v=e.overrideMaterial;G.setBlending(v.blending,v.blendEquation,v.blendSrc,v.blendDst),G.setDepthTest(v.depthTest),G.setDepthWrite(v.depthWrite),G.setPolygonOffset(v.polygonOffset,v.polygonOffsetFactor,v.polygonOffsetUnits),h(e.__webglObjects,!1,"",t,m,g,!0,v),c(e.__webglObjectsImmediate,"",t,m,g,!1,v)}else{var v=null;G.setBlending(THREE.NoBlending),h(e.__webglObjects,!0,"opaque",t,m,g,!1,v),c(e.__webglObjectsImmediate,"opaque",t,m,g,!1,v),h(e.__webglObjects,!1,"transparent",t,m,g,!0,v),c(e.__webglObjectsImmediate,"transparent",t,m,g,!0,v)}l(this.renderPluginsPost,e,t),i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter&&G.updateRenderTargetMipmap(i),G.setDepthTest(!0),G.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,i,r,n){var o=R(e,t,i,r,n);et=-1,G.setMaterialFaces(r),n.immediateRenderCallback?n.immediateRenderCallback(o,G.getContext(),nt):n.render(function(e){Q.renderBufferImmediate(e,o,r)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)f(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)T(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,i=e.__webglObjects.length;i>t;t++)v(e.__webglObjects[t].object)},this.initMaterial=function(e,t,i,r){e.addEventListener("dispose",ut);var n,o,a,s,l,h,c;e instanceof THREE.MeshDepthMaterial?c="depth":e instanceof THREE.MeshNormalMaterial?c="normal":e instanceof THREE.MeshBasicMaterial?c="basic":e instanceof THREE.MeshLambertMaterial?c="lambert":e instanceof THREE.MeshPhongMaterial?c="phong":e instanceof THREE.LineBasicMaterial?c="basic":e instanceof THREE.LineDashedMaterial?c="dashed":e instanceof THREE.ParticleBasicMaterial&&(c="particle_basic"),c&&x(e,THREE.ShaderLib[c]),s=U(t),h=j(t),l=B(r),a={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:l,useVertexTexture:G.supportsBoneTextures&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:h,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide,gammaInput:this.gammaInput,gammaOutput:this.gammaOutput,physicallyBasedShading:this.physicallyBasedShading},e.program=Z.buildProgram(c,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,a);
var u=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var d,p="morphTarget";for(o=0;o<this.maxMorphTargets;o++)d=p+o,u[d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var d,p="morphNormal";for(o=0;o<this.maxMorphNormals;o++)d=p+o,u[d]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(n in e.uniforms)e.uniformsList.push([e.uniforms[n],n])},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)};