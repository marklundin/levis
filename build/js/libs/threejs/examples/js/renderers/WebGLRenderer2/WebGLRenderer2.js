THREE.WebGLRenderer=function(e){function t(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)G.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function i(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function r(e){var t,i;for(t in e.attributes){i=e.attributes[t];if(void 0===i.numItems)i.numItems=i.array.length;i.buffer=G.createBuffer();if("index"===t)G.setStaticIndexBuffer(i.buffer,i.array);else G.setStaticArrayBuffer(i.buffer,i.array)}}function n(e,t){var i=e.attributes;var r,n;for(r in i){n=i[r];if(n.needsUpdate){if("index"===r)G.setDynamicIndexBuffer(n.buffer,n.array);else G.setDynamicArrayBuffer(n.buffer,n.array);n.needsUpdate=!1}if(t&&!n.dynamic)delete n.array}}function o(e,t,i){var r=e.program.attributes;if(-1!==i.morphTargetBase&&r.position>=0)G.setFloatAttribute(r.position,t.__webglMorphTargetsBuffers[i.morphTargetBase],3,0);else if(r.position>=0)G.setFloatAttribute(r.position,t.__webglVertexBuffer,3,0);if(i.morphTargetForcedOrder.length){var n=0;var o=i.morphTargetForcedOrder;var a=i.morphTargetInfluences;for(;n<e.numSupportedMorphTargets&&n<o.length;){if(r["morphTarget"+n]>=0)G.setFloatAttribute(r["morphTarget"+n],t.__webglMorphTargetsBuffers[o[n]],3,0);if(r["morphNormal"+n]>=0&&e.morphNormals)G.setFloatAttribute(r["morphNormal"+n],t.__webglMorphNormalsBuffers[o[n]],3,0);i.__webglMorphTargetInfluences[n]=a[o[n]];n++}}else{var l,h=[];var a=i.morphTargetInfluences;var c,u=a.length;for(c=0;u>c;c++){l=a[c];if(l>0)h.push([l,c])}if(h.length>e.numSupportedMorphTargets){h.sort(s);h.length=e.numSupportedMorphTargets}else if(h.length>e.numSupportedMorphNormals)h.sort(s);else if(0===h.length)h.push([0,0]);var f,n=0;for(;n<e.numSupportedMorphTargets;){if(h[n]){f=h[n][1];if(r["morphTarget"+n]>=0)G.setFloatAttribute(r["morphTarget"+n],t.__webglMorphTargetsBuffers[f],3,0);if(r["morphNormal"+n]>=0&&e.morphNormals)G.setFloatAttribute(r["morphNormal"+n],t.__webglMorphNormalsBuffers[f],3,0);i.__webglMorphTargetInfluences[n]=a[f]}else i.__webglMorphTargetInfluences[n]=0;n++}}if(null!==e.program.uniforms.morphTargetInfluences)G.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}function a(e,t){if(e.z!==t.z)return t.z-e.z;else return e.id-t.id}function s(e,t){return t[0]-e[0]}function l(e,t,i){if(e.length)for(var r=0,n=e.length;n>r;r++){$=null;tt=null;et=-1;J=-1;lt=!0;G.resetState();e[r].render(t,i,G.getCurrentWidth(),G.getCurrentHeight());$=null;tt=null;et=-1;J=-1;lt=!0;G.resetState()}}function h(e,t,i,r,n,o,a,s){var l,h,c,u,f,d,p;if(t){f=e.length-1;d=-1;p=-1}else{f=0;d=e.length;p=1}for(var m=f;m!==d;m+=p){l=e[m];if(l.render){h=l.object;c=l.buffer;if(s)u=s;else{u=l[i];if(!u)continue;if(a)G.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst);G.setDepthTest(u.depthTest);G.setDepthWrite(u.depthWrite);G.setPolygonOffset(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}G.setMaterialFaces(u);if(c instanceof THREE.BufferGeometry)Q.renderBufferDirect(r,n,o,u,c,h);else Q.renderBuffer(r,n,o,u,c,h)}}}function c(e,t,i,r,n,o,a){var s,l,h;for(var c=0,u=e.length;u>c;c++){s=e[c];l=s.object;if(l.visible){if(a)h=a;else{h=s[t];if(!h)continue;if(o)G.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst);G.setDepthTest(h.depthTest);G.setDepthWrite(h.depthWrite);G.setPolygonOffset(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}Q.renderImmediateObject(i,r,n,h,l)}}}function u(e){var t=e.object,i=t.material;if(i.transparent){e.transparent=i;e.opaque=null}else{e.opaque=i;e.transparent=null}}function f(e){var t,i,r,n=e.object,o=e.buffer;r=n.material;if(r instanceof THREE.MeshFaceMaterial){i=o.materialIndex;t=r.materials[i];if(t.transparent){e.transparent=t;e.opaque=null}else{e.opaque=t;e.transparent=null}}else{t=r;if(t)if(t.transparent){e.transparent=t;e.opaque=null}else{e.opaque=t;e.transparent=null}}}function d(e,t){var i,r,n,o,a,s,l={};var h=e.morphTargets.length;var c=e.morphNormals.length;var u=t instanceof THREE.MeshFaceMaterial;e.geometryGroups={};for(i=0,r=e.faces.length;r>i;i++){n=e.faces[i];o=u?n.materialIndex:0;if(void 0===l[o])l[o]={hash:o,counter:0};s=l[o].hash+"_"+l[o].counter;if(void 0===e.geometryGroups[s])e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:h,numMorphNormals:c};a=n instanceof THREE.Face3?3:4;if(e.geometryGroups[s].vertices+a>65535){l[o].counter+=1;s=l[o].hash+"_"+l[o].counter;if(void 0===e.geometryGroups[s])e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:h,numMorphNormals:c}}if(n instanceof THREE.Face3)e.geometryGroups[s].faces3.push(i);else e.geometryGroups[s].faces4.push(i);e.geometryGroups[s].vertices+=a}e.geometryGroupsList=[];for(var f in e.geometryGroups){e.geometryGroups[f].id=it++;e.geometryGroupsList.push(e.geometryGroups[f])}}function p(e,t){var i,n,o,a;if(!e.__webglInit){e.__webglInit=!0;e._modelViewMatrix=new THREE.Matrix4;e._normalMatrix=new THREE.Matrix3;if(void 0!==e.geometry&&void 0===e.geometry.__webglInit){e.geometry.__webglInit=!0;e.geometry.addEventListener("dispose",ct)}if(e instanceof THREE.Mesh){n=e.geometry;o=e.material;if(n instanceof THREE.Geometry){if(void 0===n.geometryGroups)d(n,o);for(i in n.geometryGroups){a=n.geometryGroups[i];if(!a.__webglVertexBuffer){X.createBuffers(a);X.initBuffers(a,e);n.verticesNeedUpdate=!0;n.morphTargetsNeedUpdate=!0;n.elementsNeedUpdate=!0;n.uvsNeedUpdate=!0;n.normalsNeedUpdate=!0;n.tangentsNeedUpdate=!0;n.colorsNeedUpdate=!0}}}else if(n instanceof THREE.BufferGeometry)r(n)}else if(e instanceof THREE.Ribbon){n=e.geometry;if(!n.__webglVertexBuffer){K.createBuffers(n);K.initBuffers(n,e);n.verticesNeedUpdate=!0;n.colorsNeedUpdate=!0;n.normalsNeedUpdate=!0}}else if(e instanceof THREE.Line){n=e.geometry;if(!n.__webglVertexBuffer)if(n instanceof THREE.Geometry){q.createBuffers(n);q.initBuffers(n,e);n.verticesNeedUpdate=!0;n.colorsNeedUpdate=!0;n.lineDistancesNeedUpdate=!0}else if(n instanceof THREE.BufferGeometry)r(n)}else if(e instanceof THREE.ParticleSystem){n=e.geometry;if(!n.__webglVertexBuffer)if(n instanceof THREE.Geometry){Y.createBuffers(n);Y.initBuffers(n,e);n.verticesNeedUpdate=!0;n.colorsNeedUpdate=!0}else if(n instanceof THREE.BufferGeometry)r(n)}}if(!e.__webglActive){if(e instanceof THREE.Mesh){n=e.geometry;if(n instanceof THREE.BufferGeometry)m(t.__webglObjects,n,e);else if(n instanceof THREE.Geometry)for(i in n.geometryGroups){a=n.geometryGroups[i];m(t.__webglObjects,a,e)}}else if(e instanceof THREE.Ribbon||e instanceof THREE.Line||e instanceof THREE.ParticleSystem){n=e.geometry;m(t.__webglObjects,n,e)}else if(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)v(t.__webglObjectsImmediate,e);else if(e instanceof THREE.Sprite)t.__webglSprites.push(e);else if(e instanceof THREE.LensFlare)t.__webglFlares.push(e);e.__webglActive=!0}}function m(e,t,i){e.push({id:null,buffer:t,object:i,opaque:null,transparent:null,render:!1,z:0})}function v(e,t){e.push({object:t,opaque:null,transparent:null})}function g(e){var t,r,o,a=e.geometry;if(e instanceof THREE.Mesh)if(a instanceof THREE.BufferGeometry){if(a.verticesNeedUpdate||a.elementsNeedUpdate||a.uvsNeedUpdate||a.normalsNeedUpdate||a.colorsNeedUpdate||a.tangentsNeedUpdate)n(a,!a.dynamic);a.verticesNeedUpdate=!1;a.elementsNeedUpdate=!1;a.uvsNeedUpdate=!1;a.normalsNeedUpdate=!1;a.colorsNeedUpdate=!1;a.tangentsNeedUpdate=!1}else{for(var s=0,l=a.geometryGroupsList.length;l>s;s++){t=a.geometryGroupsList[s];o=i(e,t);if(a.buffersNeedUpdate)X.initBuffers(t,e);r=o.attributes&&E(o);if(a.verticesNeedUpdate||a.morphTargetsNeedUpdate||a.elementsNeedUpdate||a.uvsNeedUpdate||a.normalsNeedUpdate||a.colorsNeedUpdate||a.tangentsNeedUpdate||r)X.setBuffers(t,e,!a.dynamic,o)}a.verticesNeedUpdate=!1;a.morphTargetsNeedUpdate=!1;a.elementsNeedUpdate=!1;a.uvsNeedUpdate=!1;a.normalsNeedUpdate=!1;a.colorsNeedUpdate=!1;a.tangentsNeedUpdate=!1;a.buffersNeedUpdate=!1;o.attributes&&y(o)}else if(e instanceof THREE.Ribbon){o=i(e,a);r=o.attributes&&E(o);if(a.verticesNeedUpdate||a.colorsNeedUpdate||a.normalsNeedUpdate||r)K.setBuffers(a);a.verticesNeedUpdate=!1;a.colorsNeedUpdate=!1;a.normalsNeedUpdate=!1;o.attributes&&y(o)}else if(e instanceof THREE.Line)if(a instanceof THREE.BufferGeometry){if(a.verticesNeedUpdate||a.colorsNeedUpdate)n(a,!a.dynamic);a.verticesNeedUpdate=!1;a.colorsNeedUpdate=!1}else{o=i(e,a);r=o.attributes&&E(o);if(a.verticesNeedUpdate||a.colorsNeedUpdate||a.lineDistancesNeedUpdate||r)q.setBuffers(a);a.verticesNeedUpdate=!1;a.colorsNeedUpdate=!1;a.lineDistancesNeedUpdate=!1;o.attributes&&y(o)}else if(e instanceof THREE.ParticleSystem)if(a instanceof THREE.BufferGeometry){if(a.verticesNeedUpdate||a.colorsNeedUpdate)n(a,!a.dynamic);a.verticesNeedUpdate=!1;a.colorsNeedUpdate=!1}else{o=i(e,a);r=o.attributes&&E(o);if(a.verticesNeedUpdate||a.colorsNeedUpdate||e.sortParticles||r)Y.setBuffers(a,e,ot);a.verticesNeedUpdate=!1;a.colorsNeedUpdate=!1;o.attributes&&y(o)}}function E(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function y(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function T(e,t){if(e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Ribbon||e instanceof THREE.Line)_(t.__webglObjects,e);else if(e instanceof THREE.Sprite)b(t.__webglSprites,e);else if(e instanceof THREE.LensFlare)b(t.__webglFlares,e);else if(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)_(t.__webglObjectsImmediate,e);e.__webglActive=!1}function _(e,t){for(var i=e.length-1;i>=0;i--)if(e[i].object===t)e.splice(i,1)}function b(e,t){for(var i=e.length-1;i>=0;i--)if(e[i]===t)e.splice(i,1)}function x(e,t){e.uniforms=THREE.UniformsUtils.clone(t.uniforms);e.vertexShader=t.vertexShader;e.fragmentShader=t.fragmentShader}function R(e,t,i,r,n){rt=0;if(r.needsUpdate){if(r.program)dt(r);Q.initMaterial(r,t,i,n);r.needsUpdate=!1}if(r.morphTargets)if(!n.__webglMorphTargetInfluences)n.__webglMorphTargetInfluences=new Float32Array(Q.maxMorphTargets);var o=!1;var a=r.program,s=a.uniforms,l=r.uniforms;if(a!==$){G.useProgram(a);$=a;o=!0}if(r.id!==J){J=r.id;o=!0}if(o||e!==tt){G.uniformMatrix4fv(s.projectionMatrix,e.projectionMatrix.elements);if(e!==tt)tt=e}if(r.skinning)if(G.supportsBoneTextures&&n.useVertexTexture){if(null!==s.boneTexture){var h=N();G.uniform1i(s.boneTexture,h);G.setTexture(n.boneTexture,h)}}else if(null!==s.boneGlobalMatrices)G.uniformMatrix4fv(s.boneGlobalMatrices,n.boneMatrices);if(o){if(i&&r.fog)C(l,i);if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(lt){V(a,t);lt=!1}L(l,ht)}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)w(l,r);if(r instanceof THREE.LineBasicMaterial)H(l,r);else if(r instanceof THREE.LineDashedMaterial){H(l,r);S(l,r)}else if(r instanceof THREE.ParticleBasicMaterial)M(l,r);else if(r instanceof THREE.MeshPhongMaterial)A(l,r);else if(r instanceof THREE.MeshLambertMaterial)D(l,r);else if(r instanceof THREE.MeshDepthMaterial){l.mNear.value=e.near;l.mFar.value=e.far;l.opacity.value=r.opacity}else if(r instanceof THREE.MeshNormalMaterial)l.opacity.value=r.opacity;if(n.receiveShadow&&!r._shadowPass)P(l,t);I(a,r.uniformsList);if(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)if(null!==s.cameraPosition){at.getPositionFromMatrix(e.matrixWorld);G.uniform3f(s.cameraPosition,at.x,at.y,at.z)}if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)if(null!==s.viewMatrix)G.uniformMatrix4fv(s.viewMatrix,e.matrixWorldInverse.elements)}k(s,n);if(null!==s.modelMatrix)G.uniformMatrix4fv(s.modelMatrix,n.matrixWorld.elements);return a}function w(e,t){e.opacity.value=t.opacity;if(Q.gammaInput)e.diffuse.value.copyGammaToLinear(t.color);else e.diffuse.value=t.color;e.map.value=t.map;e.lightMap.value=t.lightMap;e.specularMap.value=t.specularMap;if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}var i;if(t.map)i=t.map;else if(t.specularMap)i=t.specularMap;else if(t.normalMap)i=t.normalMap;else if(t.bumpMap)i=t.bumpMap;if(void 0!==i){var r=i.offset;var n=i.repeat;e.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}e.envMap.value=t.envMap;e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;if(Q.gammaInput)e.reflectivity.value=t.reflectivity;else e.reflectivity.value=t.reflectivity;e.refractionRatio.value=t.refractionRatio;e.combine.value=t.combine;e.useRefract.value=t.envMap&&t.envMap.mapping instanceof THREE.CubeRefractionMapping}function H(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity}function S(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function M(e,t){e.psColor.value=t.color;e.opacity.value=t.opacity;e.size.value=t.size;e.scale.value=G.getDomElement().height/2;e.map.value=t.map}function C(e,t){e.fogColor.value=t.color;if(t instanceof THREE.Fog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t instanceof THREE.FogExp2)e.fogDensity.value=t.density}function A(e,t){e.shininess.value=t.shininess;if(Q.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive);e.specular.value.copyGammaToLinear(t.specular)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive;e.specular.value=t.specular}if(t.wrapAround)e.wrapRGB.value.copy(t.wrapRGB)}function D(e,t){if(Q.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive}if(t.wrapAround)e.wrapRGB.value.copy(t.wrapRGB)}function L(e,t){e.ambientLightColor.value=t.ambient;e.directionalLightColor.value=t.directional.colors;e.directionalLightDirection.value=t.directional.positions;e.pointLightColor.value=t.point.colors;e.pointLightPosition.value=t.point.positions;e.pointLightDistance.value=t.point.distances;e.spotLightColor.value=t.spot.colors;e.spotLightPosition.value=t.spot.positions;e.spotLightDistance.value=t.spot.distances;e.spotLightDirection.value=t.spot.directions;e.spotLightAngleCos.value=t.spot.anglesCos;e.spotLightExponent.value=t.spot.exponents;e.hemisphereLightSkyColor.value=t.hemi.skyColors;e.hemisphereLightGroundColor.value=t.hemi.groundColors;e.hemisphereLightDirection.value=t.hemi.positions}function P(e,t){if(e.shadowMatrix){var i=0;for(var r=0,n=t.length;n>r;r++){var o=t[r];if(o.castShadow){if(o instanceof THREE.SpotLight||o instanceof THREE.DirectionalLight&&!o.shadowCascade){e.shadowMap.value[i]=o.shadowMap;e.shadowMapSize.value[i]=o.shadowMapSize;e.shadowMatrix.value[i]=o.shadowMatrix;e.shadowDarkness.value[i]=o.shadowDarkness;e.shadowBias.value[i]=o.shadowBias;i++}}else;}}}function k(e,t){G.uniformMatrix4fv(e.modelViewMatrix,t._modelViewMatrix.elements);if(e.normalMatrix)G.uniformMatrix3fv(e.normalMatrix,t._normalMatrix.elements)}function N(){var e=rt;if(e>=G.maxTextures)console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+G.maxTextures);rt+=1;return e}function I(e,t){var i,r,n,o,a,s,l,h,c,u,f;for(c=0,u=t.length;u>c;c++){o=e.uniforms[t[c][1]];if(o){i=t[c][0];n=i.type;r=i.value;if("i"===n)G.uniform1i(o,r);else if("f"===n)G.uniform1f(o,r);else if("v2"===n)G.uniform2f(o,r.x,r.y);else if("v3"===n)G.uniform3f(o,r.x,r.y,r.z);else if("v4"===n)G.uniform4f(o,r.x,r.y,r.z,r.w);else if("c"===n)G.uniform3f(o,r.r,r.g,r.b);else if("iv1"===n)G.uniform1iv(o,r);else if("iv"===n)G.uniform3iv(o,r);else if("fv1"===n)G.uniform1fv(o,r);else if("fv"===n)G.uniform3fv(o,r);else if("v2v"===n){if(void 0===i._array)i._array=new Float32Array(2*r.length);for(l=0,h=r.length;h>l;l++){f=2*l;i._array[f]=r[l].x;i._array[f+1]=r[l].y}G.uniform2fv(o,i._array)}else if("v3v"===n){if(void 0===i._array)i._array=new Float32Array(3*r.length);for(l=0,h=r.length;h>l;l++){f=3*l;i._array[f]=r[l].x;i._array[f+1]=r[l].y;i._array[f+2]=r[l].z}G.uniform3fv(o,i._array)}else if("v4v"===n){if(void 0===i._array)i._array=new Float32Array(4*r.length);for(l=0,h=r.length;h>l;l++){f=4*l;i._array[f]=r[l].x;i._array[f+1]=r[l].y;i._array[f+2]=r[l].z;i._array[f+3]=r[l].w}G.uniform4fv(o,i._array)}else if("m4"===n){if(void 0===i._array)i._array=new Float32Array(16);r.flattenToArray(i._array);G.uniformMatrix4fv(o,i._array)}else if("m4v"===n){if(void 0===i._array)i._array=new Float32Array(16*r.length);for(l=0,h=r.length;h>l;l++)r[l].flattenToArrayOffset(i._array,16*l);G.uniformMatrix4fv(o,i._array)}else if("t"===n){a=r;s=N();G.uniform1i(o,s);if(!a)continue;if(a.image instanceof Array&&6===a.image.length)G.setCubeTexture(a,s);else if(a instanceof THREE.WebGLRenderTargetCube)G.setCubeTextureDynamic(a,s);else G.setTexture(a,s)}else if("tv"===n){if(void 0===i._array)i._array=[];for(l=0,h=i.value.length;h>l;l++)i._array[l]=N();G.uniform1iv(o,i._array);for(l=0,h=i.value.length;h>l;l++){a=i.value[l];s=i._array[l];if(a)G.setTexture(a,s);else;}}}else;}}function O(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld);e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function F(e,t,i,r){e[t]=i.r*i.r*r;e[t+1]=i.g*i.g*r;e[t+2]=i.b*i.b*r}function z(e,t,i,r){e[t]=i.r*r;e[t+1]=i.g*r;e[t+2]=i.b*r}function V(e,t){var i,r,n,o,a,s,l,h,c,u=0,f=0,d=0,p=ht,m=p.directional.colors,v=p.directional.positions,g=p.point.colors,E=p.point.positions,y=p.point.distances,T=p.spot.colors,_=p.spot.positions,b=p.spot.distances,x=p.spot.directions,R=p.spot.anglesCos,w=p.spot.exponents,H=p.hemi.skyColors,S=p.hemi.groundColors,M=p.hemi.positions,C=0,A=0,D=0,L=0,P=0,k=0,N=0,I=0,O=0,V=0,B=0,U=0;for(i=0,r=t.length;r>i;i++){n=t[i];if(!n.onlyShadow){o=n.color;l=n.intensity;c=n.distance;if(n instanceof THREE.AmbientLight){if(!n.visible)continue;if(Q.gammaInput){u+=o.r*o.r;f+=o.g*o.g;d+=o.b*o.b}else{u+=o.r;f+=o.g;d+=o.b}}else if(n instanceof THREE.DirectionalLight){P+=1;if(!n.visible)continue;st.getPositionFromMatrix(n.matrixWorld);at.getPositionFromMatrix(n.target.matrixWorld);st.sub(at);st.normalize();if(0===st.x&&0===st.y&&0===st.z)continue;O=3*C;v[O]=st.x;v[O+1]=st.y;v[O+2]=st.z;if(Q.gammaInput)F(m,O,o,l*l);else z(m,O,o,l);C+=1}else if(n instanceof THREE.PointLight){k+=1;if(!n.visible)continue;V=3*A;if(Q.gammaInput)F(g,V,o,l*l);else z(g,V,o,l);at.getPositionFromMatrix(n.matrixWorld);E[V]=at.x;E[V+1]=at.y;E[V+2]=at.z;y[A]=c;A+=1}else if(n instanceof THREE.SpotLight){N+=1;if(!n.visible)continue;B=3*D;if(Q.gammaInput)F(T,B,o,l*l);else z(T,B,o,l);at.getPositionFromMatrix(n.matrixWorld);_[B]=at.x;_[B+1]=at.y;_[B+2]=at.z;b[D]=c;st.copy(at);at.getPositionFromMatrix(n.target.matrixWorld);st.sub(at);st.normalize();x[B]=st.x;x[B+1]=st.y;x[B+2]=st.z;R[D]=Math.cos(n.angle);w[D]=n.exponent;D+=1}else if(n instanceof THREE.HemisphereLight){I+=1;if(!n.visible)continue;st.getPositionFromMatrix(n.matrixWorld);st.normalize();if(0===st.x&&0===st.y&&0===st.z)continue;U=3*L;M[U]=st.x;M[U+1]=st.y;M[U+2]=st.z;a=n.color;s=n.groundColor;if(Q.gammaInput){h=l*l;F(H,U,a,h);F(S,U,s,h)}else{z(H,U,a,l);z(S,U,s,l)}L+=1}}else;}for(i=3*C,r=Math.max(m.length,3*P);r>i;i++)m[i]=0;for(i=3*A,r=Math.max(g.length,3*k);r>i;i++)g[i]=0;for(i=3*D,r=Math.max(T.length,3*N);r>i;i++)T[i]=0;for(i=3*L,r=Math.max(H.length,3*I);r>i;i++)H[i]=0;for(i=3*L,r=Math.max(S.length,3*I);r>i;i++)S[i]=0;p.directional.length=C;p.point.length=A;p.spot.length=D;p.hemi.length=L;p.ambient[0]=u;p.ambient[1]=f;p.ambient[2]=d}function B(e){if(G.supportsBoneTextures&&e&&e.useVertexTexture)return 1024;else{var t=G.maxVertexUniformVectors;var i=Math.floor((t-20)/4);var r=i;if(void 0!==e&&e instanceof THREE.SkinnedMesh){r=Math.min(e.bones.length,r);if(r<e.bones.length)console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")}return r}}function U(e){var t,i,r,n,o,a,s;n=o=a=s=0;for(t=0,i=e.length;i>t;t++){r=e[t];if(!r.onlyShadow){if(r instanceof THREE.DirectionalLight)n++;if(r instanceof THREE.PointLight)o++;if(r instanceof THREE.SpotLight)a++;if(r instanceof THREE.HemisphereLight)s++}else;}return{directional:n,point:o,spot:a,hemi:s}}function j(e){var t,i,r,n=0;for(t=0,i=e.length;i>t;t++){r=e[t];if(r.castShadow){if(r instanceof THREE.SpotLight)n++;if(r instanceof THREE.DirectionalLight&&!r.shadowCascade)n++}else;}return n}console.log("THREE.WebGLRenderer",THREE.REVISION);e=e||{};var W={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var G=new THREE.WebGLRenderer.LowLevelRenderer(e);var X=new THREE.WebGLRenderer.MeshRenderer(G,W);var Y=new THREE.WebGLRenderer.ParticleRenderer(G,W);var q=new THREE.WebGLRenderer.LineRenderer(G,W);var K=new THREE.WebGLRenderer.RibbonRenderer(G,W);var Z=new THREE.WebGLRenderer.ShaderBuilder(G,W);this.autoClear=!0;this.autoClearColor=!0;this.autoClearDepth=!0;this.autoClearStencil=!0;this.sortObjects=!0;this.autoUpdateObjects=!0;this.gammaInput=!1;this.gammaOutput=!1;this.physicallyBasedShading=!1;this.shadowMapEnabled=!1;this.shadowMapAutoUpdate=!0;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapDebug=!1;this.shadowMapCascade=!1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=!0;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info=W;var Q=this,$=null,J=-1,et=null,tt=null,it=0,rt=0,nt=new THREE.Frustum,ot=new THREE.Matrix4,at=(new THREE.Matrix4,new THREE.Vector3),st=new THREE.Vector3,lt=!0,ht={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};this.context=G.getContext();this.domElement=G.getDomElement();this.getPrecision=G.getPrecision;this.getPrecision=G.getPrecision;this.getContext=G.getContext;this.supportsVertexTextures=G.supportsVertexTextures;this.supportsFloatTextures=G.supportsFloatTextures;this.supportsStandardDerivatives=G.supportsStandardDerivatives;this.supportsCompressedTextureS3TC=G.supportsCompressedTextureS3TC;this.getMaxAnisotropy=G.getMaxAnisotropy;this.setSize=G.setSize;this.setViewport=G.setViewport;this.setScissor=G.setScissor;this.enableScissorTest=G.enableScissorTest;this.setDepthWrite=G.setDepthWrite;this.setDepthTest=G.setDepthTest;this.setRenderTarget=G.setRenderTarget;this.setBlending=G.setBlending;this.setTexture=G.setTexture;this.setMaterialFaces=G.setMaterialFaces;this.setFaceCulling=G.setFaceCulling;this.setClearColorHex=G.setClearColorHex;this.setClearColor=G.setClearColor;this.getClearColor=G.getClearColor;this.getClearAlpha=G.getClearAlpha;this.clear=G.clear;this.clearTarget=G.clearTarget;this.addPostPlugin=function(e){e.init(this);this.renderPluginsPost.push(e)};this.addPrePlugin=function(e){e.init(this);this.renderPluginsPre.push(e)};this.updateShadowMap=function(e,t){$=null;et=-1;J=-1;lt=!0;G.resetState();this.shadowMapPlugin.update(e,t)};var ct=function(e){var t=e.target;t.removeEventListener("dispose",ct);ft(t);Q.info.memory.geometries--};var ut=function(e){var t=e.target;t.removeEventListener("dispose",ut);dt(t)};var ft=function(e){var i,r;e.__webglInit=void 0;if(void 0!==e.__webglVertexBuffer)G.deleteBuffer(e.__webglVertexBuffer);if(void 0!==e.__webglNormalBuffer)G.deleteBuffer(e.__webglNormalBuffer);if(void 0!==e.__webglTangentBuffer)G.deleteBuffer(e.__webglTangentBuffer);if(void 0!==e.__webglColorBuffer)G.deleteBuffer(e.__webglColorBuffer);if(void 0!==e.__webglUVBuffer)G.deleteBuffer(e.__webglUVBuffer);if(void 0!==e.__webglUV2Buffer)G.deleteBuffer(e.__webglUV2Buffer);if(void 0!==e.__webglSkinIndicesBuffer)G.deleteBuffer(e.__webglSkinIndicesBuffer);if(void 0!==e.__webglSkinWeightsBuffer)G.deleteBuffer(e.__webglSkinWeightsBuffer);if(void 0!==e.__webglFaceBuffer)G.deleteBuffer(e.__webglFaceBuffer);if(void 0!==e.__webglLineBuffer)G.deleteBuffer(e.__webglLineBuffer);if(void 0!==e.__webglLineDistanceBuffer)G.deleteBuffer(e.__webglLineDistanceBuffer);if(void 0!==e.geometryGroups)for(var n in e.geometryGroups){var o=e.geometryGroups[n];if(void 0!==o.numMorphTargets)for(i=0,r=o.numMorphTargets;r>i;i++)G.deleteBuffer(o.__webglMorphTargetsBuffers[i]);if(void 0!==o.numMorphNormals)for(i=0,r=o.numMorphNormals;r>i;i++)G.deleteBuffer(o.__webglMorphNormalsBuffers[i]);t(o)}t(e)};var dt=function(e){var t=e.program;if(void 0!==t){e.program=void 0;Z.removeProgram(t)}};this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer)e.__webglVertexBuffer=G.createBuffer();if(e.hasNormals&&!e.__webglNormalBuffer)e.__webglNormalBuffer=G.createBuffer();if(e.hasUvs&&!e.__webglUvBuffer)e.__webglUvBuffer=G.createBuffer();if(e.hasColors&&!e.__webglColorBuffer)e.__webglColorBuffer=G.createBuffer();if(e.hasPositions){G.setDynamicArrayBuffer(e.__webglVertexBuffer,e.positionArray);G.setFloatAttribute(t.attributes.position,e.__webglVertexBuffer,3,0)}if(e.hasNormals){if(i.shading===THREE.FlatShading){var r,n,o,a,s,l,h,c,u,f,d,p,m,v,g=3*e.count;for(v=0;g>v;v+=9){m=e.normalArray;a=m[v];h=m[v+1];f=m[v+2];s=m[v+3];c=m[v+4];d=m[v+5];l=m[v+6];u=m[v+7];p=m[v+8];r=(a+s+l)/3;n=(h+c+u)/3;o=(f+d+p)/3;m[v]=r;m[v+1]=n;m[v+2]=o;m[v+3]=r;m[v+4]=n;m[v+5]=o;m[v+6]=r;m[v+7]=n;m[v+8]=o}}G.setDynamicArrayBuffer(e.__webglNormalBuffer,e.normalArray);G.setFloatAttribute(t.attributes.normal,e.__webglNormalBuffer,3,0)}if(e.hasUvs&&i.map){G.setDynamicArrayBuffer(e.__webglUvBuffer,e.uvArray);G.setFloatAttribute(t.attributes.uv,e.__webglUvBuffer,2,0)}if(e.hasColors&&i.vertexColors!==THREE.NoColors){G.setDynamicArrayBuffer(e.__webglColorBuffer,e.colorArray);G.setFloatAttribute(t.attributes.color,e.__webglColorBuffer,3,0)}G.drawTriangles(e.count);e.count=0};this.renderBufferDirect=function(e,t,i,r,n,o){if(r.visible!==!1){var a,s,l;var h,c,u,f;a=R(e,t,i,r,o);s=a.attributes;l=n.attributes;var d=!1,p=r.wireframe?1:0,m=16777215*n.id+2*a.id+p;if(m!==et){et=m;d=!0}if(d)G.disableAttributes();if(o instanceof THREE.Mesh){var v=l["index"];if(v){var g=n.offsets;if(g.length>1)d=!0;for(var E=0,y=g.length;y>E;E++){var T=g[E].index;if(d)for(c in l)if("index"!==c){u=s[c];h=l[c];f=h.itemSize;if(u>=0)G.setFloatAttribute(u,h.buffer,f,4*T*f)}else;G.drawTriangleElements(v.buffer,g[E].count,2*g[E].start);Q.info.render.calls++;Q.info.render.vertices+=g[E].count;Q.info.render.faces+=g[E].count/3}}else{if(d)for(c in l){u=s[c];h=l[c];f=h.itemSize;if(u>=0)G.setFloatAttribute(u,h.buffer,f,0)}var _=n.attributes["position"];G.drawTriangles(_.numItems/3);Q.info.render.calls++;Q.info.render.vertices+=_.numItems/3;Q.info.render.faces+=_.numItems/3/3}}else if(o instanceof THREE.ParticleSystem){if(d){for(c in l){u=s[c];h=l[c];f=h.itemSize;if(u>=0)G.setFloatAttribute(u,h.buffer,f,0)}var _=l["position"];G.drawPoints(_.numItems/3);Q.info.render.calls++;Q.info.render.points+=_.numItems/3}}else if(o instanceof THREE.Line)if(d){for(c in l){u=s[c];h=l[c];f=h.itemSize;if(u>=0)G.setFloatAttribute(u,h.buffer,f,0)}var _=l["position"];G.setLineWidth(r.linewidth);G.drawLineStrip(_.numItems/3);Q.info.render.calls++;Q.info.render.points+=_.numItems}}};this.renderBuffer=function(e,t,i,r,n,a){if(r.visible!==!1){var s,l,h,c,u;s=R(e,t,i,r,a);l=s.attributes;var f=!1,d=r.wireframe?1:0,p=16777215*n.id+2*s.id+d;if(p!==et){et=p;f=!0}if(f)G.disableAttributes();if(!r.morphTargets&&l.position>=0){if(f)G.setFloatAttribute(l.position,n.__webglVertexBuffer,3,0)}else if(a.morphTargetBase)o(r,n,a);if(f){if(n.__webglCustomAttributesList)for(c=0,u=n.__webglCustomAttributesList.length;u>c;c++){h=n.__webglCustomAttributesList[c];if(l[h.buffer.belongsToAttribute]>=0)G.setFloatAttribute(l[h.buffer.belongsToAttribute],h.buffer,h.size,0)}if(l.color>=0)G.setFloatAttribute(l.color,n.__webglColorBuffer,3,0);if(l.normal>=0)G.setFloatAttribute(l.normal,n.__webglNormalBuffer,3,0);if(l.tangent>=0)G.setFloatAttribute(l.tangent,n.__webglTangentBuffer,4,0);if(l.uv>=0)G.setFloatAttribute(l.uv,n.__webglUVBuffer,2,0);if(l.uv2>=0)G.setFloatAttribute(l.uv2,n.__webglUV2Buffer,2,0);if(r.skinning&&l.skinIndex>=0&&l.skinWeight>=0){G.setFloatAttribute(l.skinIndex,n.__webglSkinIndicesBuffer,4,0);G.setFloatAttribute(l.skinWeight,n.__webglSkinWeightsBuffer,4,0)}if(l.lineDistance>=0)G.setFloatAttribute(l.lineDistance,n.__webglLineDistanceBuffer,1,0)}if(a instanceof THREE.Mesh){if(r.wireframe){G.setLineWidth(r.wireframeLinewidth);G.drawLineElements(n.__webglLineBuffer,n.__webglLineCount,0)}else G.drawTriangleElements(n.__webglFaceBuffer,n.__webglFaceCount,0);Q.info.render.calls++;Q.info.render.vertices+=n.__webglFaceCount;Q.info.render.faces+=n.__webglFaceCount/3}else if(a instanceof THREE.Line){G.setLineWidth(r.linewidth);if(a.type===THREE.LineStrip)G.drawLineStrip(n.__webglLineCount);else G.drawLines(n.__webglLineCount);Q.info.render.calls++}else if(a instanceof THREE.ParticleSystem){G.drawPoints(n.__webglParticleCount);Q.info.render.calls++;Q.info.render.points+=n.__webglParticleCount}else if(a instanceof THREE.Ribbon){G.drawTriangleStrip(n.__webglVertexCount);Q.info.render.calls++}}};this.render=function(e,t,i,r){if(t instanceof THREE.Camera!=!1){var n,o,s,d,p,m=e.__lights,v=e.fog;J=-1;lt=!0;if(e.autoUpdate===!0)e.updateMatrixWorld();if(void 0===t.parent)t.updateMatrixWorld();t.matrixWorldInverse.getInverse(t.matrixWorld);ot.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);nt.setFromMatrix(ot);if(this.autoUpdateObjects)this.initWebGLObjects(e);l(this.renderPluginsPre,e,t);Q.info.render.calls=0;Q.info.render.vertices=0;Q.info.render.faces=0;Q.info.render.points=0;G.setRenderTarget(i);if(this.autoClear||r)this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);p=e.__webglObjects;for(n=0,o=p.length;o>n;n++){s=p[n];d=s.object;s.id=n;s.render=!1;if(d.visible)if(!(d instanceof THREE.Mesh||d instanceof THREE.ParticleSystem)||!d.frustumCulled||nt.intersectsObject(d)){O(d,t);f(s);s.render=!0;if(this.sortObjects===!0)if(null!==d.renderDepth)s.z=d.renderDepth;else{at.getPositionFromMatrix(d.matrixWorld);at.applyProjection(ot);s.z=at.z}}}if(this.sortObjects)p.sort(a);p=e.__webglObjectsImmediate;for(n=0,o=p.length;o>n;n++){s=p[n];d=s.object;if(d.visible){O(d,t);u(s)}}if(e.overrideMaterial){var g=e.overrideMaterial;G.setBlending(g.blending,g.blendEquation,g.blendSrc,g.blendDst);G.setDepthTest(g.depthTest);G.setDepthWrite(g.depthWrite);G.setPolygonOffset(g.polygonOffset,g.polygonOffsetFactor,g.polygonOffsetUnits);h(e.__webglObjects,!1,"",t,m,v,!0,g);c(e.__webglObjectsImmediate,"",t,m,v,!1,g)}else{var g=null;G.setBlending(THREE.NoBlending);h(e.__webglObjects,!0,"opaque",t,m,v,!1,g);c(e.__webglObjectsImmediate,"opaque",t,m,v,!1,g);h(e.__webglObjects,!1,"transparent",t,m,v,!0,g);c(e.__webglObjectsImmediate,"transparent",t,m,v,!0,g)}l(this.renderPluginsPost,e,t);if(i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter)G.updateRenderTargetMipmap(i);G.setDepthTest(!0);G.setDepthWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")};this.renderImmediateObject=function(e,t,i,r,n){var o=R(e,t,i,r,n);et=-1;G.setMaterialFaces(r);if(n.immediateRenderCallback)n.immediateRenderCallback(o,G.getContext(),nt);else n.render(function(e){Q.renderBufferImmediate(e,o,r)})};this.initWebGLObjects=function(e){if(!e.__webglObjects){e.__webglObjects=[];e.__webglObjectsImmediate=[];e.__webglSprites=[];e.__webglFlares=[]}for(;e.__objectsAdded.length;){p(e.__objectsAdded[0],e);e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){T(e.__objectsRemoved[0],e);e.__objectsRemoved.splice(0,1)}for(var t=0,i=e.__webglObjects.length;i>t;t++)g(e.__webglObjects[t].object)};this.initMaterial=function(e,t,i,r){e.addEventListener("dispose",ut);var n,o,a,s,l,h,c;if(e instanceof THREE.MeshDepthMaterial)c="depth";else if(e instanceof THREE.MeshNormalMaterial)c="normal";else if(e instanceof THREE.MeshBasicMaterial)c="basic";else if(e instanceof THREE.MeshLambertMaterial)c="lambert";else if(e instanceof THREE.MeshPhongMaterial)c="phong";else if(e instanceof THREE.LineBasicMaterial)c="basic";
else if(e instanceof THREE.LineDashedMaterial)c="dashed";else if(e instanceof THREE.ParticleBasicMaterial)c="particle_basic";if(c)x(e,THREE.ShaderLib[c]);s=U(t);h=j(t);l=B(r);a={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:l,useVertexTexture:G.supportsBoneTextures&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:h,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide,gammaInput:this.gammaInput,gammaOutput:this.gammaOutput,physicallyBasedShading:this.physicallyBasedShading};e.program=Z.buildProgram(c,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,a);var u=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var f,d="morphTarget";for(o=0;o<this.maxMorphTargets;o++){f=d+o;if(u[f]>=0)e.numSupportedMorphTargets++}}if(e.morphNormals){e.numSupportedMorphNormals=0;var f,d="morphNormal";for(o=0;o<this.maxMorphNormals;o++){f=d+o;if(u[f]>=0)e.numSupportedMorphNormals++}}e.uniformsList=[];for(n in e.uniforms)e.uniformsList.push([e.uniforms[n],n])};this.shadowMapPlugin=new THREE.ShadowMapPlugin;this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new THREE.SpritePlugin);this.addPostPlugin(new THREE.LensFlarePlugin)};