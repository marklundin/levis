THREE.EditorControls=function(e,t){function i(e){l.enabled!==!1&&(e.preventDefault(),0===e.button?u=c.ROTATE:1===e.button?u=c.ZOOM:2===e.button&&(u=c.PAN),t.addEventListener("mousemove",r,!1),t.addEventListener("mouseup",n,!1),t.addEventListener("mouseout",n,!1))}function r(e){if(l.enabled!==!1){e.preventDefault();var t=e.movementX||e.webkitMovementX||e.mozMovementX||e.oMovementX||0,i=e.movementY||e.webkitMovementY||e.mozMovementY||e.oMovementY||0;u===c.ROTATE?l.rotate(new THREE.Vector3(.005*-t,.005*-i,0)):u===c.ZOOM?l.zoom(new THREE.Vector3(0,0,i)):u===c.PAN&&l.pan(new THREE.Vector3(-t,i,0))}}function n(){l.enabled!==!1&&(t.removeEventListener("mousemove",r,!1),t.removeEventListener("mouseup",n,!1),t.removeEventListener("mouseout",n,!1),u=c.NONE)}function o(e){var t=0;e.wheelDelta?t=-e.wheelDelta:e.detail&&(t=10*e.detail),l.zoom(new THREE.Vector3(0,0,t))}function a(e){if(l.enabled!==!1){var t=e.touches;switch(t.length){case 2:var i=t[0].pageX-t[1].pageX,r=t[0].pageY-t[1].pageY;v=Math.sqrt(i*i+r*r)}g.set(t[0].pageX,t[0].pageY,0)}}function s(e){if(l.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=e.touches;switch(m.set(t[0].pageX,t[0].pageY,0),t.length){case 1:l.rotate(m.sub(g).multiplyScalar(-.005));break;case 2:var i=t[0].pageX-t[1].pageX,r=t[0].pageY-t[1].pageY,n=Math.sqrt(i*i+r*r);l.zoom(new THREE.Vector3(0,0,v-n)),v=n;break;case 3:l.pan(m.sub(g).setX(-m.x))}g.set(t[0].pageX,t[0].pageY,0)}}t=void 0!==t?t:document,this.enabled=!0;var l=this,h=new THREE.Vector3,c={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},u=c.NONE,d=new THREE.Vector3,p=new THREE.Matrix3,f={type:"change"};this.focus=function(t){d.getPositionFromMatrix(t.matrixWorld),e.lookAt(d),l.dispatchEvent(f)},this.pan=function(t){p.getNormalMatrix(e.matrix),t.applyMatrix3(p),t.multiplyScalar(.001*h.copy(d).sub(e.position).length()),e.position.add(t),d.add(t),l.dispatchEvent(f)},this.zoom=function(t){p.getNormalMatrix(e.matrix),t.applyMatrix3(p),t.multiplyScalar(.001*h.copy(d).sub(e.position).length()),e.position.add(t),l.dispatchEvent(f)},this.rotate=function(t){h.copy(e.position).sub(d);var i=Math.atan2(h.x,h.z),r=Math.atan2(Math.sqrt(h.x*h.x+h.z*h.z),h.y);i+=t.x,r+=t.y;var n=1e-6;r=Math.max(n,Math.min(Math.PI-n,r));var o=h.length();h.x=o*Math.sin(r)*Math.sin(i),h.y=o*Math.cos(r),h.z=o*Math.sin(r)*Math.cos(i),e.position.copy(d).add(h),e.lookAt(d),l.dispatchEvent(f)},t.addEventListener("contextmenu",function(e){e.preventDefault()},!1),t.addEventListener("mousedown",i,!1),t.addEventListener("mousewheel",o,!1),t.addEventListener("DOMMouseScroll",o,!1);var m=new THREE.Vector3,g=new THREE.Vector3,v=null;t.addEventListener("touchstart",a,!1),t.addEventListener("touchmove",s,!1)},THREE.EditorControls.prototype=Object.create(THREE.EventDispatcher.prototype);