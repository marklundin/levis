THREE.PathControls=function(e,t){function i(e){var t=e%l;return t>=0?t:t+l}function r(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}function n(e,t){return function(){t.apply(e,arguments)}}function o(e,t,i,r){var n,o,a={name:i,fps:.6,length:r,hierarchy:[]},s=t.getControlPointsArray(),l=t.getLength(),h=s.length,c=0,u=0,d=h-1;for(o={parent:-1,keys:[]},o.keys[u]={time:0,pos:s[u],rot:[0,0,0,1],scl:[1,1,1]},o.keys[d]={time:r,pos:s[d],rot:[0,0,0,1],scl:[1,1,1]},n=1;h-1>n;n++)c=r*l.chunks[n]/l.total,o.keys[n]={time:c,pos:s[n]};return a.hierarchy[0]=o,THREE.AnimationHandler.add(a),new THREE.Animation(e,i,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function a(e,t){var i,r,n,o=new THREE.Geometry;for(i=0;i<e.points.length*t;i++)r=i/(e.points.length*t),n=e.getPoint(r),o.vertices[i]=new THREE.Vector3(n.x,n.y,n.z);return o}function s(e,t){var i=a(t,10),r=a(t,10),n=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),o=new THREE.Line(i,n),s=new THREE.ParticleSystem(r,new THREE.ParticleBasicMaterial({color:16755200,size:3}));o.scale.set(1,1,1),e.add(o),s.scale.set(1,1,1),e.add(s);for(var l,h=new THREE.SphereGeometry(1,16,8),c=new THREE.MeshBasicMaterial({color:65280}),u=0;u<t.points.length;u++)l=new THREE.Mesh(h,c),l.position.copy(t.points[u]),e.add(l)}this.object=e,this.domElement=void 0!==t?t:document,this.id="PathControls"+THREE.PathControlsIdCounter++,this.duration=1e4,this.waypoints=[],this.useConstantSpeed=!0,this.resamplingCoef=50,this.debugPath=new THREE.Object3D,this.debugDummy=new THREE.Object3D,this.animationParent=new THREE.Object3D,this.lookSpeed=.005,this.lookVertical=!0,this.lookHorizontal=!0,this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.target=new THREE.Object3D,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0;var l=2*Math.PI;this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.update=function(e){var t,n;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed*e),this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed*e),this.lon=Math.max(0,Math.min(360,this.lon)),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.phi=i(this.phi),t=this.verticalAngleMap.srcRange,n=this.verticalAngleMap.dstRange;var o=THREE.Math.mapLinear(this.phi,t[0],t[1],n[0],n[1]),a=n[1]-n[0],s=(o-n[0])/a;this.phi=r(s)*a+n[0],t=this.horizontalAngleMap.srcRange,n=this.horizontalAngleMap.dstRange;var l=THREE.Math.mapLinear(this.theta,t[0],t[1],n[0],n[1]),h=n[1]-n[0],c=(l-n[0])/h;this.theta=r(c)*h+n[0];var u=this.target.position;this.object.position,u.x=100*Math.sin(this.phi)*Math.cos(this.theta),u.y=100*Math.cos(this.phi),u.z=100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(this.target.position)},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.init=function(){if(this.spline=new THREE.Spline,this.spline.initFromArray(this.waypoints),this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef),this.createDebugDummy){var e=new THREE.MeshLambertMaterial({color:30719}),t=new THREE.MeshLambertMaterial({color:65280}),i=new THREE.CubeGeometry(10,10,20),r=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(i,e);var a=new THREE.Mesh(r,t);a.position.set(0,10,0),this.animation=o(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.object),this.animationParent.add(this.target),this.animationParent.add(a)}else this.animation=o(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object);this.createDebugPath&&s(this.debugPath,this.spline),this.domElement.addEventListener("mousemove",n(this,this.onMouseMove),!1)},this.handleResize()},THREE.PathControlsIdCounter=0;