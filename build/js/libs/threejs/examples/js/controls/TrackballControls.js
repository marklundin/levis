THREE.TrackballControls=function(e,t){function i(e){if(u.enabled!==!1){window.removeEventListener("keydown",i);m=p;if(p===f.NONE)if(e.keyCode===u.keys[f.ROTATE]&&!u.noRotate)p=f.ROTATE;else if(e.keyCode===u.keys[f.ZOOM]&&!u.noZoom)p=f.ZOOM;else if(e.keyCode===u.keys[f.PAN]&&!u.noPan)p=f.PAN}}function r(){if(u.enabled!==!1){p=m;window.addEventListener("keydown",i,!1)}}function n(e){if(u.enabled!==!1){e.preventDefault();e.stopPropagation();if(p===f.NONE)p=e.button;if(p===f.ROTATE&&!u.noRotate){g=u.getMouseProjectionOnBall(e.clientX,e.clientY);E.copy(g)}else if(p===f.ZOOM&&!u.noZoom){y=u.getMouseOnScreen(e.clientX,e.clientY);T.copy(y)}else if(p===f.PAN&&!u.noPan){x=u.getMouseOnScreen(e.clientX,e.clientY);R.copy(x)}document.addEventListener("mousemove",o,!1);document.addEventListener("mouseup",a,!1)}}function o(e){if(u.enabled!==!1){e.preventDefault();e.stopPropagation();if(p===f.ROTATE&&!u.noRotate)E=u.getMouseProjectionOnBall(e.clientX,e.clientY);else if(p===f.ZOOM&&!u.noZoom)T=u.getMouseOnScreen(e.clientX,e.clientY);else if(p===f.PAN&&!u.noPan)R=u.getMouseOnScreen(e.clientX,e.clientY)}}function a(e){if(u.enabled!==!1){e.preventDefault();e.stopPropagation();p=f.NONE;document.removeEventListener("mousemove",o);document.removeEventListener("mouseup",a)}}function s(e){if(u.enabled!==!1){e.preventDefault();e.stopPropagation();var t=0;if(e.wheelDelta)t=e.wheelDelta/40;else if(e.detail)t=-e.detail/3;y.y+=.01*t}}function l(e){if(u.enabled!==!1)switch(e.touches.length){case 1:p=f.TOUCH_ROTATE;g=E=u.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:p=f.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX;var i=e.touches[0].pageY-e.touches[1].pageY;b=_=Math.sqrt(t*t+i*i);break;case 3:p=f.TOUCH_PAN;x=R=u.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:p=f.NONE}}function h(e){if(u.enabled!==!1){e.preventDefault();e.stopPropagation();switch(e.touches.length){case 1:E=u.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX;var i=e.touches[0].pageY-e.touches[1].pageY;b=Math.sqrt(t*t+i*i);break;case 3:R=u.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:p=f.NONE}}}function c(e){if(u.enabled!==!1){switch(e.touches.length){case 1:g=E=u.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:_=b=0;break;case 3:x=R=u.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)}p=f.NONE}}var u=this;var f={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=e;this.domElement=void 0!==t?t:document;this.enabled=!0;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.noRotate=!1;this.noZoom=!1;this.noPan=!1;this.noRoll=!1;this.staticMoving=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=1/0;this.keys=[65,83,68];this.target=new THREE.Vector3;var d=new THREE.Vector3;var p=f.NONE,m=f.NONE,v=new THREE.Vector3,g=new THREE.Vector3,E=new THREE.Vector3,y=new THREE.Vector2,T=new THREE.Vector2,_=0,b=0,x=new THREE.Vector2,R=new THREE.Vector2;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var w={type:"change"};this.handleResize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight}else this.screen=this.domElement.getBoundingClientRect()};this.handleEvent=function(e){if("function"==typeof this[e.type])this[e.type](e)};this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-u.screen.left)/u.screen.width,(t-u.screen.top)/u.screen.height)};this.getMouseProjectionOnBall=function(e,t){var i=new THREE.Vector3((e-.5*u.screen.width-u.screen.left)/(.5*u.screen.width),(.5*u.screen.height+u.screen.top-t)/(.5*u.screen.height),0);var r=i.length();if(u.noRoll)if(r<Math.SQRT1_2)i.z=Math.sqrt(1-r*r);else i.z=.5/r;else if(r>1)i.normalize();else i.z=Math.sqrt(1-r*r);v.copy(u.object.position).sub(u.target);var n=u.object.up.clone().setLength(i.y);n.add(u.object.up.clone().cross(v).setLength(i.x));n.add(v.setLength(i.z));return n};this.rotateCamera=function(){var e=Math.acos(g.dot(E)/g.length()/E.length());if(e){var t=(new THREE.Vector3).crossVectors(g,E).normalize(),i=new THREE.Quaternion;e*=u.rotateSpeed;i.setFromAxisAngle(t,-e);v.applyQuaternion(i);u.object.up.applyQuaternion(i);E.applyQuaternion(i);if(u.staticMoving)g.copy(E);else{i.setFromAxisAngle(t,e*(u.dynamicDampingFactor-1));g.applyQuaternion(i)}}};this.zoomCamera=function(){if(p===f.TOUCH_ZOOM){var e=_/b;_=b;v.multiplyScalar(e)}else{var e=1+(T.y-y.y)*u.zoomSpeed;if(1!==e&&e>0){v.multiplyScalar(e);if(u.staticMoving)y.copy(T);else y.y+=(T.y-y.y)*this.dynamicDampingFactor}}};this.panCamera=function(){var e=R.clone().sub(x);if(e.lengthSq()){e.multiplyScalar(v.length()*u.panSpeed);var t=v.clone().cross(u.object.up).setLength(e.x);t.add(u.object.up.clone().setLength(e.y));u.object.position.add(t);u.target.add(t);if(u.staticMoving)x=R;else x.add(e.subVectors(R,x).multiplyScalar(u.dynamicDampingFactor))}};this.checkDistances=function(){if(!u.noZoom||!u.noPan){if(v.lengthSq()>u.maxDistance*u.maxDistance)u.object.position.addVectors(u.target,v.setLength(u.maxDistance));if(v.lengthSq()<u.minDistance*u.minDistance)u.object.position.addVectors(u.target,v.setLength(u.minDistance))}};this.update=function(){v.subVectors(u.object.position,u.target);if(!u.noRotate)u.rotateCamera();if(!u.noZoom)u.zoomCamera();if(!u.noPan)u.panCamera();u.object.position.addVectors(u.target,v);u.checkDistances();u.object.lookAt(u.target);if(d.distanceToSquared(u.object.position)>0){u.dispatchEvent(w);d.copy(u.object.position)}};this.reset=function(){p=f.NONE;m=f.NONE;u.target.copy(u.target0);u.object.position.copy(u.position0);u.object.up.copy(u.up0);v.subVectors(u.object.position,u.target);u.object.lookAt(u.target);u.dispatchEvent(w);d.copy(u.object.position)};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1);this.domElement.addEventListener("mousedown",n,!1);this.domElement.addEventListener("mousewheel",s,!1);this.domElement.addEventListener("DOMMouseScroll",s,!1);this.domElement.addEventListener("touchstart",l,!1);this.domElement.addEventListener("touchend",c,!1);this.domElement.addEventListener("touchmove",h,!1);window.addEventListener("keydown",i,!1);window.addEventListener("keyup",r,!1);this.handleResize()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);