THREE.MTLLoader=function(e,t,i){this.baseUrl=e;this.options=t;this.crossOrigin=i};THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(e){function t(t){if(200===t.target.status||0===t.target.status){var r=i.parse(t.target.responseText);i.dispatchEvent({type:"load",content:r})}else i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]",response:t.target.responseText})}var i=this;var r=new XMLHttpRequest;r.addEventListener("load",t,!1);r.addEventListener("progress",function(e){i.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1);r.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1);r.open("GET",e,!0);r.send(null)},parse:function(e){var t=e.split("\n");var i={};var r=/\s+/;var n={};for(var o=0;o<t.length;o++){var a=t[o];a=a.trim();if(0!==a.length&&"#"!==a.charAt(0)){var s=a.indexOf(" ");var l=s>=0?a.substring(0,s):a;l=l.toLowerCase();var h=s>=0?a.substring(s+1):"";h=h.trim();if("newmtl"===l){i={name:h};n[h]=i}else if(i)if("ka"===l||"kd"===l||"ks"===l){var c=h.split(r,3);i[l]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else i[l]=h}else;}var u=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.options);u.setMaterials(n);return u}};THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e;this.options=t;this.materialsInfo={};this.materials={};this.materialsArray=[];this.nameLookup={};this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide;this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping};THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setMaterials:function(e){this.materialsInfo=this.convert(e);this.materials={};this.materialsArray=[];this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var r=e[i];var n={};t[i]=n;for(var o in r){var a=!0;var s=r[o];var l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":if(this.options&&this.options.normalizeRGB)s=[s[0]/255,s[1]/255,s[2]/255];if(this.options&&this.options.ignoreZeroRGBs)if(0===s[0]&&0===s[1]&&0===s[1])a=!1;break;case"d":if(this.options&&this.options.invertTransparency)s=1-s}if(a)n[l]=s}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo){this.materialsArray[e]=this.create(t);this.nameLookup[t]=e;e++}return this.materialsArray},create:function(e){if(void 0===this.materials[e])this.createMaterial_(e);return this.materials[e]},createMaterial_:function(e){var t=this.materialsInfo[e];var i={name:e,side:this.side};for(var r in t){var n=t[r];switch(r.toLowerCase()){case"kd":i["diffuse"]=(new THREE.Color).setRGB(n[0],n[1],n[2]);break;case"ka":i["ambient"]=(new THREE.Color).setRGB(n[0],n[1],n[2]);break;case"ks":i["specular"]=(new THREE.Color).setRGB(n[0],n[1],n[2]);break;case"map_kd":i["map"]=this.loadTexture(this.baseUrl+n);i["map"].wrapS=this.wrap;i["map"].wrapT=this.wrap;break;case"ns":i["shininess"]=n;break;case"d":if(1>n){i["transparent"]=!0;i["opacity"]=n}}}if(i["diffuse"]){if(!i["ambient"])i["ambient"]=i["diffuse"];i["color"]=i["diffuse"]}this.materials[e]=new THREE.MeshPhongMaterial(i);return this.materials[e]},loadTexture:function(e,t,i,r){var n=/\.dds$/i.test(e);if(n)var o=THREE.ImageUtils.loadCompressedTexture(e,t,i,r);else{var a=new Image;var o=new THREE.Texture(a,t);var s=new THREE.ImageLoader;s.crossOrigin=this.crossOrigin;s.load(e,function(e){o.image=THREE.MTLLoader.ensurePowerOfTwo_(e);o.needsUpdate=!0;if(i)i(o)})}return o}};THREE.MTLLoader.ensurePowerOfTwo_=function(e){if(!THREE.MTLLoader.isPowerOfTwo_(e.width)||!THREE.MTLLoader.isPowerOfTwo_(e.height)){var t=document.createElement("canvas");t.width=THREE.MTLLoader.nextHighestPowerOfTwo_(e.width);t.height=THREE.MTLLoader.nextHighestPowerOfTwo_(e.height);var i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height);return t}return e};THREE.MTLLoader.isPowerOfTwo_=function(e){return 0===(e&e-1)};THREE.MTLLoader.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;32>t;t<<=1)e|=e>>t;return e+1};THREE.EventDispatcher.prototype.apply(THREE.MTLLoader.prototype);