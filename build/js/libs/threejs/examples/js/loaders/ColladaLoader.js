THREE.ColladaLoader=function(){function e(e,i,r){var n=0;if(document.implementation&&document.implementation.createDocument){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState){if(0==o.status||200==o.status)if(o.responseXML)Ht=i,t(o.responseXML,void 0,e);else if(o.responseText){Ht=i;var a=new DOMParser,s=a.parseFromString(o.responseText,"application/xml");t(s,void 0,e)}else console.error("ColladaLoader: Empty or non-existing file ("+e+")")}else 3==o.readyState&&r&&(0==n&&(n=o.getResponseHeader("Content-Length")),r({total:n,loaded:o.responseText.length}))},o.open("GET",e,!0),o.send(null)}else alert("Don't know how to parse XML!")}function t(e,t,i){if(wt=e,t=t||Ht,void 0!==i){var s=i.split("/");s.pop(),Tt=(s.length<1?".":s.join("/"))+"/"}r(),dt(),Mt=n("//dae:library_images/dae:image",b,"image"),Pt=n("//dae:library_materials/dae:material",U,"material"),kt=n("//dae:library_effects/dae:effect",X,"effect"),Dt=n("//dae:library_geometries/dae:geometry",P,"geometry"),Lt=n(".//dae:library_cameras/dae:camera",$,"camera"),Nt=n(".//dae:library_lights/dae:light",et,"light"),At=n("//dae:library_controllers/dae:controller",x,"controller"),Ct=n("//dae:library_animations/dae:animation",q,"animation"),_t=n(".//dae:library_visual_scenes/dae:visual_scene",H,"visual_scene"),bt=[],xt=[],Et=o(),Rt=new THREE.Object3D;for(var l=0;l<Et.nodes.length;l++)Rt.add(p(Et.nodes[l]));Rt.scale.multiplyScalar(zt),a();var h={scene:Rt,morphs:bt,skins:xt,animations:yt,dae:{images:Mt,materials:Pt,cameras:Lt,lights:Nt,effects:kt,geometries:Dt,controllers:At,animations:Ct,visualScenes:_t,scene:Et}};return t&&t(h),h}function i(e){Ot=e}function r(){var e=wt.evaluate("//dae:asset",wt,rt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),t=e.iterateNext();if(t&&t.childNodes)for(var i=0;i<t.childNodes.length;i++){var r=t.childNodes[i];switch(r.nodeName){case"unit":var n=r.getAttribute("meter");n&&(zt=parseFloat(n));break;case"up_axis":Ft=r.textContent.charAt(0)}}}function n(e,t,i){for(var r=wt.evaluate(e,wt,rt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),n={},o=r.iterateNext(),a=0;o;){var s=(new t).parse(o);s.id&&0!=s.id.length||(s.id=i+a++),n[s.id]=s,o=r.iterateNext()}return n}function o(){var e=wt.evaluate(".//dae:scene/dae:instance_visual_scene",wt,rt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext();if(e){var t=e.getAttribute("url").replace(/^#/,"");return _t[t.length>0?t:"visual_scene0"]}return null}function a(){yt=[],s(Rt)}function s(e){var t=Et.getChildById(e.name,!0),i=null;if(t&&t.keys){i={fps:60,hierarchy:[{node:t,keys:t.keys,sids:t.sids}],node:e,name:"animation_"+e.name,length:0},yt.push(i);for(var r=0,n=t.keys.length;n>r;r++)i.length=Math.max(i.length,t.keys[r].time)}else i={hierarchy:[{keys:[],sids:[]}]};for(var r=0,n=e.children.length;n>r;r++)for(var o=s(e.children[r]),a=0,l=o.hierarchy.length;l>a;a++)i.hierarchy.push({keys:[],sids:[]});return i}function l(){var e=1e6,t=-e,i=0;for(var r in Ct)for(var n=Ct[r],o=0;o<n.sampler.length;o++){var a=n.sampler[o];a.create(),e=Math.min(e,a.startTime),t=Math.max(t,a.endTime),i=Math.max(i,a.input.length)}return{start:e,end:t,frames:i}}function h(e,t){var i=t instanceof C?At[t.url]:t;if(!i||!i.morph)return console.log("could not find morph controller!"),void 0;for(var r=i.morph,n=0;n<r.targets.length;n++){var o=r.targets[n],a=Dt[o];if(a.mesh&&a.mesh.primitives&&a.mesh.primitives.length){var s=a.mesh.primitives[0].geometry;s.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:s.vertices})}}e.morphTargets.push({name:"target_Z",vertices:e.vertices})}function c(e,t,i,r){if(e.world=e.world||new THREE.Matrix4,e.world.copy(e.matrix),e.channels&&e.channels.length){var n=e.channels[0],o=n.sampler.output[i];o instanceof THREE.Matrix4&&e.world.copy(o)}r&&e.world.multiplyMatrices(r,e.world),t.push(e);for(var a=0;a<e.nodes.length;a++)c(e.nodes[a],t,i,e.world)}function u(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=-1;if("JOINT"==r.type){for(var o=0;o<t.joints.length;o++)if(r.sid==t.joints[o]){n=o;break}if(!(n>=0))throw"ColladaLoader: Could not find joint '"+r.sid+"'.";var a=t.invBindMatrices[n];r.invBindMatrix=a,r.skinningMatrix=new THREE.Matrix4,r.skinningMatrix.multiplyMatrices(r.world,a),r.weights=[];for(var o=0;o<t.weights.length;o++)for(var s=0;s<t.weights[o].length;s++){var l=t.weights[o][s];l.joint==n&&r.weights.push(l)}}}}function d(e,t,i){var r=At[t.url];if(i=void 0!==i?i:40,!r||!r.skin)return console.log("ColladaLoader: Could not find skin controller."),void 0;if(!t.skeleton||!t.skeleton.length)return console.log("ColladaLoader: Could not find the skeleton for the skin. "),void 0;var n,o,a,s,h,d,p,f=l(),m=Et.getChildById(t.skeleton[0],!0)||Et.getChildBySid(t.skeleton[0],!0),g=new THREE.Vector3;for(n=0;n<e.vertices.length;n++)e.vertices[n].applyMatrix4(r.skin.bindShapeMatrix);for(i=0;i<f.frames;i++){var v=[],E=[];for(n=0;n<e.vertices.length;n++)E.push(new THREE.Vector3);for(c(m,v,i),u(v,r.skin),n=0;n<v.length;n++)if("JOINT"==v[n].type)for(o=0;o<v[n].weights.length;o++)a=v[n].weights[o],s=a.index,h=a.weight,d=e.vertices[s],p=E[s],g.x=d.x,g.y=d.y,g.z=d.z,g.applyMatrix4(v[n].skinningMatrix),p.x+=g.x*h,p.y+=g.y*h,p.z+=g.z*h;e.morphTargets.push({name:"target_"+i,vertices:E})}}function p(e){var t,i,r,n,o=new THREE.Object3D,a=!1;for(r=0;r<e.controllers.length;r++){var s=At[e.controllers[r].url];switch(s.type){case"skin":if(Dt[s.skin.source]){var l=new D;l.url=s.skin.source,l.instance_material=e.controllers[r].instance_material,e.geometries.push(l),a=!0,t=e.controllers[r]}else if(At[s.skin.source]){var c=At[s.skin.source];if(i=c,c.morph&&Dt[c.morph.source]){var l=new D;l.url=c.morph.source,l.instance_material=e.controllers[r].instance_material,e.geometries.push(l)}}break;case"morph":if(Dt[s.morph.source]){var l=new D;l.url=s.morph.source,l.instance_material=e.controllers[r].instance_material,e.geometries.push(l),i=e.controllers[r]}console.log("ColladaLoader: Morph-controller partially supported.")}}var u={};for(r=0;r<e.geometries.length;r++){var f,m=e.geometries[r],g=m.instance_material,v=Dt[m.url],E={},y=[],_=0;if(v){if(!v.mesh||!v.mesh.primitives)continue;if(0==o.name.length&&(o.name=v.id),g)for(n=0;n<g.length;n++){var T=g[n],b=Pt[T.target],x=b.instance_effect.url,w=kt[x].shader,R=w.material;if(v.doubleSided){if(!(T.symbol in u)){var H=R.clone();H.side=THREE.DoubleSide,u[T.symbol]=H}R=u[T.symbol]}R.opacity=R.opacity?R.opacity:1,E[T.symbol]=_,y.push(R),f=R,f.name=null==b.name||""===b.name?b.id:b.name,_++}var S,M=f||new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading,side:v.doubleSided?THREE.DoubleSide:THREE.FrontSide}),C=v.mesh.geometry3js;if(_>1)for(M=new THREE.MeshFaceMaterial(y),n=0;n<C.faces.length;n++){var A=C.faces[n];A.materialIndex=E[A.daeMaterial]}void 0!==t?(d(C,t),M.morphTargets=!0,S=new THREE.SkinnedMesh(C,M,!1),S.skeleton=t.skeleton,S.skinController=At[t.url],S.skinInstanceController=t,S.name="skin_"+xt.length,xt.push(S)):void 0!==i?(h(C,i),M.morphTargets=!0,S=new THREE.Mesh(C,M),S.name="morph_"+bt.length,bt.push(S)):S=new THREE.Mesh(C,M),e.geometries.length>1?o.add(S):o=S}}for(r=0;r<e.cameras.length;r++){var P=e.cameras[r],k=Lt[P.url];o=new THREE.PerspectiveCamera(k.fov,parseFloat(k.aspect_ratio),parseFloat(k.znear),parseFloat(k.zfar))}for(r=0;r<e.lights.length;r++){var L=e.lights[r],N=Nt[L.url];if(N&&N.technique){var O,I=N.color.getHex(),z=N.intensity,F=0,V=N.falloff_angle;switch(N.technique){case"directional":o=new THREE.DirectionalLight(I,z,F);break;case"point":o=new THREE.PointLight(I,z,F);break;case"spot":o=new THREE.SpotLight(I,z,F,V,O);break;case"ambient":o=new THREE.AmbientLight(I)}}}if(o.name=e.name||e.id||"",o.matrix=e.matrix,o.matrix.decompose(o.position,o.quaternion,o.scale),It.centerGeometry&&o.geometry){var U=THREE.GeometryUtils.center(o.geometry);U.multiply(o.scale),U.applyQuaternion(o.quaternion),o.position.sub(U)}for(r=0;r<e.nodes.length;r++)o.add(p(e.nodes[r],e));return o}function f(e){return wt.evaluate(".//dae:library_nodes//dae:node[@id='"+e+"']",wt,rt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext()}function m(e){var t=[],i=1e6,r=-1e6;for(var n in Ct)for(var o=Ct[n],a=0;a<o.channel.length;a++){var s=o.channel[a],l=o.sampler[a],n=s.target.split("/")[0];n==e.id&&(l.create(),s.sampler=l,i=Math.min(i,l.startTime),r=Math.max(r,l.endTime),t.push(s))}return t.length&&(e.startTime=i,e.endTime=r),t}function g(e){if(e.channels&&e.channels.length){for(var t=[],i=[],r=0,n=e.channels.length;n>r;r++){var o,a=e.channels[r],s=a.fullSid,l=a.sampler,h=l.input,c=e.getTransformBySid(a.sid);if(a.arrIndices){o=[];for(var u=0,d=a.arrIndices.length;d>u;u++)o[u]=gt(a.arrIndices[u])}else o=vt(a.member);if(c){-1===i.indexOf(s)&&i.push(s);for(var u=0,d=h.length;d>u;u++){var p=h[u],f=l.getData(c.type,u),m=v(t,p);if(!m){m=new Q(p);var g=E(t,p);t.splice(-1==g?t.length:g,0,m)}m.addTarget(s,c,o,f)}}else console.log('Could not find transform "'+a.sid+'" in node '+e.id)}for(var r=0;r<i.length;r++)for(var _=i[r],u=0;u<t.length;u++){var m=t[u];m.hasTarget(_)||y(t,m,u,_)}e.keys=t,e.sids=i}}function v(e,t){for(var i=null,r=0,n=e.length;n>r&&null==i;r++){var o=e[r];if(o.time===t)i=o;else if(o.time>t)break}return i}function E(e,t){for(var i=-1,r=0,n=e.length;n>r&&-1==i;r++){var o=e[r];o.time>=t&&(i=r)}return i}function y(e,t,i,r){var n=T(e,r,i?i-1:0),o=_(e,r,i+1);if(n&&o){var a,s=(t.time-n.time)/(o.time-n.time),l=n.getTarget(r),h=o.getTarget(r).data,c=l.data;if("matrix"===l.type)a=c;else if(c.length){a=[];for(var u=0;u<c.length;++u)a[u]=c[u]+(h[u]-c[u])*s}else a=c+(h-c)*s;t.addTarget(r,l.transform,l.member,a)}}function _(e,t,i){for(;i<e.length;i++){var r=e[i];if(r.hasTarget(t))return r}return null}function T(e,t,i){for(i=i>=0?i:i+e.length;i>=0;i--){var r=e[i];if(r.hasTarget(t))return r}return null}function b(){this.id="",this.init_from=""}function x(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function w(){this.method=null,this.source=null,this.targets=null,this.weights=null}function R(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function H(){this.id="",this.name="",this.nodes=[],this.scene=new THREE.Object3D}function S(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function M(){this.sid="",this.type="",this.data=[],this.obj=null}function C(){this.url="",this.skeleton=[],this.instance_material=[]}function A(){this.symbol="",this.target=""}function D(){this.url="",this.instance_material=[]}function P(){this.id="",this.mesh=null}function k(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function L(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function N(){L.call(this),this.vcount=[]}function O(){L.call(this),this.vcount=3}function I(){this.source="",this.count=0,this.stride=0,this.params=[]}function z(){this.input={}}function F(){this.semantic="",this.offset=0,this.source="",this.set=0}function V(e){this.id=e,this.type=null}function U(){this.id="",this.name="",this.instance_effect=null}function B(){this.color=new THREE.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function j(e,t){this.type=e,this.effect=t,this.material=null}function W(e){this.effect=e,this.init_from=null,this.format=null}function G(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function X(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function Y(){this.url=""}function q(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function K(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function Z(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function Q(e){this.targets=[],this.time=e}function $(){this.id="",this.name="",this.technique=""}function J(){this.url=""}function et(){this.id="",this.name="",this.technique=""}function tt(){this.url=""}function it(e){var t=e.getAttribute("id");return void 0!=St[t]?St[t]:(St[t]=new V(t).parse(e),St[t])}function rt(e){return"dae"==e?"http://www.collada.org/2005/11/COLLADASchema":null}function nt(e){for(var t=st(e),i=[],r=0,n=t.length;n>r;r++)i.push("true"==t[r]||"1"==t[r]?!0:!1);return i}function ot(e){for(var t=st(e),i=[],r=0,n=t.length;n>r;r++)i.push(parseFloat(t[r]));return i}function at(e){for(var t=st(e),i=[],r=0,n=t.length;n>r;r++)i.push(parseInt(t[r],10));return i}function st(e){return e.length>0?lt(e).split(/\s+/):[]}function lt(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function ht(e,t,i){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):i}function ct(e,t){for(var i=wt.evaluate(t,e,rt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),r=i.iterateNext(),n=[];r;)n.push(r),r=i.iterateNext();return n}function ut(e,t){e.doubleSided=!1;var i=wt.evaluate(".//dae:extra//dae:double_sided",t,rt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);i&&(i=i.iterateNext(),i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0))}function dt(){if(It.convertUpAxis&&Ft!==It.upAxis)switch(Ft){case"X":Vt="Y"===It.upAxis?"XtoY":"XtoZ";break;case"Y":Vt="X"===It.upAxis?"YtoX":"YtoZ";break;case"Z":Vt="X"===It.upAxis?"ZtoX":"ZtoY"}else Vt=null}function pt(e,t){if(It.convertUpAxis&&Ft!==It.upAxis)switch(Vt){case"XtoY":var i=e[0];e[0]=t*e[1],e[1]=i;break;case"XtoZ":var i=e[2];e[2]=e[1],e[1]=e[0],e[0]=i;break;case"YtoX":var i=e[0];e[0]=e[1],e[1]=t*i;break;case"YtoZ":var i=e[1];e[1]=t*e[2],e[2]=i;break;case"ZtoX":var i=e[0];e[0]=e[1],e[1]=e[2],e[2]=i;break;case"ZtoY":var i=e[1];e[1]=e[2],e[2]=t*i}}function ft(e,t){var i=[e[t],e[t+1],e[t+2]];return pt(i,-1),new THREE.Vector3(i[0],i[1],i[2])}function mt(e){if(It.convertUpAxis){var t=[e[0],e[4],e[8]];pt(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],t=[e[1],e[5],e[9]],pt(t,-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],t=[e[2],e[6],e[10]],pt(t,-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],t=[e[0],e[1],e[2]],pt(t,-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],t=[e[4],e[5],e[6]],pt(t,-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],t=[e[8],e[9],e[10]],pt(t,-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],t=[e[3],e[7],e[11]],pt(t,-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return new THREE.Matrix4(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function gt(e){if(e>-1&&3>e){var t=["X","Y","Z"],i={X:0,Y:1,Z:2};e=vt(t[e]),e=i[e]}return e}function vt(e){if(It.convertUpAxis)switch(e){case"X":switch(Vt){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z"}break;case"Y":switch(Vt){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z"}break;case"Z":switch(Vt){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y"}}return e}var Et,yt,_t,Tt,bt,xt,wt=null,Rt=null,Ht=null,St={},Mt={},Ct={},At={},Dt={},Pt={},kt={},Lt={},Nt={},Ot=THREE.SmoothShading,It={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},zt=1,Ft="Y",Vt=null;return b.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];"init_from"==i.nodeName&&(this.init_from=i.textContent)}return this},x.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"skin":this.skin=(new R).parse(i),this.type=i.nodeName;break;case"morph":this.morph=(new w).parse(i),this.type=i.nodeName}}return this},w.prototype.parse=function(e){var t,i={},r=[];for(this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,""),t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(1==n.nodeType)switch(n.nodeName){case"source":var o=(new V).parse(n);i[o.id]=o;break;case"targets":r=this.parseInputs(n);break;default:console.log(n.nodeName)}}for(t=0;t<r.length;t++){var a=r[t],o=i[a.source];switch(a.semantic){case"MORPH_TARGET":this.targets=o.read();break;case"MORPH_WEIGHT":this.weights=o.read()}}return this},w.prototype.parseInputs=function(e){for(var t=[],i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"input":t.push((new F).parse(r))}}return t},R.prototype.parse=function(e){var t,i,r={};this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var n=0;n<e.childNodes.length;n++){var o=e.childNodes[n];if(1==o.nodeType)switch(o.nodeName){case"bind_shape_matrix":var a=ot(o.textContent);this.bindShapeMatrix=mt(a);break;case"source":var s=(new V).parse(o);r[s.id]=s;break;case"joints":t=o;break;case"vertex_weights":i=o;break;default:console.log(o.nodeName)}}return this.parseJoints(t,r),this.parseWeights(i,r),this},R.prototype.parseJoints=function(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"input":var n=(new F).parse(r),o=t[n.source];"JOINT"==n.semantic?this.joints=o.read():"INV_BIND_MATRIX"==n.semantic&&(this.invBindMatrices=o.read())}}},R.prototype.parseWeights=function(e,t){for(var i,r,n=[],o=0;o<e.childNodes.length;o++){var a=e.childNodes[o];if(1==a.nodeType)switch(a.nodeName){case"input":n.push((new F).parse(a));break;case"v":i=at(a.textContent);break;case"vcount":r=at(a.textContent)}}for(var s=0,o=0;o<r.length;o++){for(var l=r[o],h=[],c=0;l>c;c++){for(var u={},d=0;d<n.length;d++){var p=n[d],f=i[s+p.offset];switch(p.semantic){case"JOINT":u.joint=f;break;case"WEIGHT":u.weight=t[p.source].data[f]}}h.push(u),s+=n.length}for(var c=0;c<h.length;c++)h[c].index=o;this.weights.push(h)}},H.prototype.getChildById=function(e,t){for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildById(e,t);if(r)return r}return null},H.prototype.getChildBySid=function(e,t){for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildBySid(e,t);if(r)return r}return null},H.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new S).parse(i))}}return this},S.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var i=this.channels[t],r=i.target.split("/");r.shift();var n,o,a=r.shift(),s=a.indexOf(".")>=0,l=a.indexOf("(")>=0;if(s)r=a.split("."),a=r.shift(),o=r.shift();else if(l){n=a.split("("),a=n.shift();for(var h=0;h<n.length;h++)n[h]=parseInt(n[h].replace(/\)/,""))}if(a==e)return i.info={sid:a,dotSyntax:s,arrSyntax:l,arrIndices:n},i}return null},S.prototype.getChildById=function(e,t){if(this.id==e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildById(e,t);if(r)return r}return null},S.prototype.getChildBySid=function(e,t){if(this.sid==e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildBySid(e,t);if(r)return r}return null},S.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid==e)return this.transforms[t];return null},S.prototype.parse=function(e){var t;this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.type="JOINT"==this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new S).parse(r));break;case"instance_camera":this.cameras.push((new J).parse(r));break;case"instance_controller":this.controllers.push((new C).parse(r));break;case"instance_geometry":this.geometries.push((new D).parse(r));break;case"instance_light":this.lights.push((new tt).parse(r));break;case"instance_node":t=r.getAttribute("url").replace(/^#/,"");var n=f(t);n&&this.nodes.push((new S).parse(n));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new M).parse(r));break;case"extra":break;default:console.log(r.nodeName)}}return this.channels=m(this),g(this),this.updateMatrix(),this},S.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},M.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=ot(e.textContent),this.convert(),this},M.prototype.convert=function(){switch(this.type){case"matrix":this.obj=mt(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":pt(this.data,-1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":pt(this.data,1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},M.prototype.apply=function(){var e=new THREE.Matrix4;return function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj)}}}(),M.prototype.update=function(e,t){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var r="n"+(t[0]+1)+(t[1]+1);this.obj[r]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=THREE.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=THREE.Math.degToRad(e[3])}}},C.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType)switch(i.nodeName){case"skeleton":this.skeleton.push(i.textContent.replace(/^#/,""));break;case"bind_material":var r=wt.evaluate(".//dae:instance_material",i,rt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(r)for(var n=r.iterateNext();n;)this.instance_material.push((new A).parse(n)),n=r.iterateNext();break;case"extra":}}return this},A.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},D.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&"bind_material"==i.nodeName){var r=wt.evaluate(".//dae:instance_material",i,rt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(r)for(var n=r.iterateNext();n;)this.instance_material.push((new A).parse(n)),n=r.iterateNext();break}}return this},P.prototype.parse=function(e){this.id=e.getAttribute("id"),ut(this,e);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"mesh":this.mesh=new k(this).parse(i);break;case"extra":}}return this},k.prototype.parse=function(e){this.primitives=[];var t;for(t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"source":it(i);break;case"vertices":this.vertices=(new z).parse(i);break;case"triangles":this.primitives.push((new O).parse(i));break;case"polygons":this.primitives.push((new L).parse(i));break;case"polylist":this.primitives.push((new N).parse(i))}}this.geometry3js=new THREE.Geometry;var r=St[this.vertices.input.POSITION.source].data;for(t=0;t<r.length;t+=3)this.geometry3js.vertices.push(ft(r,t).clone());for(t=0;t<this.primitives.length;t++){var n=this.primitives[t];n.setVertices(this.vertices),this.handlePrimitive(n,this.geometry3js)}return this.geometry3js.computeCentroids(),this.geometry3js.computeFaceNormals(),this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this.geometry3js.computeBoundingBox(),this},k.prototype.handlePrimitive=function(e,t){var i,r,n,o,a,s,l,h=e.p,c=e.inputs,u=0,d=3,p=0,f=[];for(i=0;i<c.length;i++){n=c[i];var m=n.offset+1;switch(p=m>p?m:p,n.semantic){case"TEXCOORD":f.push(n.set)}}for(var g=0;g<h.length;++g)for(var v=h[g],E=0;E<v.length;){var y=[],_=[],T=null,b=[];for(d=e.vcount?e.vcount.length?e.vcount[u++]:e.vcount:v.length/p,i=0;d>i;i++)for(r=0;r<c.length;r++)switch(n=c[r],s=St[n.source],o=v[E+i*p+n.offset],l=s.accessor.params.length,a=o*l,n.semantic){case"VERTEX":y.push(o);break;case"NORMAL":_.push(ft(s.data,a));break;case"TEXCOORD":T=T||{},void 0===T[n.set]&&(T[n.set]=[]),T[n.set].push(new THREE.Vector2(s.data[a],s.data[a+1]));break;case"COLOR":b.push((new THREE.Color).setRGB(s.data[a],s.data[a+1],s.data[a+2]))}if(0==_.length)if(n=this.vertices.input.NORMAL){s=St[n.source],l=s.accessor.params.length;for(var x=0,w=y.length;w>x;x++)_.push(ft(s.data,y[x]*l))}else t.calcNormals=!0;if(!T&&(T={},n=this.vertices.input.TEXCOORD)){f.push(n.set),s=St[n.source],l=s.accessor.params.length;for(var x=0,w=y.length;w>x;x++)a=y[x]*l,void 0===T[n.set]&&(T[n.set]=[]),T[n.set].push(new THREE.Vector2(s.data[a],1-s.data[a+1]))}if(0==b.length&&(n=this.vertices.input.COLOR)){s=St[n.source],l=s.accessor.params.length;for(var x=0,w=y.length;w>x;x++)a=y[x]*l,b.push((new THREE.Color).setRGB(s.data[a],s.data[a+1],s.data[a+2]))}var R,H,S=null,M=[];if(3===d)M.push(new THREE.Face3(y[0],y[1],y[2],_,b.length?b:new THREE.Color));else if(4===d)M.push(new THREE.Face4(y[0],y[1],y[2],y[3],_,b.length?b:new THREE.Color));else if(d>4&&It.subdivideFaces){var C=b.length?b:new THREE.Color;for(r=1;d-1>r;)M.push(new THREE.Face3(y[0],y[r],y[r+1],[_[0],_[r++],_[r]],C))}if(M.length)for(var x=0,w=M.length;w>x;x++)for(S=M[x],S.daeMaterial=e.material,t.faces.push(S),r=0;r<f.length;r++)R=T[f[r]],H=d>4?[R[0],R[x+1],R[x+2]]:4===d?[R[0],R[1],R[2],R[3]]:[R[0],R[1],R[2]],t.faceVertexUvs[r]||(t.faceVertexUvs[r]=[]),t.faceVertexUvs[r].push(H);else console.log("dropped face with vcount "+d+" for geometry with id: "+t.id);E+=p*d}},L.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source==e.id&&(this.inputs[t].source=e.input.POSITION.source)},L.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=ht(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"input":this.inputs.push((new F).parse(e.childNodes[t]));break;case"vcount":this.vcount=at(i.textContent);break;case"p":this.p.push(at(i.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},N.prototype=Object.create(L.prototype),O.prototype=Object.create(L.prototype),I.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=ht(e,"count",0),this.stride=ht(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("param"==i.nodeName){var r={};r.name=i.getAttribute("name"),r.type=i.getAttribute("type"),this.params.push(r)}}return this},z.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if("input"==e.childNodes[t].nodeName){var i=(new F).parse(e.childNodes[t]);this.input[i.semantic]=i}return this},F.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=ht(e,"set",-1),this.offset=ht(e,"offset",0),"TEXCOORD"==this.semantic&&this.set<0&&(this.set=0),this},V.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"bool_array":this.data=nt(i.textContent),this.type=i.nodeName;break;case"float_array":this.data=ot(i.textContent),this.type=i.nodeName;break;case"int_array":this.data=at(i.textContent),this.type=i.nodeName;break;case"IDREF_array":case"Name_array":this.data=st(i.textContent),this.type=i.nodeName;break;case"technique_common":for(var r=0;r<i.childNodes.length;r++)if("accessor"==i.childNodes[r].nodeName){this.accessor=(new I).parse(i.childNodes[r]);break}}}return this},V.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var r=this.data.slice(i,i+16),n=mt(r);e.push(n)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},U.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"==e.childNodes[t].nodeName){this.instance_effect=(new Y).parse(e.childNodes[t]);break}return this},B.prototype.isColor=function(){return null==this.texture},B.prototype.isTexture=function(){return null!=this.texture},B.prototype.parse=function(e){"transparent"==e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"color":var r=ot(i.textContent);this.color=new THREE.Color,this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},B.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1],e.childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},j.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new B).parse(i);break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var r=ct(i,".//dae:float");r.length>0&&(this[i.nodeName]=parseFloat(r[0].textContent))}}return this.create(),this},j.prototype.create=function(){var e={},t=!1;if(void 0!==this.transparency&&void 0!==this.transparent){this.transparent;var i=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;i>0&&(t=!0,e.transparent=!0,e.opacity=1-i)}for(var r in this)switch(r){case"ambient":case"emission":case"diffuse":case"specular":var n=this[r];if(n instanceof B)if(n.isTexture()){var o=n.texture,a=this.effect.sampler[o];if(void 0!==a&&void 0!==a.source){var s=this.effect.surface[a.source],l=Mt[s.init_from];if(l){var h=THREE.ImageUtils.loadTexture(Tt+l.init_from);h.wrapS=n.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,h.wrapT=n.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,h.offset.x=n.texOpts.offsetU,h.offset.y=n.texOpts.offsetV,h.repeat.x=n.texOpts.repeatU,h.repeat.y=n.texOpts.repeatV,e.map=h,"emission"===r&&(e.emissive=16777215)
}}}else"diffuse"!==r&&t||("emission"===r?e.emissive=n.color.getHex():e[r]=n.color.getHex());break;case"shininess":e[r]=this[r];break;case"reflectivity":e[r]=this[r],e[r]>0&&(e.envMap=It.defaultEnvMap),e.combine=THREE.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[r],1!==this[r]&&(e.envMap=It.defaultEnvMap);break;case"transparency":}switch(e.shading=Ot,e.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide,this.type){case"constant":void 0!=e.emissive&&(e.color=e.emissive),this.material=new THREE.MeshBasicMaterial(e);break;case"phong":case"blinn":void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new THREE.MeshPhongMaterial(e);break;case"lambert":default:void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new THREE.MeshLambertMaterial(e)}return this.material},W.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},G.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},X.prototype.create=function(){return null==this.shader?null:void 0},X.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),ut(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},X.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"surface":this.surface[t]=new W(this).parse(r);break;case"sampler2D":this.sampler[t]=new G(this).parse(r);break;case"extra":break;default:console.log(r.nodeName)}}},X.prototype.parseProfileCOMMON=function(e){for(var t,i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":t=r;break;case"newparam":this.parseNewparam(r);break;case"image":var n=(new b).parse(r);Mt[n.id]=n;break;case"extra":break;default:console.log(r.nodeName)}}return t},X.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new j(i.nodeName,this).parse(i)}}},Y.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},q.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"animation":var r=(new q).parse(i);for(var n in r.source)this.source[n]=r.source[n];for(var o=0;o<r.channel.length;o++)this.channel.push(r.channel[o]),this.sampler.push(r.sampler[o]);break;case"source":var n=(new V).parse(i);this.source[n.id]=n;break;case"sampler":this.sampler.push(new Z(this).parse(i));break;case"channel":this.channel.push(new K(this).parse(i))}}return this},K.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/");t.shift();var i=t.shift(),r=i.indexOf(".")>=0,n=i.indexOf("(")>=0;if(r)t=i.split("."),this.sid=t.shift(),this.member=t.shift();else if(n){var o=i.split("(");this.sid=o.shift();for(var a=0;a<o.length;a++)o[a]=parseInt(o[a].replace(/\)/,""));this.arrIndices=o}else this.sid=i;return this.fullSid=i,this.dotSyntax=r,this.arrSyntax=n,this},Z.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"input":this.inputs.push((new F).parse(i))}}return this},Z.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],i=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=i.read();break;case"OUTPUT":this.output=i.read(),this.strideOut=i.accessor.stride;break;case"INTERPOLATION":this.interpolation=i.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(t.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},Z.prototype.getData=function(e,t){var i;if("matrix"===e&&16===this.strideOut)i=this.output[t];else if(this.strideOut>1){i=[],t*=this.strideOut;for(var r=0;r<this.strideOut;++r)i[r]=this.output[t+r];if(3===this.strideOut)switch(e){case"rotate":case"translate":pt(i,-1);break;case"scale":pt(i,1)}else 4===this.strideOut&&"matrix"===e&&pt(i,-1)}else i=this.output[t];return i},Q.prototype.addTarget=function(e,t,i,r){this.targets.push({sid:e,member:i,transform:t,data:r})},Q.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var i=this.targets[t];e&&i.sid!==e||i.transform.update(i.data,i.member)}},Q.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},Q.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},Q.prototype.interpolate=function(e,t){for(var i=0;i<this.targets.length;++i){var r,n=this.targets[i],o=e.getTarget(n.sid);if("matrix"!==n.transform.type&&o){var a=(t-this.time)/(e.time-this.time),s=o.data,l=n.data;if((0>a||a>1)&&(console.log("Key.interpolate: Warning! Scale out of bounds:"+a),a=0>a?0:1),l.length){r=[];for(var h=0;h<l.length;++h)r[h]=l[h]+(s[h]-l[h])*a}else r=l+(s-l)*a}else r=n.data;n.transform.update(r,n.member)}},$.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"optics":this.parseOptics(i)}}return this},$.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if("technique_common"==e.childNodes[t].nodeName)for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++)if(this.technique=i.childNodes[r].nodeName,"perspective"==this.technique)for(var n=i.childNodes[r],o=0;o<n.childNodes.length;o++){var a=n.childNodes[o];switch(a.nodeName){case"yfov":this.yfov=a.textContent;break;case"xfov":this.xfov=a.textContent;break;case"znear":this.znear=a.textContent;break;case"zfar":this.zfar=a.textContent;break;case"aspect_ratio":this.aspect_ratio=a.textContent}}else if("orthographic"==this.technique)for(var s=i.childNodes[r],o=0;o<s.childNodes.length;o++){var a=s.childNodes[o];switch(a.nodeName){case"xmag":this.xmag=a.textContent;break;case"ymag":this.ymag=a.textContent;break;case"znear":this.znear=a.textContent;break;case"zfar":this.zfar=a.textContent;break;case"aspect_ratio":this.aspect_ratio=a.textContent}}return this},J.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},et.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i)}}return this},et.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++){var n=i.childNodes[r];switch(n.nodeName){case"color":var o=ot(n.textContent);this.color=new THREE.Color(0),this.color.setRGB(o[0],o[1],o[2]),this.color.a=o[3];break;case"falloff_angle":this.falloff_angle=parseFloat(n.textContent)}}}return this},et.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent)}}return this},tt.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},{load:e,parse:t,setPreferredShading:i,applySkin:d,geometries:Dt,options:It}};