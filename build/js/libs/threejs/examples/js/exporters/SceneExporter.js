THREE.SceneExporter=function(){};THREE.SceneExporter.prototype={constructor:THREE.SceneExporter,parse:function(e){function t(e,i){for(var r=0;r<e.children.length;r++){var n=e.children[r];if(n instanceof THREE.Mesh){O.push(u(n,i));w+=1;if(!(n.geometry.id in L)){L[n.geometry.id]=!0;C.push(f(n.geometry));H+=1}if(!(n.material.id in k)){k[n.material.id]=!0;A.push(d(n.material));S+=1;I(n.material.map);I(n.material.envMap);I(n.material.lightMap);I(n.material.specularMap);I(n.material.bumpMap);I(n.material.normalMap)}}else if(n instanceof THREE.Light){O.push(l(n,i));w+=1}else if(n instanceof THREE.Camera){O.push(h(n,i));w+=1}else if(n instanceof THREE.Object3D){O.push(c(n,i));w+=1}if(n.children.length>0)O.push(s(i+1)+'		"children" : {');t(n,i+2);if(n.children.length>0)O.push(s(i+1)+"		}");O.push(s(i)+"		}"+(r<e.children.length-1?",\n":""))}}function i(e){return"["+e.x+","+e.y+"]"}function r(e){return"["+e.x+","+e.y+","+e.z+"]"}function n(e){return"["+e.r.toFixed(3)+","+e.g.toFixed(3)+","+e.b.toFixed(3)+"]"}function o(e){return'"'+e+'"'}function a(e){var t=["NearestFilter","NearestMipMapNearestFilter","NearestMipMapLinearFilter","LinearFilter","LinearMipMapNearestFilter","LinearMipMapLinearFilter"];for(var i=0;i<t.length;i++)if(THREE[t[i]]===e)return o(t[i]);return""}function s(e){var t="";for(var i=0;e>i;i++)t+="	";return t}function l(e,t){if(e instanceof THREE.AmbientLight)var i=["		"+o(g(e))+" : {",'	"type"  : "AmbientLight",','	"color" : '+e.color.getHex()+(e.children.length?",":"")];else if(e instanceof THREE.DirectionalLight)var i=["		"+o(g(e))+" : {",'	"type"      : "DirectionalLight",','	"color"     : '+e.color.getHex()+",",'	"intensity" : '+e.intensity+",",'	"direction" : '+r(e.position)+",",'	"target"    : '+o(g(e.target))+(e.children.length?",":"")];else if(e instanceof THREE.PointLight)var i=["		"+o(g(e))+" : {",'	"type"      : "PointLight",','	"color"     : '+e.color.getHex()+",",'	"intensity" : '+e.intensity+",",'	"position"  : '+r(e.position)+",",'	"distance"  : '+e.distance+(e.children.length?",":"")];else if(e instanceof THREE.SpotLight)var i=["		"+o(g(e))+" : {",'	"type"      : "SpotLight",','	"color"     : '+e.color.getHex()+",",'	"intensity" : '+e.intensity+",",'	"position"  : '+r(e.position)+",",'	"distance"  : '+e.distance+",",'	"angle"     : '+e.angle+",",'	"exponent"  : '+e.exponent+",",'	"target"    : '+o(g(e.target))+(e.children.length?",":"")];else if(e instanceof THREE.HemisphereLight)var i=["		"+o(g(e))+" : {",'	"type"        : "HemisphereLight",','	"skyColor"    : '+e.color.getHex()+",",'	"groundColor" : '+e.groundColor.getHex()+",",'	"intensity"   : '+e.intensity+",",'	"position"    : '+r(e.position)+(e.children.length?",":"")];else var i=[];return v(i,"\n		",t)}function h(e,t){if(e instanceof THREE.PerspectiveCamera)var i=["		"+o(g(e))+" : {",'	"type"     : "PerspectiveCamera",','	"fov"      : '+e.fov+",",'	"aspect"   : '+e.aspect+",",'	"near"     : '+e.near+",",'	"far"      : '+e.far+",",'	"position" : '+r(e.position)+(e.children.length?",":"")];else if(e instanceof THREE.OrthographicCamera)var i=["		"+o(g(e))+" : {",'	"type"     : "OrthographicCamera",','	"left"     : '+e.left+",",'	"right"    : '+e.right+",",'	"top"      : '+e.top+",",'	"bottom"   : '+e.bottom+",",'	"near"     : '+e.near+",",'	"far"      : '+e.far+",",'	"position" : '+r(e.position)+(e.children.length?",":"")];else var i=[];return v(i,"\n		",t)}function c(e,t){var i=["		"+o(g(e))+" : {",'	"position" : '+r(e.position)+",",'	"rotation" : '+r(e.rotation)+",",'	"scale"	   : '+r(e.scale)+",",'	"visible"  : '+e.visible+(e.children.length?",":"")];return v(i,"\n		",t)}function u(e,t){var i=["		"+o(g(e))+" : {",'	"geometry" : '+o(E(e.geometry))+",",'	"material" : '+o(y(e.material))+",",'	"position" : '+r(e.position)+",",'	"rotation" : '+r(e.rotation)+",",'	"scale"	   : '+r(e.scale)+",",'	"visible"  : '+e.visible+(e.children.length?",":"")];return v(i,"\n		",t)}function f(e){if(e instanceof THREE.SphereGeometry)var t=["	"+o(E(e))+": {",'	"type"    : "sphere",','	"radius"  : '+e.radius+",",'	"widthSegments"  : '+e.widthSegments+",",'	"heightSegments" : '+e.heightSegments,"}"];else if(e instanceof THREE.CubeGeometry)var t=["	"+o(E(e))+": {",'	"type"    : "cube",','	"width"  : '+e.width+",",'	"height"  : '+e.height+",",'	"depth"  : '+e.depth+",",'	"widthSegments"  : '+e.widthSegments+",",'	"heightSegments" : '+e.heightSegments+",",'	"depthSegments" : '+e.depthSegments,"}"];else if(e instanceof THREE.PlaneGeometry)var t=["	"+o(E(e))+": {",'	"type"    : "plane",','	"width"  : '+e.width+",",'	"height"  : '+e.height+",",'	"widthSegments"  : '+e.widthSegments+",",'	"heightSegments" : '+e.heightSegments,"}"];else if(e instanceof THREE.Geometry)if("ascii"===e.sourceType||"ctm"===e.sourceType||"stl"===e.sourceType||"vtk"===e.sourceType)var t=["	"+o(E(e))+": {",'	"type" : '+o(e.sourceType)+",",'	"url"  : '+o(e.sourceFile),"}"];else var t=[];else var t=[];return v(t,"\n		")}function d(e){if(e instanceof THREE.MeshBasicMaterial)var t=["	"+o(y(e))+": {",'	"type"    : "MeshBasicMaterial",','	"parameters"  : {','		"color"  : '+e.color.getHex()+",",e.map?'		"map" : '+o(T(e.map))+",":"",e.envMap?'		"envMap" : '+o(T(e.envMap))+",":"",e.specularMap?'		"specularMap" : '+o(T(e.specularMap))+",":"",e.lightMap?'		"lightMap" : '+o(T(e.lightMap))+",":"",'		"reflectivity"  : '+e.reflectivity+",",'		"transparent" : '+e.transparent+",",'		"opacity" : '+e.opacity+",",'		"wireframe" : '+e.wireframe+",",'		"wireframeLinewidth" : '+e.wireframeLinewidth,"	}","}"];else if(e instanceof THREE.MeshLambertMaterial)var t=["	"+o(y(e))+": {",'	"type"    : "MeshLambertMaterial",','	"parameters"  : {','		"color"  : '+e.color.getHex()+",",'		"ambient"  : '+e.ambient.getHex()+",",'		"emissive"  : '+e.emissive.getHex()+",",e.map?'		"map" : '+o(T(e.map))+",":"",e.envMap?'		"envMap" : '+o(T(e.envMap))+",":"",e.specularMap?'		"specularMap" : '+o(T(e.specularMap))+",":"",e.lightMap?'		"lightMap" : '+o(T(e.lightMap))+",":"",'		"reflectivity"  : '+e.reflectivity+",",'		"transparent" : '+e.transparent+",",'		"opacity" : '+e.opacity+",",'		"wireframe" : '+e.wireframe+",",'		"wireframeLinewidth" : '+e.wireframeLinewidth,"	}","}"];else if(e instanceof THREE.MeshPhongMaterial)var t=["	"+o(y(e))+": {",'	"type"    : "MeshPhongMaterial",','	"parameters"  : {','		"color"  : '+e.color.getHex()+",",'		"ambient"  : '+e.ambient.getHex()+",",'		"emissive"  : '+e.emissive.getHex()+",",'		"specular"  : '+e.specular.getHex()+",",'		"shininess" : '+e.shininess+",",e.map?'		"map" : '+o(T(e.map))+",":"",e.envMap?'		"envMap" : '+o(T(e.envMap))+",":"",e.specularMap?'		"specularMap" : '+o(T(e.specularMap))+",":"",e.lightMap?'		"lightMap" : '+o(T(e.lightMap))+",":"",e.normalMap?'		"normalMap" : '+o(T(e.normalMap))+",":"",e.bumpMap?'		"bumpMap" : '+o(T(e.bumpMap))+",":"",'		"bumpScale"  : '+e.bumpScale+",",'		"reflectivity"  : '+e.reflectivity+",",'		"transparent" : '+e.transparent+",",'		"opacity" : '+e.opacity+",",'		"wireframe" : '+e.wireframe+",",'		"wireframeLinewidth" : '+e.wireframeLinewidth,"	}","}"];else if(e instanceof THREE.MeshDepthMaterial)var t=["	"+o(y(e))+": {",'	"type"    : "MeshDepthMaterial",','	"parameters"  : {','		"transparent" : '+e.transparent+",",'		"opacity" : '+e.opacity+",",'		"wireframe" : '+e.wireframe+",",'		"wireframeLinewidth" : '+e.wireframeLinewidth,"	}","}"];else if(e instanceof THREE.MeshNormalMaterial)var t=["	"+o(y(e))+": {",'	"type"    : "MeshNormalMaterial",','	"parameters"  : {','		"transparent" : '+e.transparent+",",'		"opacity" : '+e.opacity+",",'		"wireframe" : '+e.wireframe+",",'		"wireframeLinewidth" : '+e.wireframeLinewidth,"	}","}"];else if(e instanceof THREE.MeshFaceMaterial)var t=["	"+o(y(e))+": {",'	"type"    : "MeshFaceMaterial",','	"parameters"  : {}',"}"];return v(t,"\n		")}function p(e){var t=["	"+o(T(e))+": {",'	"url"    : "'+e.sourceFile+'",','	"repeat" : '+i(e.repeat)+",",'	"offset" : '+i(e.offset)+",",'	"magFilter" : '+a(e.magFilter)+",",'	"minFilter" : '+a(e.minFilter)+",",'	"anisotropy" : '+e.anisotropy,"}"];return v(t,"\n		")}function m(e){if(e instanceof THREE.Fog)var t=["	"+o(_(e))+": {",'	"type"  : "linear",','	"color" : '+n(e.color)+",",'	"near"  : '+e.near+",",'	"far"   : '+e.far,"}"];else if(e instanceof THREE.FogExp2)var t=["	"+o(_(e))+": {",'	"type"    : "exp2",','	"color"   : '+n(e.color)+",",'	"density" : '+e.density,"}"];else var t=[];return v(t,"\n		")}function v(e,t,i){var r=[];for(var n=0;n<e.length;n++){var o=e[n];if(o){if(i)o=s(i)+o;r.push(o)}}return r.join(t)}function g(e){return e.name?e.name:"Object_"+e.id}function E(e){return e.name?e.name:"Geometry_"+e.id}function y(e){return e.name?e.name:"Material_"+e.id}function T(e){return e.name?e.name:"Texture_"+e.id}function _(e){return e.name?e.name:"Default fog"}var x=r(e.position);var b=r(e.rotation);var R=r(e.scale);var w=0;var H=0;var S=0;var M=0;var C=[];var A=[];var D=[];var P=[];var L={};var k={};var N={};var I=function(e){if(e)if(!(e.id in N)){N[e.id]=!0;D.push(p(e));M+=1}};var O=[];t(e,0);var z=O.join("\n");if(e.fog)P.push(m(e.fog));var F=v(C,",\n\n	");var V=v(A,",\n\n	");var U=v(D,",\n\n	");var B=v(P,",\n\n	");var j=null;e.traverse(function(e){if(e instanceof THREE.Camera&&e.userData.active)j=e});var W=o(j?g(j):"");var G=o(e.fog?_(e.fog):"");var X=["{",'	"metadata": {','		"formatVersion" : 3.2,','		"type"		: "scene",','		"generatedBy"	: "SceneExporter",','		"objects"       : '+w+",",'		"geometries"    : '+H+",",'		"materials"     : '+S+",",'		"textures"      : '+M,"	},","",'	"urlBaseType": "relativeToScene",',"",'	"objects" :',"	{",z,"	},","",'	"geometries" :',"	{","	"+F,"	},","",'	"materials" :',"	{","	"+V,"	},","",'	"textures" :',"	{","	"+U,"	},","",'	"fogs" :',"	{","	"+B,"	},","",'	"transform" :',"	{",'		"position"  : '+x+",",'		"rotation"  : '+b+",",'		"scale"     : '+R,"	},","",'	"defaults" :',"	{",'		"camera"  : '+W+",",'		"fog"  	  : '+G,"	}","}"].join("\n");return JSON.parse(X)}};