/*
	* jsAscii 0.1
	* Copyright (c) 2008 Jacob Seidelin, jseidelin@nihilogic.dk, http://blog.nihilogic.dk/
	* MIT License [http://www.nihilogic.dk/licenses/mit-license.txt]
	*/

THREE.AsciiEffect=function(e,t,i){function r(){g=Math.round(o*H),v=Math.round(a*H),x.width=g,x.height=v,E=e.domElement,E.style.backgroundColor&&(m.rows[0].cells[0].style.backgroundColor=E.style.backgroundColor,m.rows[0].cells[0].style.color=E.style.color),m.cellSpacing=0,m.cellPadding=0;var t=m.style;t.display="inline",t.width=Math.round(g/H*l)+"px",t.height=Math.round(v/H*l)+"px",t.whiteSpace="pre",t.margin="0px",t.padding="0px",t.letterSpacing=C+"px",t.fontFamily=_,t.fontSize=S+"px",t.lineHeight=M+"px",t.textAlign="left",t.textDecoration="none"}function n(e,t){R.clearRect(0,0,g,v),R.drawImage(b,0,0,g,v);for(var i=R.getImageData(0,0,g,v).data,r="",n=0;v>n;n+=2){for(var o=0;g>o;o++){var a,s,l=4*(n*g+o),p=i[l],f=i[l+1],m=i[l+2],E=i[l+3];s=(.3*p+.59*f+.11*m)/255,0==E&&(s=1),a=Math.floor((1-s)*(w.length-1)),d&&(a=w.length-a-1);var y=w[a];(void 0===y||" "==y)&&(y="&nbsp;"),r+=h?"<span style='color:rgb("+p+","+f+","+m+");"+(u?"background-color:rgb("+p+","+f+","+m+");":"")+(c?"opacity:"+E/255+";":"")+"'>"+y+"</span>":y}r+="<br/>"}t.innerHTML="<tr><td>"+r+"</td></tr>"}t=void 0===t?" .:-=+*#%@":t,i||(i={});var o,a,s=i.resolution?i.resolution:.15,l=i.scale?i.scale:1,h=i.color?i.color:!1,c=i.alpha?i.alpha:!1,u=i.block?i.block:!1,d=i.invert?i.invert:!1,p="low",f=document.createElement("div");f.style.cursor="default";var m=document.createElement("table");f.appendChild(m);var g,v,E;this.setSize=function(t,i){o=t,a=i,e.setSize(t,i),r()},this.render=function(t,i){e.render(t,i),n(e,m)},this.domElement=f;var y=" .,:;i1tfLCG08@".split(""),T=" CGO08@".split(""),_="courier new, monospace",b=e.domElement,x=document.createElement("canvas");if(x.getContext){var R=x.getContext("2d");if(R.getImageData){var w=h?T:y;t&&(w=t);var H=.5;switch(p){case"low":H=.25;break;case"medium":H=.5;break;case"high":H=1}s&&(H=s);var S=2/H*l,M=2/H*l,C=0;if("low"==p)switch(l){case 1:C=-1;break;case 2:case 3:C=-2.1;break;case 4:C=-3.1;break;case 5:C=-4.15}if("medium"==p)switch(l){case 1:C=0;break;case 2:C=-1;break;case 3:C=-1.04;break;case 4:case 5:C=-2.1}if("high"==p)switch(l){case 1:case 2:C=0;break;case 3:case 4:case 5:C=-1}}}};