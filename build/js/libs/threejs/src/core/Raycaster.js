fins(function(e){e.Raycaster=function(t,i,r,n){this.ray=new e.Ray(t,i);if(this.ray.direction.lengthSq()>0)this.ray.direction.normalize();this.near=r||0;this.far=n||1/0};var t=new e.Sphere;var i=new e.Ray;var r=new e.Plane;var n=new e.Vector3;var o=new e.Vector3;var a=new e.Matrix4;var s=function(e,t){return e.distance-t.distance};var l=function(s,c,h){if(s instanceof e.Particle){o.getPositionFromMatrix(s.matrixWorld);var u=c.ray.distanceToPoint(o);if(u>s.scale.x)return h;h.push({distance:u,point:s.position,face:null,object:s})}else if(s instanceof e.LOD){o.getPositionFromMatrix(s.matrixWorld);var u=c.ray.origin.distanceTo(o);l(s.getObjectForDistance(u),c,h)}else if(s instanceof e.Mesh){var f=s.geometry;o.getPositionFromMatrix(s.matrixWorld);if(null===f.boundingSphere)f.computeBoundingSphere();t.set(o,f.boundingSphere.radius*s.matrixWorld.getMaxScaleOnAxis());if(c.ray.isIntersectionSphere(t)===!1)return h;var d=f.vertices;if(f instanceof e.BufferGeometry){var p=s.material;if(void 0===p)return h;if(f.dynamic===!1)return h;var m=s.material instanceof e.MeshFaceMaterial;var v=m===!0?s.material.materials:null;var g=s.material.side;var E,y,T;var _=c.precision;a.getInverse(s.matrixWorld);i.copy(c.ray).applyMatrix4(a);var b;var x=!1;if(f.attributes.index){x=!0;b=f.attributes.index.numItems/3}else b=f.attributes.position.numItems/9;var R=new e.Vector3;var w=new e.Vector3;var H=new e.Vector3;new e.Vector3;new e.Vector3;for(var S=0;S<f.offsets.length;++S){var M=f.offsets[S].start;var C=f.offsets[S].count;var A=f.offsets[S].index;for(var D=M,P=M+C;P>D;D+=3){if(x){E=A+f.attributes.index.array[D];y=A+f.attributes.index.array[D+1];T=A+f.attributes.index.array[D+2]}else{E=A;y=A+1;T=A+2}R.set(f.attributes.position.array[3*E],f.attributes.position.array[3*E+1],f.attributes.position.array[3*E+2]);w.set(f.attributes.position.array[3*y],f.attributes.position.array[3*y+1],f.attributes.position.array[3*y+2]);H.set(f.attributes.position.array[3*T],f.attributes.position.array[3*T+1],f.attributes.position.array[3*T+2]);r.setFromCoplanarPoints(R,w,H);var L=i.distanceToPlane(r);if(!(_>L))if(null!==L){g=p.side;if(g!==e.DoubleSide){var N=i.direction.dot(r.normal);if(!(g===e.FrontSide?0>N:N>0))continue}if(!(L<c.near||L>c.far)){n=i.at(L,n);if(e.Triangle.containsPoint(n,R,w,H)!==!1)h.push({distance:L,point:c.ray.at(L),face:null,faceIndex:null,object:s});else;}else;}else;else;}}}else if(f instanceof e.Geometry){var m=s.material instanceof e.MeshFaceMaterial;var v=m===!0?s.material.materials:null;var g=s.material.side;var E,y,T,k;var _=c.precision;a.getInverse(s.matrixWorld);i.copy(c.ray).applyMatrix4(a);for(var F=0,b=f.faces.length;b>F;F++){var I=f.faces[F];var p=m===!0?v[I.materialIndex]:s.material;if(void 0!==p){r.setFromNormalAndCoplanarPoint(I.normal,d[I.a]);var L=i.distanceToPlane(r);if(!(_>L))if(null!==L){g=p.side;if(g!==e.DoubleSide){var N=i.direction.dot(r.normal);if(!(g===e.FrontSide?0>N:N>0))continue}if(!(L<c.near||L>c.far)){n=i.at(L,n);if(I instanceof e.Face3){E=d[I.a];y=d[I.b];T=d[I.c];if(e.Triangle.containsPoint(n,E,y,T)===!1)continue}else if(I instanceof e.Face4){E=d[I.a];y=d[I.b];T=d[I.c];k=d[I.d];if(e.Triangle.containsPoint(n,E,y,k)===!1&&e.Triangle.containsPoint(n,y,T,k)===!1)continue}else throw Error("face type not supported");h.push({distance:L,point:c.ray.at(L),face:I,faceIndex:F,object:s})}else;}else;else;}else;}}}else if(s instanceof e.Line){var _=c.linePrecision;var O=_*_;var f=s.geometry;if(null===f.boundingSphere)f.computeBoundingSphere();o.getPositionFromMatrix(s.matrixWorld);t.set(o,f.boundingSphere.radius*s.matrixWorld.getMaxScaleOnAxis());if(c.ray.isIntersectionSphere(t)===!1)return h;a.getInverse(s.matrixWorld);i.copy(c.ray).applyMatrix4(a);i.direction.normalize();var d=f.vertices;var U=d.length;var z=new e.Vector3;var B=new e.Vector3;var V=s.type===e.LineStrip?1:2;for(var D=0;U-1>D;D+=V){var j=i.distanceSqToSegment(d[D],d[D+1],B,z);if(O>=j){var u=i.origin.distanceTo(B);if(c.near<=u&&u<=c.far)h.push({distance:u,point:z.clone().applyMatrix4(s.matrixWorld),face:null,faceIndex:null,object:s})}}}};var c=function(e,t,i){var r=e.getDescendants();for(var n=0,o=r.length;o>n;n++)l(r[n],t,i)};e.Raycaster.prototype.precision=1e-4;e.Raycaster.prototype.linePrecision=1;e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t);if(this.ray.direction.length()>0)this.ray.direction.normalize()};e.Raycaster.prototype.intersectObject=function(e,t){var i=[];if(t===!0)c(e,this,i);l(e,this,i);i.sort(s);return i};e.Raycaster.prototype.intersectObjects=function(e,t){var i=[];for(var r=0,n=e.length;n>r;r++){l(e[r],this,i);if(t===!0)c(e[r],this,i)}i.sort(s);return i}}(THREE));