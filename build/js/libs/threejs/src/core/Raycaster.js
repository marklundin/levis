fins(function(e){e.Raycaster=function(t,i,r,n){this.ray=new e.Ray(t,i),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=r||0,this.far=n||1/0};var t=new e.Sphere,i=new e.Ray,r=new e.Plane,n=new e.Vector3,o=new e.Vector3,a=new e.Matrix4,s=function(e,t){return e.distance-t.distance},l=function(s,c,h){if(s instanceof e.Particle){o.getPositionFromMatrix(s.matrixWorld);var u=c.ray.distanceToPoint(o);if(u>s.scale.x)return h;h.push({distance:u,point:s.position,face:null,object:s})}else if(s instanceof e.LOD){o.getPositionFromMatrix(s.matrixWorld);var u=c.ray.origin.distanceTo(o);l(s.getObjectForDistance(u),c,h)}else if(s instanceof e.Mesh){var d=s.geometry;if(o.getPositionFromMatrix(s.matrixWorld),null===d.boundingSphere&&d.computeBoundingSphere(),t.set(o,d.boundingSphere.radius*s.matrixWorld.getMaxScaleOnAxis()),c.ray.isIntersectionSphere(t)===!1)return h;var p=d.vertices;if(d instanceof e.BufferGeometry){var f=s.material;if(void 0===f)return h;if(d.dynamic===!1)return h;var m,v,g,E=s.material instanceof e.MeshFaceMaterial,y=E===!0?s.material.materials:null,T=s.material.side,_=c.precision;a.getInverse(s.matrixWorld),i.copy(c.ray).applyMatrix4(a);var b,x=!1;d.attributes.index?(x=!0,b=d.attributes.index.numItems/3):b=d.attributes.position.numItems/9;var R=new e.Vector3,w=new e.Vector3,H=new e.Vector3;new e.Vector3,new e.Vector3;for(var S=0;S<d.offsets.length;++S)for(var M=d.offsets[S].start,C=d.offsets[S].count,A=d.offsets[S].index,D=M,P=M+C;P>D;D+=3){x?(m=A+d.attributes.index.array[D],v=A+d.attributes.index.array[D+1],g=A+d.attributes.index.array[D+2]):(m=A,v=A+1,g=A+2),R.set(d.attributes.position.array[3*m],d.attributes.position.array[3*m+1],d.attributes.position.array[3*m+2]),w.set(d.attributes.position.array[3*v],d.attributes.position.array[3*v+1],d.attributes.position.array[3*v+2]),H.set(d.attributes.position.array[3*g],d.attributes.position.array[3*g+1],d.attributes.position.array[3*g+2]),r.setFromCoplanarPoints(R,w,H);var L=i.distanceToPlane(r);if(!(_>L)&&null!==L){if(T=f.side,T!==e.DoubleSide){var N=i.direction.dot(r.normal);if(!(T===e.FrontSide?0>N:N>0))continue}L<c.near||L>c.far||(n=i.at(L,n),e.Triangle.containsPoint(n,R,w,H)!==!1&&h.push({distance:L,point:c.ray.at(L),face:null,faceIndex:null,object:s}))}}}else if(d instanceof e.Geometry){var m,v,g,F,E=s.material instanceof e.MeshFaceMaterial,y=E===!0?s.material.materials:null,T=s.material.side,_=c.precision;a.getInverse(s.matrixWorld),i.copy(c.ray).applyMatrix4(a);for(var I=0,b=d.faces.length;b>I;I++){var k=d.faces[I],f=E===!0?y[k.materialIndex]:s.material;if(void 0!==f){r.setFromNormalAndCoplanarPoint(k.normal,p[k.a]);var L=i.distanceToPlane(r);if(!(_>L)&&null!==L){if(T=f.side,T!==e.DoubleSide){var N=i.direction.dot(r.normal);if(!(T===e.FrontSide?0>N:N>0))continue}if(!(L<c.near||L>c.far)){if(n=i.at(L,n),k instanceof e.Face3){if(m=p[k.a],v=p[k.b],g=p[k.c],e.Triangle.containsPoint(n,m,v,g)===!1)continue}else{if(!(k instanceof e.Face4))throw Error("face type not supported");if(m=p[k.a],v=p[k.b],g=p[k.c],F=p[k.d],e.Triangle.containsPoint(n,m,v,F)===!1&&e.Triangle.containsPoint(n,v,g,F)===!1)continue}h.push({distance:L,point:c.ray.at(L),face:k,faceIndex:I,object:s})}}}}}}else if(s instanceof e.Line){var _=c.linePrecision,O=_*_,d=s.geometry;if(null===d.boundingSphere&&d.computeBoundingSphere(),o.getPositionFromMatrix(s.matrixWorld),t.set(o,d.boundingSphere.radius*s.matrixWorld.getMaxScaleOnAxis()),c.ray.isIntersectionSphere(t)===!1)return h;a.getInverse(s.matrixWorld),i.copy(c.ray).applyMatrix4(a),i.direction.normalize();for(var p=d.vertices,U=p.length,z=new e.Vector3,B=new e.Vector3,V=s.type===e.LineStrip?1:2,D=0;U-1>D;D+=V){var j=i.distanceSqToSegment(p[D],p[D+1],B,z);if(O>=j){var u=i.origin.distanceTo(B);c.near<=u&&u<=c.far&&h.push({distance:u,point:z.clone().applyMatrix4(s.matrixWorld),face:null,faceIndex:null,object:s})}}}},c=function(e,t,i){for(var r=e.getDescendants(),n=0,o=r.length;o>n;n++)l(r[n],t,i)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t),this.ray.direction.length()>0&&this.ray.direction.normalize()},e.Raycaster.prototype.intersectObject=function(e,t){var i=[];return t===!0&&c(e,this,i),l(e,this,i),i.sort(s),i},e.Raycaster.prototype.intersectObjects=function(e,t){for(var i=[],r=0,n=e.length;n>r;r++)l(e[r],this,i),t===!0&&c(e[r],this,i);return i.sort(s),i}}(THREE));