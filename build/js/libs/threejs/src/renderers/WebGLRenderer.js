THREE.WebGLRenderer=function(e){function t(e){e.__webglVertexBuffer=Ti.createBuffer();e.__webglColorBuffer=Ti.createBuffer();It.info.memory.geometries++}function i(e){e.__webglVertexBuffer=Ti.createBuffer();e.__webglColorBuffer=Ti.createBuffer();e.__webglLineDistanceBuffer=Ti.createBuffer();It.info.memory.geometries++}function r(e){e.__webglVertexBuffer=Ti.createBuffer();e.__webglColorBuffer=Ti.createBuffer();e.__webglNormalBuffer=Ti.createBuffer();It.info.memory.geometries++}function a(e){e.__webglVertexBuffer=Ti.createBuffer();e.__webglNormalBuffer=Ti.createBuffer();e.__webglTangentBuffer=Ti.createBuffer();e.__webglColorBuffer=Ti.createBuffer();e.__webglUVBuffer=Ti.createBuffer();e.__webglUV2Buffer=Ti.createBuffer();e.__webglSkinIndicesBuffer=Ti.createBuffer();e.__webglSkinWeightsBuffer=Ti.createBuffer();e.__webglFaceBuffer=Ti.createBuffer();e.__webglLineBuffer=Ti.createBuffer();var t,i;if(e.numMorphTargets){e.__webglMorphTargetsBuffers=[];for(t=0,i=e.numMorphTargets;i>t;t++)e.__webglMorphTargetsBuffers.push(Ti.createBuffer())}if(e.numMorphNormals){e.__webglMorphNormalsBuffers=[];for(t=0,i=e.numMorphNormals;i>t;t++)e.__webglMorphNormalsBuffers.push(Ti.createBuffer())}It.info.memory.geometries++}function n(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Ti.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function o(e,t){var i=e.vertices.length;var r=t.material;if(r.attributes){if(void 0===e.__webglCustomAttributesList)e.__webglCustomAttributesList=[];for(var a in r.attributes){var n=r.attributes[a];if(!n.__webglInitialized||n.createUniqueBuffers){n.__webglInitialized=!0;var o=1;if("v2"===n.type)o=2;else if("v3"===n.type)o=3;else if("v4"===n.type)o=4;else if("c"===n.type)o=3;n.size=o;n.array=new Float32Array(i*o);n.buffer=Ti.createBuffer();n.buffer.belongsToAttribute=a;n.needsUpdate=!0}e.__webglCustomAttributesList.push(n)}}}function s(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i);e.__colorArray=new Float32Array(3*i);e.__sortArray=[];e.__webglParticleCount=i;o(e,t)}function l(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i);e.__colorArray=new Float32Array(3*i);e.__lineDistanceArray=new Float32Array(1*i);e.__webglLineCount=i;o(e,t)}function c(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i);e.__colorArray=new Float32Array(3*i);e.__normalArray=new Float32Array(3*i);e.__webglVertexCount=i;o(e,t)}function h(e,t){var i=t.geometry,r=e.faces3,a=e.faces4,n=3*r.length+4*a.length,o=1*r.length+2*a.length,s=3*r.length+4*a.length,l=u(t,e),c=m(l),h=d(l),f=p(l);e.__vertexArray=new Float32Array(3*n);if(h)e.__normalArray=new Float32Array(3*n);if(i.hasTangents)e.__tangentArray=new Float32Array(4*n);if(f)e.__colorArray=new Float32Array(3*n);if(c){if(i.faceUvs.length>0||i.faceVertexUvs.length>0)e.__uvArray=new Float32Array(2*n);if(i.faceUvs.length>1||i.faceVertexUvs.length>1)e.__uv2Array=new Float32Array(2*n)}if(t.geometry.skinWeights.length&&t.geometry.skinIndices.length){e.__skinIndexArray=new Float32Array(4*n);e.__skinWeightArray=new Float32Array(4*n)}e.__faceArray=new Uint16Array(3*o);e.__lineArray=new Uint16Array(2*s);var v,g;if(e.numMorphTargets){e.__morphTargetsArrays=[];for(v=0,g=e.numMorphTargets;g>v;v++)e.__morphTargetsArrays.push(new Float32Array(3*n))}if(e.numMorphNormals){e.__morphNormalsArrays=[];for(v=0,g=e.numMorphNormals;g>v;v++)e.__morphNormalsArrays.push(new Float32Array(3*n))}e.__webglFaceCount=3*o;e.__webglLineCount=2*s;if(l.attributes){if(void 0===e.__webglCustomAttributesList)e.__webglCustomAttributesList=[];for(var E in l.attributes){var y=l.attributes[E];var T={};for(var x in y)T[x]=y[x];if(!T.__webglInitialized||T.createUniqueBuffers){T.__webglInitialized=!0;var R=1;if("v2"===T.type)R=2;else if("v3"===T.type)R=3;else if("v4"===T.type)R=4;else if("c"===T.type)R=3;T.size=R;T.array=new Float32Array(n*R);T.buffer=Ti.createBuffer();T.buffer.belongsToAttribute=E;y.needsUpdate=!0;T.__original=y}e.__webglCustomAttributesList.push(T)}}e.__inittedArrays=!0}function u(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function f(e){return e&&void 0!==e.shading&&e.shading===THREE.SmoothShading}function d(e){if(e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial)return!1;if(f(e))return THREE.SmoothShading;else return THREE.FlatShading}function p(e){if(e.vertexColors)return e.vertexColors;else return!1}function m(e){if(e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial)return!0;else return!1}function v(e){var t,i,r;for(t in e.attributes){if("index"===t)r=Ti.ELEMENT_ARRAY_BUFFER;else r=Ti.ARRAY_BUFFER;i=e.attributes[t];if(void 0===i.numItems)i.numItems=i.array.length;i.buffer=Ti.createBuffer();Ti.bindBuffer(r,i.buffer);Ti.bufferData(r,i.array,Ti.STATIC_DRAW)}}function g(e,t,i){var r,a,n,o,s,l,c,h,u,f,d,p,m=e.vertices,v=m.length,g=e.colors,E=g.length,y=e.__vertexArray,T=e.__colorArray,x=e.__sortArray,R=e.verticesNeedUpdate,b=(e.elementsNeedUpdate,e.colorsNeedUpdate),_=e.__webglCustomAttributesList;if(i.sortParticles){mi.copy(pi);mi.multiply(i.matrixWorld);for(r=0;v>r;r++){n=m[r];vi.copy(n);vi.applyProjection(mi);x[r]=[vi.z,r]}x.sort(H);for(r=0;v>r;r++){n=m[x[r][1]];o=3*r;y[o]=n.x;y[o+1]=n.y;y[o+2]=n.z}for(a=0;E>a;a++){o=3*a;l=g[x[a][1]];T[o]=l.r;T[o+1]=l.g;T[o+2]=l.b}if(_)for(c=0,h=_.length;h>c;c++){p=_[c];if(void 0===p.boundTo||"vertices"===p.boundTo){o=0;f=p.value.length;if(1===p.size)for(u=0;f>u;u++){s=x[u][1];p.array[u]=p.value[s]}else if(2===p.size)for(u=0;f>u;u++){s=x[u][1];d=p.value[s];p.array[o]=d.x;p.array[o+1]=d.y;o+=2}else if(3===p.size)if("c"===p.type)for(u=0;f>u;u++){s=x[u][1];d=p.value[s];p.array[o]=d.r;p.array[o+1]=d.g;p.array[o+2]=d.b;o+=3}else for(u=0;f>u;u++){s=x[u][1];d=p.value[s];p.array[o]=d.x;p.array[o+1]=d.y;p.array[o+2]=d.z;o+=3}else if(4===p.size)for(u=0;f>u;u++){s=x[u][1];d=p.value[s];p.array[o]=d.x;p.array[o+1]=d.y;p.array[o+2]=d.z;p.array[o+3]=d.w;o+=4}}else;}}else{if(R)for(r=0;v>r;r++){n=m[r];o=3*r;y[o]=n.x;y[o+1]=n.y;y[o+2]=n.z}if(b)for(a=0;E>a;a++){l=g[a];o=3*a;T[o]=l.r;T[o+1]=l.g;T[o+2]=l.b}if(_)for(c=0,h=_.length;h>c;c++){p=_[c];if(p.needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo)){f=p.value.length;o=0;if(1===p.size)for(u=0;f>u;u++)p.array[u]=p.value[u];else if(2===p.size)for(u=0;f>u;u++){d=p.value[u];p.array[o]=d.x;p.array[o+1]=d.y;o+=2}else if(3===p.size)if("c"===p.type)for(u=0;f>u;u++){d=p.value[u];p.array[o]=d.r;p.array[o+1]=d.g;p.array[o+2]=d.b;o+=3}else for(u=0;f>u;u++){d=p.value[u];p.array[o]=d.x;p.array[o+1]=d.y;p.array[o+2]=d.z;o+=3}else if(4===p.size)for(u=0;f>u;u++){d=p.value[u];p.array[o]=d.x;p.array[o+1]=d.y;p.array[o+2]=d.z;p.array[o+3]=d.w;o+=4}}}}if(R||i.sortParticles){Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglVertexBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,y,t)}if(b||i.sortParticles){Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglColorBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,T,t)}if(_)for(c=0,h=_.length;h>c;c++){p=_[c];if(p.needsUpdate||i.sortParticles){Ti.bindBuffer(Ti.ARRAY_BUFFER,p.buffer);Ti.bufferData(Ti.ARRAY_BUFFER,p.array,t)}}}function E(e,t){var i,r,a,n,o,s,l,c,h,u,f,d,p=e.vertices,m=e.colors,v=e.lineDistances,g=p.length,E=m.length,y=v.length,T=e.__vertexArray,x=e.__colorArray,R=e.__lineDistanceArray,b=e.verticesNeedUpdate,_=e.colorsNeedUpdate,w=e.lineDistancesNeedUpdate,H=e.__webglCustomAttributesList;if(b){for(i=0;g>i;i++){n=p[i];o=3*i;T[o]=n.x;T[o+1]=n.y;T[o+2]=n.z}Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglVertexBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,T,t)}if(_){for(r=0;E>r;r++){s=m[r];o=3*r;x[o]=s.r;x[o+1]=s.g;x[o+2]=s.b}Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglColorBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,x,t)}if(w){for(a=0;y>a;a++)R[a]=v[a];Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglLineDistanceBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,R,t)}if(H)for(l=0,c=H.length;c>l;l++){d=H[l];if(d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){o=0;u=d.value.length;if(1===d.size)for(h=0;u>h;h++)d.array[h]=d.value[h];else if(2===d.size)for(h=0;u>h;h++){f=d.value[h];d.array[o]=f.x;d.array[o+1]=f.y;o+=2}else if(3===d.size)if("c"===d.type)for(h=0;u>h;h++){f=d.value[h];d.array[o]=f.r;d.array[o+1]=f.g;d.array[o+2]=f.b;o+=3}else for(h=0;u>h;h++){f=d.value[h];d.array[o]=f.x;d.array[o+1]=f.y;d.array[o+2]=f.z;o+=3}else if(4===d.size)for(h=0;u>h;h++){f=d.value[h];d.array[o]=f.x;d.array[o+1]=f.y;d.array[o+2]=f.z;d.array[o+3]=f.w;o+=4}Ti.bindBuffer(Ti.ARRAY_BUFFER,d.buffer);Ti.bufferData(Ti.ARRAY_BUFFER,d.array,t)}}}function y(e,t){var i,r,a,n,o,s,l,c,h,u,f,d,p,m=e.vertices,v=e.colors,g=e.normals,E=m.length,y=v.length,T=g.length,x=e.__vertexArray,R=e.__colorArray,b=e.__normalArray,_=e.verticesNeedUpdate,w=e.colorsNeedUpdate,H=e.normalsNeedUpdate,M=e.__webglCustomAttributesList;if(_){for(i=0;E>i;i++){n=m[i];o=3*i;x[o]=n.x;x[o+1]=n.y;x[o+2]=n.z}Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglVertexBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,x,t)}if(w){for(r=0;y>r;r++){s=v[r];o=3*r;R[o]=s.r;R[o+1]=s.g;R[o+2]=s.b}Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglColorBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,R,t)}if(H){for(a=0;T>a;a++){l=g[a];o=3*a;b[o]=l.x;b[o+1]=l.y;b[o+2]=l.z}Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglNormalBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,b,t)}if(M)for(c=0,h=M.length;h>c;c++){d=M[c];if(d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){o=0;f=d.value.length;if(1===d.size)for(u=0;f>u;u++)d.array[u]=d.value[u];else if(2===d.size)for(u=0;f>u;u++){p=d.value[u];d.array[o]=p.x;d.array[o+1]=p.y;o+=2}else if(3===d.size)if("c"===d.type)for(u=0;f>u;u++){p=d.value[u];d.array[o]=p.r;d.array[o+1]=p.g;d.array[o+2]=p.b;o+=3}else for(u=0;f>u;u++){p=d.value[u];d.array[o]=p.x;d.array[o+1]=p.y;d.array[o+2]=p.z;o+=3}else if(4===d.size)for(u=0;f>u;u++){p=d.value[u];d.array[o]=p.x;d.array[o+1]=p.y;d.array[o+2]=p.z;d.array[o+3]=p.w;o+=4}Ti.bindBuffer(Ti.ARRAY_BUFFER,d.buffer);Ti.bufferData(Ti.ARRAY_BUFFER,d.array,t)}}}function T(e,t,i,r,a){if(e.__inittedArrays){var n=d(a),o=p(a),s=m(a),l=n===THREE.SmoothShading;var c,h,u,f,v,g,E,y,T,x,R,b,_,w,H,M,S,C,A,D,P,L,F,N,U,O,I,k,z,B,V,j,G,W,X,Y,q,K,Z,Q,$,J,et,tt,it,rt,at,nt,ot=0,st=0,lt=0,ct=0,ht=0,ut=0,ft=0,dt=0,pt=0,mt=0,vt=0,gt=0,Et=0,yt=e.__vertexArray,Tt=e.__uvArray,xt=e.__uv2Array,Rt=e.__normalArray,bt=e.__tangentArray,_t=e.__colorArray,wt=e.__skinIndexArray,Ht=e.__skinWeightArray,Mt=e.__morphTargetsArrays,St=e.__morphNormalsArrays,Ct=e.__webglCustomAttributesList,At=e.__faceArray,Dt=e.__lineArray,Pt=t.geometry,Lt=Pt.verticesNeedUpdate,Ft=Pt.elementsNeedUpdate,Nt=Pt.uvsNeedUpdate,Ut=Pt.normalsNeedUpdate,Ot=Pt.tangentsNeedUpdate,It=Pt.colorsNeedUpdate,kt=Pt.morphTargetsNeedUpdate,zt=Pt.vertices,Bt=e.faces3,Vt=e.faces4,jt=Pt.faces,Gt=Pt.faceVertexUvs[0],Wt=Pt.faceVertexUvs[1],Xt=(Pt.colors,Pt.skinIndices),Yt=Pt.skinWeights,qt=Pt.morphTargets,Kt=Pt.morphNormals;if(Lt){for(c=0,h=Bt.length;h>c;c++){f=jt[Bt[c]];b=zt[f.a];_=zt[f.b];w=zt[f.c];yt[st]=b.x;yt[st+1]=b.y;yt[st+2]=b.z;yt[st+3]=_.x;yt[st+4]=_.y;yt[st+5]=_.z;yt[st+6]=w.x;yt[st+7]=w.y;yt[st+8]=w.z;st+=9}for(c=0,h=Vt.length;h>c;c++){f=jt[Vt[c]];b=zt[f.a];_=zt[f.b];w=zt[f.c];H=zt[f.d];yt[st]=b.x;yt[st+1]=b.y;yt[st+2]=b.z;yt[st+3]=_.x;yt[st+4]=_.y;yt[st+5]=_.z;yt[st+6]=w.x;yt[st+7]=w.y;yt[st+8]=w.z;yt[st+9]=H.x;yt[st+10]=H.y;yt[st+11]=H.z;st+=12}Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglVertexBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,yt,i)}if(kt)for($=0,J=qt.length;J>$;$++){vt=0;for(c=0,h=Bt.length;h>c;c++){it=Bt[c];f=jt[it];b=qt[$].vertices[f.a];_=qt[$].vertices[f.b];w=qt[$].vertices[f.c];et=Mt[$];et[vt]=b.x;et[vt+1]=b.y;et[vt+2]=b.z;et[vt+3]=_.x;et[vt+4]=_.y;et[vt+5]=_.z;et[vt+6]=w.x;et[vt+7]=w.y;et[vt+8]=w.z;if(a.morphNormals){if(l){rt=Kt[$].vertexNormals[it];D=rt.a;P=rt.b;L=rt.c}else{D=Kt[$].faceNormals[it];P=D;L=D}tt=St[$];tt[vt]=D.x;tt[vt+1]=D.y;tt[vt+2]=D.z;tt[vt+3]=P.x;tt[vt+4]=P.y;tt[vt+5]=P.z;tt[vt+6]=L.x;tt[vt+7]=L.y;tt[vt+8]=L.z}vt+=9}for(c=0,h=Vt.length;h>c;c++){it=Vt[c];f=jt[it];b=qt[$].vertices[f.a];_=qt[$].vertices[f.b];w=qt[$].vertices[f.c];H=qt[$].vertices[f.d];et=Mt[$];et[vt]=b.x;et[vt+1]=b.y;et[vt+2]=b.z;et[vt+3]=_.x;et[vt+4]=_.y;et[vt+5]=_.z;et[vt+6]=w.x;et[vt+7]=w.y;et[vt+8]=w.z;et[vt+9]=H.x;et[vt+10]=H.y;et[vt+11]=H.z;if(a.morphNormals){if(l){rt=Kt[$].vertexNormals[it];D=rt.a;P=rt.b;L=rt.c;F=rt.d}else{D=Kt[$].faceNormals[it];P=D;L=D;F=D}tt=St[$];tt[vt]=D.x;tt[vt+1]=D.y;tt[vt+2]=D.z;tt[vt+3]=P.x;tt[vt+4]=P.y;tt[vt+5]=P.z;tt[vt+6]=L.x;tt[vt+7]=L.y;tt[vt+8]=L.z;tt[vt+9]=F.x;tt[vt+10]=F.y;tt[vt+11]=F.z}vt+=12}Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[$]);Ti.bufferData(Ti.ARRAY_BUFFER,Mt[$],i);if(a.morphNormals){Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[$]);Ti.bufferData(Ti.ARRAY_BUFFER,St[$],i)}}if(Yt.length){for(c=0,h=Bt.length;h>c;c++){f=jt[Bt[c]];k=Yt[f.a];z=Yt[f.b];B=Yt[f.c];Ht[mt]=k.x;Ht[mt+1]=k.y;Ht[mt+2]=k.z;Ht[mt+3]=k.w;Ht[mt+4]=z.x;Ht[mt+5]=z.y;Ht[mt+6]=z.z;Ht[mt+7]=z.w;Ht[mt+8]=B.x;Ht[mt+9]=B.y;Ht[mt+10]=B.z;Ht[mt+11]=B.w;j=Xt[f.a];G=Xt[f.b];W=Xt[f.c];wt[mt]=j.x;wt[mt+1]=j.y;wt[mt+2]=j.z;wt[mt+3]=j.w;wt[mt+4]=G.x;wt[mt+5]=G.y;wt[mt+6]=G.z;wt[mt+7]=G.w;wt[mt+8]=W.x;wt[mt+9]=W.y;wt[mt+10]=W.z;wt[mt+11]=W.w;mt+=12}for(c=0,h=Vt.length;h>c;c++){f=jt[Vt[c]];k=Yt[f.a];z=Yt[f.b];B=Yt[f.c];V=Yt[f.d];Ht[mt]=k.x;Ht[mt+1]=k.y;Ht[mt+2]=k.z;Ht[mt+3]=k.w;Ht[mt+4]=z.x;Ht[mt+5]=z.y;Ht[mt+6]=z.z;Ht[mt+7]=z.w;Ht[mt+8]=B.x;Ht[mt+9]=B.y;Ht[mt+10]=B.z;Ht[mt+11]=B.w;Ht[mt+12]=V.x;Ht[mt+13]=V.y;Ht[mt+14]=V.z;Ht[mt+15]=V.w;j=Xt[f.a];G=Xt[f.b];W=Xt[f.c];X=Xt[f.d];wt[mt]=j.x;wt[mt+1]=j.y;wt[mt+2]=j.z;wt[mt+3]=j.w;wt[mt+4]=G.x;wt[mt+5]=G.y;wt[mt+6]=G.z;wt[mt+7]=G.w;wt[mt+8]=W.x;wt[mt+9]=W.y;wt[mt+10]=W.z;wt[mt+11]=W.w;wt[mt+12]=X.x;wt[mt+13]=X.y;wt[mt+14]=X.z;wt[mt+15]=X.w;mt+=16}if(mt>0){Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglSkinIndicesBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,wt,i);Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglSkinWeightsBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,Ht,i)}}if(It&&o){for(c=0,h=Bt.length;h>c;c++){f=jt[Bt[c]];E=f.vertexColors;y=f.color;if(3===E.length&&o===THREE.VertexColors){N=E[0];U=E[1];O=E[2]}else{N=y;U=y;O=y}_t[pt]=N.r;_t[pt+1]=N.g;_t[pt+2]=N.b;_t[pt+3]=U.r;_t[pt+4]=U.g;_t[pt+5]=U.b;_t[pt+6]=O.r;_t[pt+7]=O.g;_t[pt+8]=O.b;pt+=9}for(c=0,h=Vt.length;h>c;c++){f=jt[Vt[c]];E=f.vertexColors;y=f.color;if(4===E.length&&o===THREE.VertexColors){N=E[0];U=E[1];O=E[2];I=E[3]}else{N=y;U=y;O=y;I=y}_t[pt]=N.r;_t[pt+1]=N.g;_t[pt+2]=N.b;_t[pt+3]=U.r;_t[pt+4]=U.g;_t[pt+5]=U.b;_t[pt+6]=O.r;_t[pt+7]=O.g;_t[pt+8]=O.b;_t[pt+9]=I.r;_t[pt+10]=I.g;_t[pt+11]=I.b;pt+=12}if(pt>0){Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglColorBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,_t,i)}}if(Ot&&Pt.hasTangents){for(c=0,h=Bt.length;h>c;c++){f=jt[Bt[c]];T=f.vertexTangents;M=T[0];S=T[1];C=T[2];bt[ft]=M.x;bt[ft+1]=M.y;bt[ft+2]=M.z;bt[ft+3]=M.w;bt[ft+4]=S.x;bt[ft+5]=S.y;bt[ft+6]=S.z;bt[ft+7]=S.w;bt[ft+8]=C.x;bt[ft+9]=C.y;bt[ft+10]=C.z;bt[ft+11]=C.w;ft+=12}for(c=0,h=Vt.length;h>c;c++){f=jt[Vt[c]];T=f.vertexTangents;M=T[0];S=T[1];C=T[2];A=T[3];bt[ft]=M.x;bt[ft+1]=M.y;bt[ft+2]=M.z;bt[ft+3]=M.w;bt[ft+4]=S.x;bt[ft+5]=S.y;bt[ft+6]=S.z;bt[ft+7]=S.w;bt[ft+8]=C.x;bt[ft+9]=C.y;bt[ft+10]=C.z;bt[ft+11]=C.w;bt[ft+12]=A.x;bt[ft+13]=A.y;bt[ft+14]=A.z;bt[ft+15]=A.w;ft+=16}Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglTangentBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,bt,i)}if(Ut&&n){for(c=0,h=Bt.length;h>c;c++){f=jt[Bt[c]];v=f.vertexNormals;g=f.normal;if(3===v.length&&l)for(Y=0;3>Y;Y++){K=v[Y];Rt[ut]=K.x;Rt[ut+1]=K.y;Rt[ut+2]=K.z;ut+=3}else for(Y=0;3>Y;Y++){Rt[ut]=g.x;Rt[ut+1]=g.y;Rt[ut+2]=g.z;ut+=3}}for(c=0,h=Vt.length;h>c;c++){f=jt[Vt[c]];v=f.vertexNormals;g=f.normal;if(4===v.length&&l)for(Y=0;4>Y;Y++){K=v[Y];Rt[ut]=K.x;Rt[ut+1]=K.y;Rt[ut+2]=K.z;ut+=3}else for(Y=0;4>Y;Y++){Rt[ut]=g.x;Rt[ut+1]=g.y;Rt[ut+2]=g.z;ut+=3}}Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglNormalBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,Rt,i)}if(Nt&&Gt&&s){for(c=0,h=Bt.length;h>c;c++){u=Bt[c];x=Gt[u];if(void 0!==x)for(Y=0;3>Y;Y++){Z=x[Y];Tt[lt]=Z.x;Tt[lt+1]=Z.y;lt+=2}else;}for(c=0,h=Vt.length;h>c;c++){u=Vt[c];x=Gt[u];if(void 0!==x)for(Y=0;4>Y;Y++){Z=x[Y];Tt[lt]=Z.x;Tt[lt+1]=Z.y;lt+=2}else;}if(lt>0){Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglUVBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,Tt,i)}}if(Nt&&Wt&&s){for(c=0,h=Bt.length;h>c;c++){u=Bt[c];R=Wt[u];if(void 0!==R)for(Y=0;3>Y;Y++){Q=R[Y];xt[ct]=Q.x;xt[ct+1]=Q.y;ct+=2}else;}for(c=0,h=Vt.length;h>c;c++){u=Vt[c];R=Wt[u];if(void 0!==R)for(Y=0;4>Y;Y++){Q=R[Y];xt[ct]=Q.x;xt[ct+1]=Q.y;ct+=2}else;}if(ct>0){Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglUV2Buffer);Ti.bufferData(Ti.ARRAY_BUFFER,xt,i)}}if(Ft){for(c=0,h=Bt.length;h>c;c++){At[ht]=ot;At[ht+1]=ot+1;At[ht+2]=ot+2;ht+=3;Dt[dt]=ot;Dt[dt+1]=ot+1;Dt[dt+2]=ot;Dt[dt+3]=ot+2;Dt[dt+4]=ot+1;Dt[dt+5]=ot+2;dt+=6;ot+=3}for(c=0,h=Vt.length;h>c;c++){At[ht]=ot;At[ht+1]=ot+1;At[ht+2]=ot+3;At[ht+3]=ot+1;At[ht+4]=ot+2;At[ht+5]=ot+3;ht+=6;Dt[dt]=ot;Dt[dt+1]=ot+1;Dt[dt+2]=ot;Dt[dt+3]=ot+3;Dt[dt+4]=ot+1;Dt[dt+5]=ot+2;Dt[dt+6]=ot+2;Dt[dt+7]=ot+3;dt+=8;ot+=4}Ti.bindBuffer(Ti.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer);Ti.bufferData(Ti.ELEMENT_ARRAY_BUFFER,At,i);Ti.bindBuffer(Ti.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer);Ti.bufferData(Ti.ELEMENT_ARRAY_BUFFER,Dt,i)}if(Ct)for(Y=0,q=Ct.length;q>Y;Y++){nt=Ct[Y];if(nt.__original.needsUpdate){gt=0;Et=0;if(1===nt.size){if(void 0===nt.boundTo||"vertices"===nt.boundTo){for(c=0,h=Bt.length;h>c;c++){f=jt[Bt[c]];nt.array[gt]=nt.value[f.a];nt.array[gt+1]=nt.value[f.b];nt.array[gt+2]=nt.value[f.c];gt+=3}for(c=0,h=Vt.length;h>c;c++){f=jt[Vt[c]];nt.array[gt]=nt.value[f.a];nt.array[gt+1]=nt.value[f.b];nt.array[gt+2]=nt.value[f.c];nt.array[gt+3]=nt.value[f.d];gt+=4}}else if("faces"===nt.boundTo){for(c=0,h=Bt.length;h>c;c++){at=nt.value[Bt[c]];nt.array[gt]=at;nt.array[gt+1]=at;nt.array[gt+2]=at;gt+=3}for(c=0,h=Vt.length;h>c;c++){at=nt.value[Vt[c]];nt.array[gt]=at;nt.array[gt+1]=at;nt.array[gt+2]=at;nt.array[gt+3]=at;gt+=4}}}else if(2===nt.size){if(void 0===nt.boundTo||"vertices"===nt.boundTo){for(c=0,h=Bt.length;h>c;c++){f=jt[Bt[c]];b=nt.value[f.a];_=nt.value[f.b];w=nt.value[f.c];nt.array[gt]=b.x;nt.array[gt+1]=b.y;nt.array[gt+2]=_.x;nt.array[gt+3]=_.y;nt.array[gt+4]=w.x;nt.array[gt+5]=w.y;gt+=6}for(c=0,h=Vt.length;h>c;c++){f=jt[Vt[c]];b=nt.value[f.a];_=nt.value[f.b];w=nt.value[f.c];H=nt.value[f.d];nt.array[gt]=b.x;nt.array[gt+1]=b.y;nt.array[gt+2]=_.x;nt.array[gt+3]=_.y;nt.array[gt+4]=w.x;nt.array[gt+5]=w.y;nt.array[gt+6]=H.x;nt.array[gt+7]=H.y;gt+=8}}else if("faces"===nt.boundTo){for(c=0,h=Bt.length;h>c;c++){at=nt.value[Bt[c]];b=at;_=at;w=at;nt.array[gt]=b.x;nt.array[gt+1]=b.y;nt.array[gt+2]=_.x;nt.array[gt+3]=_.y;nt.array[gt+4]=w.x;nt.array[gt+5]=w.y;gt+=6}for(c=0,h=Vt.length;h>c;c++){at=nt.value[Vt[c]];b=at;_=at;w=at;H=at;nt.array[gt]=b.x;nt.array[gt+1]=b.y;nt.array[gt+2]=_.x;nt.array[gt+3]=_.y;nt.array[gt+4]=w.x;nt.array[gt+5]=w.y;nt.array[gt+6]=H.x;nt.array[gt+7]=H.y;gt+=8}}}else if(3===nt.size){var Zt;if("c"===nt.type)Zt=["r","g","b"];else Zt=["x","y","z"];if(void 0===nt.boundTo||"vertices"===nt.boundTo){for(c=0,h=Bt.length;h>c;c++){f=jt[Bt[c]];b=nt.value[f.a];_=nt.value[f.b];w=nt.value[f.c];nt.array[gt]=b[Zt[0]];nt.array[gt+1]=b[Zt[1]];nt.array[gt+2]=b[Zt[2]];nt.array[gt+3]=_[Zt[0]];nt.array[gt+4]=_[Zt[1]];nt.array[gt+5]=_[Zt[2]];nt.array[gt+6]=w[Zt[0]];nt.array[gt+7]=w[Zt[1]];nt.array[gt+8]=w[Zt[2]];gt+=9}for(c=0,h=Vt.length;h>c;c++){f=jt[Vt[c]];b=nt.value[f.a];_=nt.value[f.b];w=nt.value[f.c];H=nt.value[f.d];nt.array[gt]=b[Zt[0]];nt.array[gt+1]=b[Zt[1]];nt.array[gt+2]=b[Zt[2]];nt.array[gt+3]=_[Zt[0]];nt.array[gt+4]=_[Zt[1]];nt.array[gt+5]=_[Zt[2]];nt.array[gt+6]=w[Zt[0]];nt.array[gt+7]=w[Zt[1]];nt.array[gt+8]=w[Zt[2]];nt.array[gt+9]=H[Zt[0]];nt.array[gt+10]=H[Zt[1]];nt.array[gt+11]=H[Zt[2]];gt+=12}}else if("faces"===nt.boundTo){for(c=0,h=Bt.length;h>c;c++){at=nt.value[Bt[c]];b=at;_=at;w=at;nt.array[gt]=b[Zt[0]];nt.array[gt+1]=b[Zt[1]];nt.array[gt+2]=b[Zt[2]];nt.array[gt+3]=_[Zt[0]];nt.array[gt+4]=_[Zt[1]];nt.array[gt+5]=_[Zt[2]];nt.array[gt+6]=w[Zt[0]];nt.array[gt+7]=w[Zt[1]];nt.array[gt+8]=w[Zt[2]];gt+=9}for(c=0,h=Vt.length;h>c;c++){at=nt.value[Vt[c]];b=at;_=at;w=at;H=at;nt.array[gt]=b[Zt[0]];nt.array[gt+1]=b[Zt[1]];nt.array[gt+2]=b[Zt[2]];nt.array[gt+3]=_[Zt[0]];nt.array[gt+4]=_[Zt[1]];nt.array[gt+5]=_[Zt[2]];nt.array[gt+6]=w[Zt[0]];nt.array[gt+7]=w[Zt[1]];nt.array[gt+8]=w[Zt[2]];nt.array[gt+9]=H[Zt[0]];nt.array[gt+10]=H[Zt[1]];nt.array[gt+11]=H[Zt[2]];gt+=12}}else if("faceVertices"===nt.boundTo){for(c=0,h=Bt.length;h>c;c++){at=nt.value[Bt[c]];b=at[0];_=at[1];w=at[2];nt.array[gt]=b[Zt[0]];nt.array[gt+1]=b[Zt[1]];nt.array[gt+2]=b[Zt[2]];nt.array[gt+3]=_[Zt[0]];nt.array[gt+4]=_[Zt[1]];nt.array[gt+5]=_[Zt[2]];nt.array[gt+6]=w[Zt[0]];nt.array[gt+7]=w[Zt[1]];nt.array[gt+8]=w[Zt[2]];gt+=9}for(c=0,h=Vt.length;h>c;c++){at=nt.value[Vt[c]];b=at[0];_=at[1];w=at[2];H=at[3];nt.array[gt]=b[Zt[0]];nt.array[gt+1]=b[Zt[1]];nt.array[gt+2]=b[Zt[2]];nt.array[gt+3]=_[Zt[0]];nt.array[gt+4]=_[Zt[1]];nt.array[gt+5]=_[Zt[2]];nt.array[gt+6]=w[Zt[0]];nt.array[gt+7]=w[Zt[1]];nt.array[gt+8]=w[Zt[2]];nt.array[gt+9]=H[Zt[0]];nt.array[gt+10]=H[Zt[1]];nt.array[gt+11]=H[Zt[2]];gt+=12}}}else if(4===nt.size)if(void 0===nt.boundTo||"vertices"===nt.boundTo){for(c=0,h=Bt.length;h>c;c++){f=jt[Bt[c]];b=nt.value[f.a];_=nt.value[f.b];w=nt.value[f.c];nt.array[gt]=b.x;nt.array[gt+1]=b.y;nt.array[gt+2]=b.z;nt.array[gt+3]=b.w;nt.array[gt+4]=_.x;nt.array[gt+5]=_.y;nt.array[gt+6]=_.z;nt.array[gt+7]=_.w;nt.array[gt+8]=w.x;nt.array[gt+9]=w.y;nt.array[gt+10]=w.z;nt.array[gt+11]=w.w;gt+=12}for(c=0,h=Vt.length;h>c;c++){f=jt[Vt[c]];b=nt.value[f.a];_=nt.value[f.b];w=nt.value[f.c];H=nt.value[f.d];nt.array[gt]=b.x;nt.array[gt+1]=b.y;nt.array[gt+2]=b.z;nt.array[gt+3]=b.w;nt.array[gt+4]=_.x;nt.array[gt+5]=_.y;nt.array[gt+6]=_.z;nt.array[gt+7]=_.w;nt.array[gt+8]=w.x;nt.array[gt+9]=w.y;nt.array[gt+10]=w.z;nt.array[gt+11]=w.w;nt.array[gt+12]=H.x;nt.array[gt+13]=H.y;nt.array[gt+14]=H.z;nt.array[gt+15]=H.w;gt+=16}}else if("faces"===nt.boundTo){for(c=0,h=Bt.length;h>c;c++){at=nt.value[Bt[c]];b=at;_=at;w=at;nt.array[gt]=b.x;nt.array[gt+1]=b.y;nt.array[gt+2]=b.z;nt.array[gt+3]=b.w;nt.array[gt+4]=_.x;nt.array[gt+5]=_.y;nt.array[gt+6]=_.z;nt.array[gt+7]=_.w;nt.array[gt+8]=w.x;nt.array[gt+9]=w.y;nt.array[gt+10]=w.z;nt.array[gt+11]=w.w;gt+=12}for(c=0,h=Vt.length;h>c;c++){at=nt.value[Vt[c]];b=at;_=at;w=at;H=at;nt.array[gt]=b.x;nt.array[gt+1]=b.y;nt.array[gt+2]=b.z;nt.array[gt+3]=b.w;nt.array[gt+4]=_.x;nt.array[gt+5]=_.y;nt.array[gt+6]=_.z;nt.array[gt+7]=_.w;nt.array[gt+8]=w.x;nt.array[gt+9]=w.y;nt.array[gt+10]=w.z;nt.array[gt+11]=w.w;nt.array[gt+12]=H.x;nt.array[gt+13]=H.y;nt.array[gt+14]=H.z;nt.array[gt+15]=H.w;gt+=16}}else if("faceVertices"===nt.boundTo){for(c=0,h=Bt.length;h>c;c++){at=nt.value[Bt[c]];b=at[0];_=at[1];w=at[2];nt.array[gt]=b.x;nt.array[gt+1]=b.y;nt.array[gt+2]=b.z;nt.array[gt+3]=b.w;nt.array[gt+4]=_.x;nt.array[gt+5]=_.y;nt.array[gt+6]=_.z;nt.array[gt+7]=_.w;nt.array[gt+8]=w.x;nt.array[gt+9]=w.y;nt.array[gt+10]=w.z;nt.array[gt+11]=w.w;gt+=12}for(c=0,h=Vt.length;h>c;c++){at=nt.value[Vt[c]];b=at[0];_=at[1];w=at[2];H=at[3];nt.array[gt]=b.x;nt.array[gt+1]=b.y;nt.array[gt+2]=b.z;nt.array[gt+3]=b.w;nt.array[gt+4]=_.x;nt.array[gt+5]=_.y;nt.array[gt+6]=_.z;nt.array[gt+7]=_.w;nt.array[gt+8]=w.x;nt.array[gt+9]=w.y;nt.array[gt+10]=w.z;nt.array[gt+11]=w.w;nt.array[gt+12]=H.x;nt.array[gt+13]=H.y;nt.array[gt+14]=H.z;nt.array[gt+15]=H.w;gt+=16}}Ti.bindBuffer(Ti.ARRAY_BUFFER,nt.buffer);Ti.bufferData(Ti.ARRAY_BUFFER,nt.array,i)}else;}if(r){delete e.__inittedArrays;delete e.__colorArray;delete e.__normalArray;delete e.__tangentArray;delete e.__uvArray;delete e.__uv2Array;delete e.__faceArray;delete e.__vertexArray;delete e.__lineArray;delete e.__skinIndexArray;delete e.__skinWeightArray}}}function x(e,t,i){var r=e.attributes;var a,n;for(a in r){n=r[a];if(n.needsUpdate){if("index"===a){Ti.bindBuffer(Ti.ELEMENT_ARRAY_BUFFER,n.buffer);Ti.bufferData(Ti.ELEMENT_ARRAY_BUFFER,n.array,t)}else{Ti.bindBuffer(Ti.ARRAY_BUFFER,n.buffer);Ti.bufferData(Ti.ARRAY_BUFFER,n.array,t)}n.needsUpdate=!1}if(i&&!n.dynamic)n.array=null}}function R(e){if(!fi[e]){Ti.enableVertexAttribArray(e);fi[e]=!0}}function b(){for(var e in fi)if(fi[e]){Ti.disableVertexAttribArray(e);fi[e]=!1}}function _(e,t,i){var r=e.program.attributes;if(-1!==i.morphTargetBase&&r.position>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[i.morphTargetBase]);R(r.position);Ti.vertexAttribPointer(r.position,3,Ti.FLOAT,!1,0,0)}else if(r.position>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,t.__webglVertexBuffer);R(r.position);Ti.vertexAttribPointer(r.position,3,Ti.FLOAT,!1,0,0)}if(i.morphTargetForcedOrder.length){var a=0;var n=i.morphTargetForcedOrder;var o=i.morphTargetInfluences;for(;a<e.numSupportedMorphTargets&&a<n.length;){if(r["morphTarget"+a]>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[n[a]]);R(r["morphTarget"+a]);Ti.vertexAttribPointer(r["morphTarget"+a],3,Ti.FLOAT,!1,0,0)}if(r["morphNormal"+a]>=0&&e.morphNormals){Ti.bindBuffer(Ti.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[n[a]]);R(r["morphNormal"+a]);Ti.vertexAttribPointer(r["morphNormal"+a],3,Ti.FLOAT,!1,0,0)}i.__webglMorphTargetInfluences[a]=o[n[a]];a++}}else{var s,l=[];var o=i.morphTargetInfluences;var c,h=o.length;for(c=0;h>c;c++){s=o[c];if(s>0)l.push([s,c])}if(l.length>e.numSupportedMorphTargets){l.sort(H);l.length=e.numSupportedMorphTargets}else if(l.length>e.numSupportedMorphNormals)l.sort(H);else if(0===l.length)l.push([0,0]);var u,a=0;for(;a<e.numSupportedMorphTargets;){if(l[a]){u=l[a][1];if(r["morphTarget"+a]>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u]);R(r["morphTarget"+a]);Ti.vertexAttribPointer(r["morphTarget"+a],3,Ti.FLOAT,!1,0,0)}if(r["morphNormal"+a]>=0&&e.morphNormals){Ti.bindBuffer(Ti.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[u]);R(r["morphNormal"+a]);Ti.vertexAttribPointer(r["morphNormal"+a],3,Ti.FLOAT,!1,0,0)}i.__webglMorphTargetInfluences[a]=o[u]}else i.__webglMorphTargetInfluences[a]=0;a++}}if(null!==e.program.uniforms.morphTargetInfluences)Ti.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}function w(e,t){if(e.z!==t.z)return t.z-e.z;else return e.id-t.id}function H(e,t){return t[0]-e[0]}function M(e,t,i){if(e.length)for(var r=0,a=e.length;a>r;r++){Bt=null;Wt=null;Zt=-1;ei=-1;ti=-1;qt=-1;Kt=-1;Gt=-1;jt=-1;Ei=!0;e[r].render(t,i,hi,ui);Bt=null;Wt=null;Zt=-1;ei=-1;ti=-1;qt=-1;Kt=-1;Gt=-1;jt=-1;Ei=!0}}function S(e,t,i,r,a,n,o,s){var l,c,h,u,f,d,p;if(t){f=e.length-1;d=-1;p=-1}else{f=0;d=e.length;p=1}for(var m=f;m!==d;m+=p){l=e[m];if(l.render){c=l.object;h=l.buffer;if(s)u=s;else{u=l[i];if(!u)continue;if(o)It.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst);It.setDepthTest(u.depthTest);It.setDepthWrite(u.depthWrite);st(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}It.setMaterialFaces(u);if(h instanceof THREE.BufferGeometry)It.renderBufferDirect(r,a,n,u,h,c);else It.renderBuffer(r,a,n,u,h,c)}}}function C(e,t,i,r,a,n,o){var s,l,c;for(var h=0,u=e.length;u>h;h++){s=e[h];l=s.object;if(l.visible){if(o)c=o;else{c=s[t];if(!c)continue;if(n)It.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst);It.setDepthTest(c.depthTest);It.setDepthWrite(c.depthWrite);st(c.polygonOffset,c.polygonOffsetFactor,c.polygonOffsetUnits)}It.renderImmediateObject(i,r,a,c,l)}}}function A(e){var t=e.object,i=t.material;if(i.transparent){e.transparent=i;e.opaque=null}else{e.opaque=i;e.transparent=null}}function D(e){var t,i,r,a=e.object,n=e.buffer;r=a.material;if(r instanceof THREE.MeshFaceMaterial){i=n.materialIndex;t=r.materials[i];if(t.transparent){e.transparent=t;e.opaque=null}else{e.opaque=t;e.transparent=null}}else{t=r;if(t)if(t.transparent){e.transparent=t;e.opaque=null}else{e.opaque=t;e.transparent=null}}}function P(e,t){var i,r,a,n,o,s,l={};var c=e.morphTargets.length;var h=e.morphNormals.length;var u=t instanceof THREE.MeshFaceMaterial;e.geometryGroups={};for(i=0,r=e.faces.length;r>i;i++){a=e.faces[i];n=u?a.materialIndex:0;if(void 0===l[n])l[n]={hash:n,counter:0};s=l[n].hash+"_"+l[n].counter;if(void 0===e.geometryGroups[s])e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:n,vertices:0,numMorphTargets:c,numMorphNormals:h};o=a instanceof THREE.Face3?3:4;if(e.geometryGroups[s].vertices+o>65535){l[n].counter+=1;s=l[n].hash+"_"+l[n].counter;if(void 0===e.geometryGroups[s])e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:n,vertices:0,numMorphTargets:c,numMorphNormals:h}}if(a instanceof THREE.Face3)e.geometryGroups[s].faces3.push(i);else e.geometryGroups[s].faces4.push(i);e.geometryGroups[s].vertices+=o}e.geometryGroupsList=[];for(var f in e.geometryGroups){e.geometryGroups[f].id=Xt++;e.geometryGroupsList.push(e.geometryGroups[f])}}function L(e,n){var o,u,f,d;if(void 0===e.__webglInit){e.__webglInit=!0;e._modelViewMatrix=new THREE.Matrix4;e._normalMatrix=new THREE.Matrix3;if(void 0!==e.geometry&&void 0===e.geometry.__webglInit){e.geometry.__webglInit=!0;e.geometry.addEventListener("dispose",Ii)}u=e.geometry;if(void 0===u);else if(u instanceof THREE.BufferGeometry)v(u);else if(e instanceof THREE.Mesh){f=e.material;if(void 0===u.geometryGroups)P(u,f);for(o in u.geometryGroups){d=u.geometryGroups[o];if(!d.__webglVertexBuffer){a(d);h(d,e);u.verticesNeedUpdate=!0;u.morphTargetsNeedUpdate=!0;u.elementsNeedUpdate=!0;u.uvsNeedUpdate=!0;u.normalsNeedUpdate=!0;u.tangentsNeedUpdate=!0;u.colorsNeedUpdate=!0}}}else if(e instanceof THREE.Ribbon){if(!u.__webglVertexBuffer){r(u);c(u,e);u.verticesNeedUpdate=!0;u.colorsNeedUpdate=!0;u.normalsNeedUpdate=!0}}else if(e instanceof THREE.Line){if(!u.__webglVertexBuffer){i(u);l(u,e);u.verticesNeedUpdate=!0;u.colorsNeedUpdate=!0;u.lineDistancesNeedUpdate=!0}}else if(e instanceof THREE.ParticleSystem)if(!u.__webglVertexBuffer){t(u);s(u,e);u.verticesNeedUpdate=!0;u.colorsNeedUpdate=!0}}if(void 0===e.__webglActive){if(e instanceof THREE.Mesh){u=e.geometry;if(u instanceof THREE.BufferGeometry)F(n.__webglObjects,u,e);else if(u instanceof THREE.Geometry)for(o in u.geometryGroups){d=u.geometryGroups[o];F(n.__webglObjects,d,e)}}else if(e instanceof THREE.Ribbon||e instanceof THREE.Line||e instanceof THREE.ParticleSystem){u=e.geometry;F(n.__webglObjects,u,e)}else if(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)N(n.__webglObjectsImmediate,e);else if(e instanceof THREE.Sprite)n.__webglSprites.push(e);else if(e instanceof THREE.LensFlare)n.__webglFlares.push(e);e.__webglActive=!0}}function F(e,t,i){e.push({id:null,buffer:t,object:i,opaque:null,transparent:null,z:0})}function N(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function U(e){var t,i,r,a=e.geometry;if(a instanceof THREE.BufferGeometry)x(a,Ti.DYNAMIC_DRAW,!a.dynamic);else if(e instanceof THREE.Mesh){for(var n=0,o=a.geometryGroupsList.length;o>n;n++){t=a.geometryGroupsList[n];r=u(e,t);if(a.buffersNeedUpdate)h(t,e);i=r.attributes&&O(r);if(a.verticesNeedUpdate||a.morphTargetsNeedUpdate||a.elementsNeedUpdate||a.uvsNeedUpdate||a.normalsNeedUpdate||a.colorsNeedUpdate||a.tangentsNeedUpdate||i)T(t,e,Ti.DYNAMIC_DRAW,!a.dynamic,r)}a.verticesNeedUpdate=!1;a.morphTargetsNeedUpdate=!1;a.elementsNeedUpdate=!1;a.uvsNeedUpdate=!1;a.normalsNeedUpdate=!1;a.colorsNeedUpdate=!1;a.tangentsNeedUpdate=!1;a.buffersNeedUpdate=!1;r.attributes&&I(r)}else if(e instanceof THREE.Ribbon){r=u(e,a);i=r.attributes&&O(r);if(a.verticesNeedUpdate||a.colorsNeedUpdate||a.normalsNeedUpdate||i)y(a,Ti.DYNAMIC_DRAW);a.verticesNeedUpdate=!1;a.colorsNeedUpdate=!1;a.normalsNeedUpdate=!1;r.attributes&&I(r)}else if(e instanceof THREE.Line){r=u(e,a);i=r.attributes&&O(r);if(a.verticesNeedUpdate||a.colorsNeedUpdate||a.lineDistancesNeedUpdate||i)E(a,Ti.DYNAMIC_DRAW);a.verticesNeedUpdate=!1;a.colorsNeedUpdate=!1;a.lineDistancesNeedUpdate=!1;r.attributes&&I(r)}else if(e instanceof THREE.ParticleSystem){r=u(e,a);i=r.attributes&&O(r);if(a.verticesNeedUpdate||a.colorsNeedUpdate||e.sortParticles||i)g(a,Ti.DYNAMIC_DRAW,e);a.verticesNeedUpdate=!1;a.colorsNeedUpdate=!1;r.attributes&&I(r)}}function O(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function I(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function k(e,t){if(e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Ribbon||e instanceof THREE.Line)z(t.__webglObjects,e);
else if(e instanceof THREE.Sprite)B(t.__webglSprites,e);else if(e instanceof THREE.LensFlare)B(t.__webglFlares,e);else if(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)z(t.__webglObjectsImmediate,e);delete e.__webglActive}function z(e,t){for(var i=e.length-1;i>=0;i--)if(e[i].object===t)e.splice(i,1)}function B(e,t){for(var i=e.length-1;i>=0;i--)if(e[i]===t)e.splice(i,1)}function V(e,t){e.uniforms=THREE.UniformsUtils.clone(t.uniforms);e.vertexShader=t.vertexShader;e.fragmentShader=t.fragmentShader}function j(e,t,i,r,a){Yt=0;if(r.needsUpdate){if(r.program)Wi(r);It.initMaterial(r,t,i,a);r.needsUpdate=!1}if(r.morphTargets)if(!a.__webglMorphTargetInfluences)a.__webglMorphTargetInfluences=new Float32Array(It.maxMorphTargets);var n=!1;var o=r.program,s=o.uniforms,l=r.uniforms;if(o!==Bt){Ti.useProgram(o);Bt=o;n=!0}if(r.id!==jt){jt=r.id;n=!0}if(n||e!==Wt){Ti.uniformMatrix4fv(s.projectionMatrix,!1,e.projectionMatrix.elements);if(e!==Wt)Wt=e}if(r.skinning)if(Di&&a.useVertexTexture){if(null!==s.boneTexture){var c=et();Ti.uniform1i(s.boneTexture,c);It.setTexture(a.boneTexture,c)}}else if(null!==s.boneGlobalMatrices)Ti.uniformMatrix4fv(s.boneGlobalMatrices,!1,a.boneMatrices);if(n){if(i&&r.fog)q(l,i);if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(Ei){nt(o,t);Ei=!1}Q(l,yi)}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)G(l,r);if(r instanceof THREE.LineBasicMaterial)W(l,r);else if(r instanceof THREE.LineDashedMaterial){W(l,r);X(l,r)}else if(r instanceof THREE.ParticleBasicMaterial)Y(l,r);else if(r instanceof THREE.MeshPhongMaterial)K(l,r);else if(r instanceof THREE.MeshLambertMaterial)Z(l,r);else if(r instanceof THREE.MeshDepthMaterial){l.mNear.value=e.near;l.mFar.value=e.far;l.opacity.value=r.opacity}else if(r instanceof THREE.MeshNormalMaterial)l.opacity.value=r.opacity;if(a.receiveShadow&&!r._shadowPass)$(l,t);tt(o,r.uniformsList);if(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)if(null!==s.cameraPosition){vi.getPositionFromMatrix(e.matrixWorld);Ti.uniform3f(s.cameraPosition,vi.x,vi.y,vi.z)}if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)if(null!==s.viewMatrix)Ti.uniformMatrix4fv(s.viewMatrix,!1,e.matrixWorldInverse.elements)}J(s,a);if(null!==s.modelMatrix)Ti.uniformMatrix4fv(s.modelMatrix,!1,a.matrixWorld.elements);return o}function G(e,t){e.opacity.value=t.opacity;if(It.gammaInput)e.diffuse.value.copyGammaToLinear(t.color);else e.diffuse.value=t.color;e.map.value=t.map;e.lightMap.value=t.lightMap;e.specularMap.value=t.specularMap;if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}var i;if(t.map)i=t.map;else if(t.specularMap)i=t.specularMap;else if(t.normalMap)i=t.normalMap;else if(t.bumpMap)i=t.bumpMap;if(void 0!==i){var r=i.offset;var a=i.repeat;e.offsetRepeat.value.set(r.x,r.y,a.x,a.y)}e.envMap.value=t.envMap;e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;if(It.gammaInput)e.reflectivity.value=t.reflectivity;else e.reflectivity.value=t.reflectivity;e.refractionRatio.value=t.refractionRatio;e.combine.value=t.combine;e.useRefract.value=t.envMap&&t.envMap.mapping instanceof THREE.CubeRefractionMapping}function W(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity}function X(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function Y(e,t){e.psColor.value=t.color;e.opacity.value=t.opacity;e.size.value=t.size;e.scale.value=Ct.height/2;e.map.value=t.map}function q(e,t){e.fogColor.value=t.color;if(t instanceof THREE.Fog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t instanceof THREE.FogExp2)e.fogDensity.value=t.density}function K(e,t){e.shininess.value=t.shininess;if(It.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive);e.specular.value.copyGammaToLinear(t.specular)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive;e.specular.value=t.specular}if(t.wrapAround)e.wrapRGB.value.copy(t.wrapRGB)}function Z(e,t){if(It.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive}if(t.wrapAround)e.wrapRGB.value.copy(t.wrapRGB)}function Q(e,t){e.ambientLightColor.value=t.ambient;e.directionalLightColor.value=t.directional.colors;e.directionalLightDirection.value=t.directional.positions;e.pointLightColor.value=t.point.colors;e.pointLightPosition.value=t.point.positions;e.pointLightDistance.value=t.point.distances;e.spotLightColor.value=t.spot.colors;e.spotLightPosition.value=t.spot.positions;e.spotLightDistance.value=t.spot.distances;e.spotLightDirection.value=t.spot.directions;e.spotLightAngleCos.value=t.spot.anglesCos;e.spotLightExponent.value=t.spot.exponents;e.hemisphereLightSkyColor.value=t.hemi.skyColors;e.hemisphereLightGroundColor.value=t.hemi.groundColors;e.hemisphereLightDirection.value=t.hemi.positions}function $(e,t){if(e.shadowMatrix){var i=0;for(var r=0,a=t.length;a>r;r++){var n=t[r];if(n.castShadow){if(n instanceof THREE.SpotLight||n instanceof THREE.DirectionalLight&&!n.shadowCascade){e.shadowMap.value[i]=n.shadowMap;e.shadowMapSize.value[i]=n.shadowMapSize;e.shadowMatrix.value[i]=n.shadowMatrix;e.shadowDarkness.value[i]=n.shadowDarkness;e.shadowBias.value[i]=n.shadowBias;i++}}else;}}}function J(e,t){Ti.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements);if(e.normalMatrix)Ti.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function et(){var e=Yt;if(e>=Hi)console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Hi);Yt+=1;return e}function tt(e,t){var i,r,a,n,o,s,l,c,h,u,f;for(h=0,u=t.length;u>h;h++){n=e.uniforms[t[h][1]];if(n){i=t[h][0];a=i.type;r=i.value;if("i"===a)Ti.uniform1i(n,r);else if("f"===a)Ti.uniform1f(n,r);else if("v2"===a)Ti.uniform2f(n,r.x,r.y);else if("v3"===a)Ti.uniform3f(n,r.x,r.y,r.z);else if("v4"===a)Ti.uniform4f(n,r.x,r.y,r.z,r.w);else if("c"===a)Ti.uniform3f(n,r.r,r.g,r.b);else if("iv1"===a)Ti.uniform1iv(n,r);else if("iv"===a)Ti.uniform3iv(n,r);else if("fv1"===a)Ti.uniform1fv(n,r);else if("fv"===a)Ti.uniform3fv(n,r);else if("v2v"===a){if(void 0===i._array)i._array=new Float32Array(2*r.length);for(l=0,c=r.length;c>l;l++){f=2*l;i._array[f]=r[l].x;i._array[f+1]=r[l].y}Ti.uniform2fv(n,i._array)}else if("v3v"===a){if(void 0===i._array)i._array=new Float32Array(3*r.length);for(l=0,c=r.length;c>l;l++){f=3*l;i._array[f]=r[l].x;i._array[f+1]=r[l].y;i._array[f+2]=r[l].z}Ti.uniform3fv(n,i._array)}else if("v4v"===a){if(void 0===i._array)i._array=new Float32Array(4*r.length);for(l=0,c=r.length;c>l;l++){f=4*l;i._array[f]=r[l].x;i._array[f+1]=r[l].y;i._array[f+2]=r[l].z;i._array[f+3]=r[l].w}Ti.uniform4fv(n,i._array)}else if("m4"===a){if(void 0===i._array)i._array=new Float32Array(16);r.flattenToArray(i._array);Ti.uniformMatrix4fv(n,!1,i._array)}else if("m4v"===a){if(void 0===i._array)i._array=new Float32Array(16*r.length);for(l=0,c=r.length;c>l;l++)r[l].flattenToArrayOffset(i._array,16*l);Ti.uniformMatrix4fv(n,!1,i._array)}else if("t"===a){o=r;s=et();Ti.uniform1i(n,s);if(!o)continue;if(o.image instanceof Array&&6===o.image.length)gt(o,s);else if(o instanceof THREE.WebGLRenderTargetCube)Et(o,s);else It.setTexture(o,s)}else if("tv"===a){if(void 0===i._array)i._array=[];for(l=0,c=i.value.length;c>l;l++)i._array[l]=et();Ti.uniform1iv(n,i._array);for(l=0,c=i.value.length;c>l;l++){o=i.value[l];s=i._array[l];if(o)It.setTexture(o,s);else;}}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+a)}else;}}function it(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld);e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function rt(e,t,i,r){e[t]=i.r*i.r*r;e[t+1]=i.g*i.g*r;e[t+2]=i.b*i.b*r}function at(e,t,i,r){e[t]=i.r*r;e[t+1]=i.g*r;e[t+2]=i.b*r}function nt(e,t){var i,r,a,n,o,s,l,c,h,u=0,f=0,d=0,p=yi,m=p.directional.colors,v=p.directional.positions,g=p.point.colors,E=p.point.positions,y=p.point.distances,T=p.spot.colors,x=p.spot.positions,R=p.spot.distances,b=p.spot.directions,_=p.spot.anglesCos,w=p.spot.exponents,H=p.hemi.skyColors,M=p.hemi.groundColors,S=p.hemi.positions,C=0,A=0,D=0,P=0,L=0,F=0,N=0,U=0,O=0,I=0,k=0,z=0;for(i=0,r=t.length;r>i;i++){a=t[i];if(!a.onlyShadow){n=a.color;l=a.intensity;h=a.distance;if(a instanceof THREE.AmbientLight){if(!a.visible)continue;if(It.gammaInput){u+=n.r*n.r;f+=n.g*n.g;d+=n.b*n.b}else{u+=n.r;f+=n.g;d+=n.b}}else if(a instanceof THREE.DirectionalLight){L+=1;if(!a.visible)continue;gi.getPositionFromMatrix(a.matrixWorld);vi.getPositionFromMatrix(a.target.matrixWorld);gi.sub(vi);gi.normalize();if(0===gi.x&&0===gi.y&&0===gi.z)continue;O=3*C;v[O]=gi.x;v[O+1]=gi.y;v[O+2]=gi.z;if(It.gammaInput)rt(m,O,n,l*l);else at(m,O,n,l);C+=1}else if(a instanceof THREE.PointLight){F+=1;if(!a.visible)continue;I=3*A;if(It.gammaInput)rt(g,I,n,l*l);else at(g,I,n,l);vi.getPositionFromMatrix(a.matrixWorld);E[I]=vi.x;E[I+1]=vi.y;E[I+2]=vi.z;y[A]=h;A+=1}else if(a instanceof THREE.SpotLight){N+=1;if(!a.visible)continue;k=3*D;if(It.gammaInput)rt(T,k,n,l*l);else at(T,k,n,l);vi.getPositionFromMatrix(a.matrixWorld);x[k]=vi.x;x[k+1]=vi.y;x[k+2]=vi.z;R[D]=h;gi.copy(vi);vi.getPositionFromMatrix(a.target.matrixWorld);gi.sub(vi);gi.normalize();b[k]=gi.x;b[k+1]=gi.y;b[k+2]=gi.z;_[D]=Math.cos(a.angle);w[D]=a.exponent;D+=1}else if(a instanceof THREE.HemisphereLight){U+=1;if(!a.visible)continue;gi.getPositionFromMatrix(a.matrixWorld);gi.normalize();if(0===gi.x&&0===gi.y&&0===gi.z)continue;z=3*P;S[z]=gi.x;S[z+1]=gi.y;S[z+2]=gi.z;o=a.color;s=a.groundColor;if(It.gammaInput){c=l*l;rt(H,z,o,c);rt(M,z,s,c)}else{at(H,z,o,l);at(M,z,s,l)}P+=1}}else;}for(i=3*C,r=Math.max(m.length,3*L);r>i;i++)m[i]=0;for(i=3*A,r=Math.max(g.length,3*F);r>i;i++)g[i]=0;for(i=3*D,r=Math.max(T.length,3*N);r>i;i++)T[i]=0;for(i=3*P,r=Math.max(H.length,3*U);r>i;i++)H[i]=0;for(i=3*P,r=Math.max(M.length,3*U);r>i;i++)M[i]=0;p.directional.length=C;p.point.length=A;p.spot.length=D;p.hemi.length=P;p.ambient[0]=u;p.ambient[1]=f;p.ambient[2]=d}function ot(e){if(e!==ni){Ti.lineWidth(e);ni=e}}function st(e,t,i){if(ii!==e){if(e)Ti.enable(Ti.POLYGON_OFFSET_FILL);else Ti.disable(Ti.POLYGON_OFFSET_FILL);ii=e}if(e&&(ri!==t||ai!==i)){Ti.polygonOffset(t,i);ri=t;ai=i}}function lt(e){var t,i,r=[];for(var a in e){t=e[a];if(t!==!1){i="#define "+a+" "+t;r.push(i)}else;}return r.join("\n")}function ct(e,t,i,r,a,n,o){var s,l,c,h,u;var f=[];if(e)f.push(e);else{f.push(t);f.push(i)}for(c in n){f.push(c);f.push(n[c])}for(s in o){f.push(s);f.push(o[s])}u=f.join();for(s=0,l=kt.length;l>s;s++){var d=kt[s];if(d.code===u){d.usedTimes++;return d.program}}var p="SHADOWMAP_TYPE_BASIC";if(o.shadowMapType===THREE.PCFShadowMap)p="SHADOWMAP_TYPE_PCF";else if(o.shadowMapType===THREE.PCFSoftShadowMap)p="SHADOWMAP_TYPE_PCF_SOFT";var m=lt(n);h=Ti.createProgram();var v=["precision "+At+" float;",m,Ai?"#define VERTEX_TEXTURES":"",It.gammaInput?"#define GAMMA_INPUT":"",It.gammaOutput?"#define GAMMA_OUTPUT":"",It.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+o.maxDirLights,"#define MAX_POINT_LIGHTS "+o.maxPointLights,"#define MAX_SPOT_LIGHTS "+o.maxSpotLights,"#define MAX_HEMI_LIGHTS "+o.maxHemiLights,"#define MAX_SHADOWS "+o.maxShadows,"#define MAX_BONES "+o.maxBones,o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.lightMap?"#define USE_LIGHTMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.vertexColors?"#define USE_COLOR":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.boneTextureWidth?"#define N_BONE_PIXEL_X "+o.boneTextureWidth.toFixed(1):"",o.boneTextureHeight?"#define N_BONE_PIXEL_Y "+o.boneTextureHeight.toFixed(1):"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals?"#define USE_MORPHNORMALS":"",o.perPixel?"#define PHONG_PER_PIXEL":"",o.wrapAround?"#define WRAP_AROUND":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+p:"",o.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",o.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n");var g=["precision "+At+" float;",o.bumpMap||o.normalMap?"#extension GL_OES_standard_derivatives : enable":"",m,"#define MAX_DIR_LIGHTS "+o.maxDirLights,"#define MAX_POINT_LIGHTS "+o.maxPointLights,"#define MAX_SPOT_LIGHTS "+o.maxSpotLights,"#define MAX_HEMI_LIGHTS "+o.maxHemiLights,"#define MAX_SHADOWS "+o.maxShadows,o.alphaTest?"#define ALPHATEST "+o.alphaTest:"",It.gammaInput?"#define GAMMA_INPUT":"",It.gammaOutput?"#define GAMMA_OUTPUT":"",It.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.lightMap?"#define USE_LIGHTMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.vertexColors?"#define USE_COLOR":"",o.metal?"#define METAL":"",o.perPixel?"#define PHONG_PER_PIXEL":"",o.wrapAround?"#define WRAP_AROUND":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+p:"",o.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",o.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");var E=dt("vertex",v+i);var y=dt("fragment",g+t);Ti.attachShader(h,E);Ti.attachShader(h,y);Ti.linkProgram(h);if(!Ti.getProgramParameter(h,Ti.LINK_STATUS))console.error("Could not initialise shader\nVALIDATE_STATUS: "+Ti.getProgramParameter(h,Ti.VALIDATE_STATUS)+", gl error ["+Ti.getError()+"]");Ti.deleteShader(y);Ti.deleteShader(E);h.uniforms={};h.attributes={};var T,x,R,b;T=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"];if(o.useVertexTexture)T.push("boneTexture");else T.push("boneGlobalMatrices");for(x in r)T.push(x);ht(h,T);T=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(b=0;b<o.maxMorphTargets;b++)T.push("morphTarget"+b);for(b=0;b<o.maxMorphNormals;b++)T.push("morphNormal"+b);for(R in a)T.push(R);ut(h,T);h.id=zt++;kt.push({program:h,code:u,usedTimes:1});It.info.memory.programs=kt.length;return h}function ht(e,t){var i,r,a;for(i=0,r=t.length;r>i;i++){a=t[i];e.uniforms[a]=Ti.getUniformLocation(e,a)}}function ut(e,t){var i,r,a;for(i=0,r=t.length;r>i;i++){a=t[i];e.attributes[a]=Ti.getAttribLocation(e,a)}}function ft(e){var t=e.split("\n");for(var i=0,r=t.length;r>i;i++)t[i]=i+1+": "+t[i];return t.join("\n")}function dt(e,t){var i;if("fragment"===e)i=Ti.createShader(Ti.FRAGMENT_SHADER);else if("vertex"===e)i=Ti.createShader(Ti.VERTEX_SHADER);Ti.shaderSource(i,t);Ti.compileShader(i);if(!Ti.getShaderParameter(i,Ti.COMPILE_STATUS)){console.error(Ti.getShaderInfoLog(i));console.error(ft(t));return null}return i}function pt(e){return 0===(e&e-1)}function mt(e,t,i){if(i){Ti.texParameteri(e,Ti.TEXTURE_WRAP_S,bt(t.wrapS));Ti.texParameteri(e,Ti.TEXTURE_WRAP_T,bt(t.wrapT));Ti.texParameteri(e,Ti.TEXTURE_MAG_FILTER,bt(t.magFilter));Ti.texParameteri(e,Ti.TEXTURE_MIN_FILTER,bt(t.minFilter))}else{Ti.texParameteri(e,Ti.TEXTURE_WRAP_S,Ti.CLAMP_TO_EDGE);Ti.texParameteri(e,Ti.TEXTURE_WRAP_T,Ti.CLAMP_TO_EDGE);Ti.texParameteri(e,Ti.TEXTURE_MAG_FILTER,Rt(t.magFilter));Ti.texParameteri(e,Ti.TEXTURE_MIN_FILTER,Rt(t.minFilter))}if(_i&&t.type!==THREE.FloatType)if(t.anisotropy>1||t.__oldAnisotropy){Ti.texParameterf(e,_i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Ci));t.__oldAnisotropy=t.anisotropy}}function vt(e,t){if(e.width<=t&&e.height<=t)return e;var i=Math.max(e.width,e.height);var r=Math.floor(e.width*t/i);var a=Math.floor(e.height*t/i);var n=document.createElement("canvas");n.width=r;n.height=a;var o=n.getContext("2d");o.drawImage(e,0,0,e.width,e.height,0,0,r,a);return n}function gt(e,t){if(6===e.image.length)if(e.needsUpdate){if(!e.image.__webglTextureCube){e.addEventListener("dispose",ki);e.image.__webglTextureCube=Ti.createTexture();It.info.memory.textures++}Ti.activeTexture(Ti.TEXTURE0+t);Ti.bindTexture(Ti.TEXTURE_CUBE_MAP,e.image.__webglTextureCube);Ti.pixelStorei(Ti.UNPACK_FLIP_Y_WEBGL,e.flipY);var i=e instanceof THREE.CompressedTexture;var r=[];for(var a=0;6>a;a++)if(It.autoScaleCubemaps&&!i)r[a]=vt(e.image[a],Si);else r[a]=e.image[a];var n=r[0],o=pt(n.width)&&pt(n.height),s=bt(e.format),l=bt(e.type);mt(Ti.TEXTURE_CUBE_MAP,e,o);for(var a=0;6>a;a++)if(i){var c,h=r[a].mipmaps;for(var u=0,f=h.length;f>u;u++){c=h[u];Ti.compressedTexImage2D(Ti.TEXTURE_CUBE_MAP_POSITIVE_X+a,u,s,c.width,c.height,0,c.data)}}else Ti.texImage2D(Ti.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,s,s,l,r[a]);if(e.generateMipmaps&&o)Ti.generateMipmap(Ti.TEXTURE_CUBE_MAP);e.needsUpdate=!1;if(e.onUpdate)e.onUpdate()}else{Ti.activeTexture(Ti.TEXTURE0+t);Ti.bindTexture(Ti.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}}function Et(e,t){Ti.activeTexture(Ti.TEXTURE0+t);Ti.bindTexture(Ti.TEXTURE_CUBE_MAP,e.__webglTexture)}function yt(e,t,i){Ti.bindFramebuffer(Ti.FRAMEBUFFER,e);Ti.framebufferTexture2D(Ti.FRAMEBUFFER,Ti.COLOR_ATTACHMENT0,i,t.__webglTexture,0)}function Tt(e,t){Ti.bindRenderbuffer(Ti.RENDERBUFFER,e);if(t.depthBuffer&&!t.stencilBuffer){Ti.renderbufferStorage(Ti.RENDERBUFFER,Ti.DEPTH_COMPONENT16,t.width,t.height);Ti.framebufferRenderbuffer(Ti.FRAMEBUFFER,Ti.DEPTH_ATTACHMENT,Ti.RENDERBUFFER,e)}else if(t.depthBuffer&&t.stencilBuffer){Ti.renderbufferStorage(Ti.RENDERBUFFER,Ti.DEPTH_STENCIL,t.width,t.height);Ti.framebufferRenderbuffer(Ti.FRAMEBUFFER,Ti.DEPTH_STENCIL_ATTACHMENT,Ti.RENDERBUFFER,e)}else Ti.renderbufferStorage(Ti.RENDERBUFFER,Ti.RGBA4,t.width,t.height)}function xt(e){if(e instanceof THREE.WebGLRenderTargetCube){Ti.bindTexture(Ti.TEXTURE_CUBE_MAP,e.__webglTexture);Ti.generateMipmap(Ti.TEXTURE_CUBE_MAP);Ti.bindTexture(Ti.TEXTURE_CUBE_MAP,null)}else{Ti.bindTexture(Ti.TEXTURE_2D,e.__webglTexture);Ti.generateMipmap(Ti.TEXTURE_2D);Ti.bindTexture(Ti.TEXTURE_2D,null)}}function Rt(e){if(e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter)return Ti.NEAREST;else return Ti.LINEAR}function bt(e){if(e===THREE.RepeatWrapping)return Ti.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Ti.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Ti.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Ti.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Ti.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Ti.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Ti.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Ti.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Ti.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Ti.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Ti.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Ti.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Ti.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Ti.BYTE;if(e===THREE.ShortType)return Ti.SHORT;if(e===THREE.UnsignedShortType)return Ti.UNSIGNED_SHORT;if(e===THREE.IntType)return Ti.INT;if(e===THREE.UnsignedIntType)return Ti.UNSIGNED_INT;if(e===THREE.FloatType)return Ti.FLOAT;if(e===THREE.AlphaFormat)return Ti.ALPHA;if(e===THREE.RGBFormat)return Ti.RGB;if(e===THREE.RGBAFormat)return Ti.RGBA;if(e===THREE.LuminanceFormat)return Ti.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Ti.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return Ti.FUNC_ADD;if(e===THREE.SubtractEquation)return Ti.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Ti.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Ti.ZERO;if(e===THREE.OneFactor)return Ti.ONE;if(e===THREE.SrcColorFactor)return Ti.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Ti.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Ti.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Ti.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Ti.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Ti.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Ti.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Ti.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Ti.SRC_ALPHA_SATURATE;if(void 0!==wi){if(e===THREE.RGB_S3TC_DXT1_Format)return wi.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return wi.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return wi.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return wi.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function _t(e){if(Di&&e&&e.useVertexTexture)return 1024;else{var t=Ti.getParameter(Ti.MAX_VERTEX_UNIFORM_VECTORS);var i=Math.floor((t-20)/4);var r=i;if(void 0!==e&&e instanceof THREE.SkinnedMesh){r=Math.min(e.bones.length,r);if(r<e.bones.length)console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")}return r}}function wt(e){var t=0;var i=0;var r=0;var a=0;for(var n=0,o=e.length;o>n;n++){var s=e[n];if(!s.onlyShadow){if(s instanceof THREE.DirectionalLight)t++;if(s instanceof THREE.PointLight)i++;if(s instanceof THREE.SpotLight)r++;if(s instanceof THREE.HemisphereLight)a++}else;}return{directional:t,point:i,spot:r,hemi:a}}function Ht(e){var t=0;for(var i=0,r=e.length;r>i;i++){var a=e[i];if(a.castShadow){if(a instanceof THREE.SpotLight)t++;if(a instanceof THREE.DirectionalLight&&!a.shadowCascade)t++}else;}return t}function Mt(){try{if(!(Ti=Ct.getContext("experimental-webgl",{alpha:Dt,premultipliedAlpha:Pt,antialias:Lt,stencil:Ft,preserveDrawingBuffer:Nt})))throw"Error creating WebGL context."}catch(e){console.error(e)}xi=Ti.getExtension("OES_texture_float");Ri=Ti.getExtension("OES_texture_float_linear");bi=Ti.getExtension("OES_standard_derivatives");_i=Ti.getExtension("EXT_texture_filter_anisotropic")||Ti.getExtension("MOZ_EXT_texture_filter_anisotropic")||Ti.getExtension("WEBKIT_EXT_texture_filter_anisotropic");wi=Ti.getExtension("WEBGL_compressed_texture_s3tc")||Ti.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Ti.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");if(!xi)console.log("THREE.WebGLRenderer: Float textures not supported.");if(!bi)console.log("THREE.WebGLRenderer: Standard derivatives not supported.");if(!_i)console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported.");if(!wi)console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.");if(void 0===Ti.getShaderPrecisionFormat)Ti.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}function St(){Ti.clearColor(0,0,0,1);Ti.clearDepth(1);Ti.clearStencil(0);Ti.enable(Ti.DEPTH_TEST);Ti.depthFunc(Ti.LEQUAL);Ti.frontFace(Ti.CCW);Ti.cullFace(Ti.BACK);Ti.enable(Ti.CULL_FACE);Ti.enable(Ti.BLEND);Ti.blendEquation(Ti.FUNC_ADD);Ti.blendFunc(Ti.SRC_ALPHA,Ti.ONE_MINUS_SRC_ALPHA);Ti.clearColor(Ut.r,Ut.g,Ut.b,Ot)}console.log("THREE.WebGLRenderer",THREE.REVISION);e=e||{};var Ct=void 0!==e.canvas?e.canvas:document.createElement("canvas"),At=void 0!==e.precision?e.precision:"highp",Dt=void 0!==e.alpha?e.alpha:!0,Pt=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,Lt=void 0!==e.antialias?e.antialias:!1,Ft=void 0!==e.stencil?e.stencil:!0,Nt=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,Ut=new THREE.Color(0),Ot=0;if(void 0!==e.clearColor){console.warn("DEPRECATED: clearColor in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead.");Ut.setHex(e.clearColor)}if(void 0!==e.clearAlpha){console.warn("DEPRECATED: clearAlpha in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead.");Ot=e.clearAlpha}this.domElement=Ct;this.context=null;this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1;this.autoClear=!0;this.autoClearColor=!0;this.autoClearDepth=!0;this.autoClearStencil=!0;this.sortObjects=!0;this.autoUpdateObjects=!0;this.gammaInput=!1;this.gammaOutput=!1;this.physicallyBasedShading=!1;this.shadowMapEnabled=!1;this.shadowMapAutoUpdate=!0;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapDebug=!1;this.shadowMapCascade=!1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=!0;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var It=this,kt=[],zt=0,Bt=null,Vt=null,jt=-1,Gt=null,Wt=null,Xt=0,Yt=0,qt=-1,Kt=-1,Zt=-1,Qt=-1,$t=-1,Jt=-1,ei=-1,ti=-1,ii=null,ri=null,ai=null,ni=null,oi=0,si=0,li=0,ci=0,hi=0,ui=0,fi={},di=new THREE.Frustum,pi=new THREE.Matrix4,mi=new THREE.Matrix4,vi=new THREE.Vector3,gi=new THREE.Vector3,Ei=!0,yi={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};var Ti;var xi;var Ri;var bi;var _i;var wi;Mt();St();this.context=Ti;var Hi=Ti.getParameter(Ti.MAX_TEXTURE_IMAGE_UNITS);var Mi=Ti.getParameter(Ti.MAX_VERTEX_TEXTURE_IMAGE_UNITS);Ti.getParameter(Ti.MAX_TEXTURE_SIZE);var Si=Ti.getParameter(Ti.MAX_CUBE_MAP_TEXTURE_SIZE);var Ci=_i?Ti.getParameter(_i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;var Ai=Mi>0;var Di=Ai&&xi;wi?Ti.getParameter(Ti.COMPRESSED_TEXTURE_FORMATS):[];var Pi=Ti.getShaderPrecisionFormat(Ti.VERTEX_SHADER,Ti.HIGH_FLOAT);var Li=Ti.getShaderPrecisionFormat(Ti.VERTEX_SHADER,Ti.MEDIUM_FLOAT);Ti.getShaderPrecisionFormat(Ti.VERTEX_SHADER,Ti.LOW_FLOAT);var Fi=Ti.getShaderPrecisionFormat(Ti.FRAGMENT_SHADER,Ti.HIGH_FLOAT);var Ni=Ti.getShaderPrecisionFormat(Ti.FRAGMENT_SHADER,Ti.MEDIUM_FLOAT);Ti.getShaderPrecisionFormat(Ti.FRAGMENT_SHADER,Ti.LOW_FLOAT);Ti.getShaderPrecisionFormat(Ti.VERTEX_SHADER,Ti.HIGH_INT);Ti.getShaderPrecisionFormat(Ti.VERTEX_SHADER,Ti.MEDIUM_INT);Ti.getShaderPrecisionFormat(Ti.VERTEX_SHADER,Ti.LOW_INT);Ti.getShaderPrecisionFormat(Ti.FRAGMENT_SHADER,Ti.HIGH_INT);Ti.getShaderPrecisionFormat(Ti.FRAGMENT_SHADER,Ti.MEDIUM_INT);Ti.getShaderPrecisionFormat(Ti.FRAGMENT_SHADER,Ti.LOW_INT);var Ui=Pi.precision>0&&Fi.precision>0;var Oi=Li.precision>0&&Ni.precision>0;if("highp"===At&&!Ui)if(Oi){At="mediump";console.warn("WebGLRenderer: highp not supported, using mediump")}else{At="lowp";console.warn("WebGLRenderer: highp and mediump not supported, using lowp")}if("mediump"===At&&!Oi){At="lowp";console.warn("WebGLRenderer: mediump not supported, using lowp")}this.getContext=function(){return Ti};this.supportsVertexTextures=function(){return Ai};this.supportsFloatTextures=function(){return xi};this.supportsStandardDerivatives=function(){return bi};this.supportsCompressedTextureS3TC=function(){return wi};this.getMaxAnisotropy=function(){return Ci};this.getPrecision=function(){return At};this.setSize=function(e,t,i){Ct.width=e*this.devicePixelRatio;Ct.height=t*this.devicePixelRatio;if(1!==this.devicePixelRatio&&i!==!1){Ct.style.width=e+"px";Ct.style.height=t+"px"}this.setViewport(0,0,Ct.width,Ct.height)};this.setViewport=function(e,t,i,r){oi=void 0!==e?e:0;si=void 0!==t?t:0;li=void 0!==i?i:Ct.width;ci=void 0!==r?r:Ct.height;Ti.viewport(oi,si,li,ci)};this.setScissor=function(e,t,i,r){Ti.scissor(e,t,i,r)};this.enableScissorTest=function(e){e?Ti.enable(Ti.SCISSOR_TEST):Ti.disable(Ti.SCISSOR_TEST)};this.setClearColor=function(e,t){Ut.set(e);Ot=void 0!==t?t:1;Ti.clearColor(Ut.r,Ut.g,Ut.b,Ot)};this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(e,t)};this.getClearColor=function(){return Ut};this.getClearAlpha=function(){return Ot};this.clear=function(e,t,i){var r=0;if(void 0===e||e)r|=Ti.COLOR_BUFFER_BIT;if(void 0===t||t)r|=Ti.DEPTH_BUFFER_BIT;if(void 0===i||i)r|=Ti.STENCIL_BUFFER_BIT;Ti.clear(r)};this.clearTarget=function(e,t,i,r){this.setRenderTarget(e);this.clear(t,i,r)};this.addPostPlugin=function(e){e.init(this);this.renderPluginsPost.push(e)};this.addPrePlugin=function(e){e.init(this);this.renderPluginsPre.push(e)};this.updateShadowMap=function(e,t){Bt=null;Zt=-1;ei=-1;ti=-1;Gt=-1;jt=-1;Ei=!0;qt=-1;Kt=-1;this.shadowMapPlugin.update(e,t)};var Ii=function(e){var t=e.target;t.removeEventListener("dispose",Ii);Vi(t);It.info.memory.geometries--};var ki=function(e){var t=e.target;t.removeEventListener("dispose",ki);ji(t);It.info.memory.textures--};var zi=function(e){var t=e.target;t.removeEventListener("dispose",zi);Gi(t);It.info.memory.textures--};var Bi=function(e){var t=e.target;t.removeEventListener("dispose",Bi);Wi(t)};var Vi=function(e){e.__webglInit=void 0;if(void 0!==e.__webglVertexBuffer)Ti.deleteBuffer(e.__webglVertexBuffer);if(void 0!==e.__webglNormalBuffer)Ti.deleteBuffer(e.__webglNormalBuffer);if(void 0!==e.__webglTangentBuffer)Ti.deleteBuffer(e.__webglTangentBuffer);if(void 0!==e.__webglColorBuffer)Ti.deleteBuffer(e.__webglColorBuffer);if(void 0!==e.__webglUVBuffer)Ti.deleteBuffer(e.__webglUVBuffer);if(void 0!==e.__webglUV2Buffer)Ti.deleteBuffer(e.__webglUV2Buffer);if(void 0!==e.__webglSkinIndicesBuffer)Ti.deleteBuffer(e.__webglSkinIndicesBuffer);if(void 0!==e.__webglSkinWeightsBuffer)Ti.deleteBuffer(e.__webglSkinWeightsBuffer);if(void 0!==e.__webglFaceBuffer)Ti.deleteBuffer(e.__webglFaceBuffer);if(void 0!==e.__webglLineBuffer)Ti.deleteBuffer(e.__webglLineBuffer);if(void 0!==e.__webglLineDistanceBuffer)Ti.deleteBuffer(e.__webglLineDistanceBuffer);if(void 0!==e.geometryGroups)for(var t in e.geometryGroups){var i=e.geometryGroups[t];if(void 0!==i.numMorphTargets)for(var r=0,a=i.numMorphTargets;a>r;r++)Ti.deleteBuffer(i.__webglMorphTargetsBuffers[r]);if(void 0!==i.numMorphNormals)for(var r=0,a=i.numMorphNormals;a>r;r++)Ti.deleteBuffer(i.__webglMorphNormalsBuffers[r]);n(i)}n(e)};var ji=function(e){if(e.image&&e.image.__webglTextureCube)Ti.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1;Ti.deleteTexture(e.__webglTexture)}};var Gi=function(e){if(e&&e.__webglTexture){Ti.deleteTexture(e.__webglTexture);if(e instanceof THREE.WebGLRenderTargetCube)for(var t=0;6>t;t++){Ti.deleteFramebuffer(e.__webglFramebuffer[t]);Ti.deleteRenderbuffer(e.__webglRenderbuffer[t])}else{Ti.deleteFramebuffer(e.__webglFramebuffer);Ti.deleteRenderbuffer(e.__webglRenderbuffer)}}};var Wi=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var i,r,a;var n=!1;for(i=0,r=kt.length;r>i;i++){a=kt[i];if(a.program===t){a.usedTimes--;if(0===a.usedTimes)n=!0;break}}if(n===!0){var o=[];for(i=0,r=kt.length;r>i;i++){a=kt[i];if(a.program!==t)o.push(a)}kt=o;Ti.deleteProgram(t);It.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer)e.__webglVertexBuffer=Ti.createBuffer();
if(e.hasNormals&&!e.__webglNormalBuffer)e.__webglNormalBuffer=Ti.createBuffer();if(e.hasUvs&&!e.__webglUvBuffer)e.__webglUvBuffer=Ti.createBuffer();if(e.hasColors&&!e.__webglColorBuffer)e.__webglColorBuffer=Ti.createBuffer();if(e.hasPositions){Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglVertexBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,e.positionArray,Ti.DYNAMIC_DRAW);Ti.enableVertexAttribArray(t.attributes.position);Ti.vertexAttribPointer(t.attributes.position,3,Ti.FLOAT,!1,0,0)}if(e.hasNormals){Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglNormalBuffer);if(i.shading===THREE.FlatShading){var r,a,n,o,s,l,c,h,u,f,d,p,m,v,g=3*e.count;for(v=0;g>v;v+=9){m=e.normalArray;o=m[v];c=m[v+1];f=m[v+2];s=m[v+3];h=m[v+4];d=m[v+5];l=m[v+6];u=m[v+7];p=m[v+8];r=(o+s+l)/3;a=(c+h+u)/3;n=(f+d+p)/3;m[v]=r;m[v+1]=a;m[v+2]=n;m[v+3]=r;m[v+4]=a;m[v+5]=n;m[v+6]=r;m[v+7]=a;m[v+8]=n}}Ti.bufferData(Ti.ARRAY_BUFFER,e.normalArray,Ti.DYNAMIC_DRAW);Ti.enableVertexAttribArray(t.attributes.normal);Ti.vertexAttribPointer(t.attributes.normal,3,Ti.FLOAT,!1,0,0)}if(e.hasUvs&&i.map){Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglUvBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,e.uvArray,Ti.DYNAMIC_DRAW);Ti.enableVertexAttribArray(t.attributes.uv);Ti.vertexAttribPointer(t.attributes.uv,2,Ti.FLOAT,!1,0,0)}if(e.hasColors&&i.vertexColors!==THREE.NoColors){Ti.bindBuffer(Ti.ARRAY_BUFFER,e.__webglColorBuffer);Ti.bufferData(Ti.ARRAY_BUFFER,e.colorArray,Ti.DYNAMIC_DRAW);Ti.enableVertexAttribArray(t.attributes.color);Ti.vertexAttribPointer(t.attributes.color,3,Ti.FLOAT,!1,0,0)}Ti.drawArrays(Ti.TRIANGLES,0,e.count);e.count=0};this.renderBufferDirect=function(e,t,i,r,a,n){if(r.visible!==!1){var o,s,l,c;var h=j(e,t,i,r,n);var u=h.attributes;var f=a.attributes;var d=!1,p=r.wireframe?1:0,m=16777215*a.id+2*h.id+p;if(m!==Gt){Gt=m;d=!0}if(d)b();if(n instanceof THREE.Mesh){var v=f["index"];if(v){var g=a.offsets;if(g.length>1)d=!0;for(var E=0,y=g.length;y>E;E++){var T=g[E].index;if(d){for(s in f)if("index"!==s){l=u[s];o=f[s];c=o.itemSize;if(l>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,o.buffer);R(l);Ti.vertexAttribPointer(l,c,Ti.FLOAT,!1,0,4*T*c)}}else;Ti.bindBuffer(Ti.ELEMENT_ARRAY_BUFFER,v.buffer)}Ti.drawElements(Ti.TRIANGLES,g[E].count,Ti.UNSIGNED_SHORT,2*g[E].start);It.info.render.calls++;It.info.render.vertices+=g[E].count;It.info.render.faces+=g[E].count/3}}else{if(d)for(s in f)if("index"!==s){l=u[s];o=f[s];c=o.itemSize;if(l>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,o.buffer);R(l);Ti.vertexAttribPointer(l,c,Ti.FLOAT,!1,0,0)}}else;var x=a.attributes["position"];Ti.drawArrays(Ti.TRIANGLES,0,x.numItems/3);It.info.render.calls++;It.info.render.vertices+=x.numItems/3;It.info.render.faces+=x.numItems/3/3}}else if(n instanceof THREE.ParticleSystem){if(d){for(s in f){l=u[s];o=f[s];c=o.itemSize;if(l>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,o.buffer);R(l);Ti.vertexAttribPointer(l,c,Ti.FLOAT,!1,0,0)}}var x=f["position"];Ti.drawArrays(Ti.POINTS,0,x.numItems/3);It.info.render.calls++;It.info.render.points+=x.numItems/3}}else if(n instanceof THREE.Line)if(d){for(s in f){l=u[s];o=f[s];c=o.itemSize;if(l>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,o.buffer);R(l);Ti.vertexAttribPointer(l,c,Ti.FLOAT,!1,0,0)}}var _=n.type===THREE.LineStrip?Ti.LINE_STRIP:Ti.LINES;ot(r.linewidth);var x=f["position"];Ti.drawArrays(_,0,x.numItems/3);It.info.render.calls++;It.info.render.points+=x.numItems}}};this.renderBuffer=function(e,t,i,r,a,n){if(r.visible!==!1){var o,s,l;var c=j(e,t,i,r,n);var h=c.attributes;var u=!1,f=r.wireframe?1:0,d=16777215*a.id+2*c.id+f;if(d!==Gt){Gt=d;u=!0}if(u)b();if(!r.morphTargets&&h.position>=0){if(u){Ti.bindBuffer(Ti.ARRAY_BUFFER,a.__webglVertexBuffer);R(h.position);Ti.vertexAttribPointer(h.position,3,Ti.FLOAT,!1,0,0)}}else if(n.morphTargetBase)_(r,a,n);if(u){if(a.__webglCustomAttributesList)for(s=0,l=a.__webglCustomAttributesList.length;l>s;s++){o=a.__webglCustomAttributesList[s];if(h[o.buffer.belongsToAttribute]>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,o.buffer);R(h[o.buffer.belongsToAttribute]);Ti.vertexAttribPointer(h[o.buffer.belongsToAttribute],o.size,Ti.FLOAT,!1,0,0)}}if(h.color>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,a.__webglColorBuffer);R(h.color);Ti.vertexAttribPointer(h.color,3,Ti.FLOAT,!1,0,0)}if(h.normal>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,a.__webglNormalBuffer);R(h.normal);Ti.vertexAttribPointer(h.normal,3,Ti.FLOAT,!1,0,0)}if(h.tangent>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,a.__webglTangentBuffer);R(h.tangent);Ti.vertexAttribPointer(h.tangent,4,Ti.FLOAT,!1,0,0)}if(h.uv>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,a.__webglUVBuffer);R(h.uv);Ti.vertexAttribPointer(h.uv,2,Ti.FLOAT,!1,0,0)}if(h.uv2>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,a.__webglUV2Buffer);R(h.uv2);Ti.vertexAttribPointer(h.uv2,2,Ti.FLOAT,!1,0,0)}if(r.skinning&&h.skinIndex>=0&&h.skinWeight>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,a.__webglSkinIndicesBuffer);R(h.skinIndex);Ti.vertexAttribPointer(h.skinIndex,4,Ti.FLOAT,!1,0,0);Ti.bindBuffer(Ti.ARRAY_BUFFER,a.__webglSkinWeightsBuffer);R(h.skinWeight);Ti.vertexAttribPointer(h.skinWeight,4,Ti.FLOAT,!1,0,0)}if(h.lineDistance>=0){Ti.bindBuffer(Ti.ARRAY_BUFFER,a.__webglLineDistanceBuffer);R(h.lineDistance);Ti.vertexAttribPointer(h.lineDistance,1,Ti.FLOAT,!1,0,0)}}if(n instanceof THREE.Mesh){if(r.wireframe){ot(r.wireframeLinewidth);if(u)Ti.bindBuffer(Ti.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer);Ti.drawElements(Ti.LINES,a.__webglLineCount,Ti.UNSIGNED_SHORT,0)}else{if(u)Ti.bindBuffer(Ti.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer);Ti.drawElements(Ti.TRIANGLES,a.__webglFaceCount,Ti.UNSIGNED_SHORT,0)}It.info.render.calls++;It.info.render.vertices+=a.__webglFaceCount;It.info.render.faces+=a.__webglFaceCount/3}else if(n instanceof THREE.Line){var p=n.type===THREE.LineStrip?Ti.LINE_STRIP:Ti.LINES;ot(r.linewidth);Ti.drawArrays(p,0,a.__webglLineCount);It.info.render.calls++}else if(n instanceof THREE.ParticleSystem){Ti.drawArrays(Ti.POINTS,0,a.__webglParticleCount);It.info.render.calls++;It.info.render.points+=a.__webglParticleCount}else if(n instanceof THREE.Ribbon){Ti.drawArrays(Ti.TRIANGLE_STRIP,0,a.__webglVertexCount);It.info.render.calls++}}};this.render=function(e,t,i,r){if(t instanceof THREE.Camera!=!1){var a,n,o,s,l,c=e.__lights,h=e.fog;jt=-1;Ei=!0;if(e.autoUpdate===!0)e.updateMatrixWorld();if(void 0===t.parent)t.updateMatrixWorld();t.matrixWorldInverse.getInverse(t.matrixWorld);pi.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);di.setFromMatrix(pi);if(this.autoUpdateObjects)this.initWebGLObjects(e);M(this.renderPluginsPre,e,t);It.info.render.calls=0;It.info.render.vertices=0;It.info.render.faces=0;It.info.render.points=0;this.setRenderTarget(i);if(this.autoClear||r)this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);l=e.__webglObjects;for(a=0,n=l.length;n>a;a++){o=l[a];s=o.object;o.id=a;o.render=!1;if(s.visible)if(!(s instanceof THREE.Mesh||s instanceof THREE.ParticleSystem)||!s.frustumCulled||di.intersectsObject(s)){it(s,t);D(o);o.render=!0;if(this.sortObjects===!0)if(null!==s.renderDepth)o.z=s.renderDepth;else{vi.getPositionFromMatrix(s.matrixWorld);vi.applyProjection(pi);o.z=vi.z}}}if(this.sortObjects)l.sort(w);l=e.__webglObjectsImmediate;for(a=0,n=l.length;n>a;a++){o=l[a];s=o.object;if(s.visible){it(s,t);A(o)}}if(e.overrideMaterial){var u=e.overrideMaterial;this.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst);this.setDepthTest(u.depthTest);this.setDepthWrite(u.depthWrite);st(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits);S(e.__webglObjects,!1,"",t,c,h,!0,u);C(e.__webglObjectsImmediate,"",t,c,h,!1,u)}else{var u=null;this.setBlending(THREE.NoBlending);S(e.__webglObjects,!0,"opaque",t,c,h,!1,u);C(e.__webglObjectsImmediate,"opaque",t,c,h,!1,u);S(e.__webglObjects,!1,"transparent",t,c,h,!0,u);C(e.__webglObjectsImmediate,"transparent",t,c,h,!0,u)}M(this.renderPluginsPost,e,t);if(i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter)xt(i);this.setDepthTest(!0);this.setDepthWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")};this.renderImmediateObject=function(e,t,i,r,a){var n=j(e,t,i,r,a);Gt=-1;It.setMaterialFaces(r);if(a.immediateRenderCallback)a.immediateRenderCallback(n,Ti,di);else a.render(function(e){It.renderBufferImmediate(e,n,r)})};this.initWebGLObjects=function(e){if(!e.__webglObjects){e.__webglObjects=[];e.__webglObjectsImmediate=[];e.__webglSprites=[];e.__webglFlares=[]}for(;e.__objectsAdded.length;){L(e.__objectsAdded[0],e);e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){k(e.__objectsRemoved[0],e);e.__objectsRemoved.splice(0,1)}for(var t=0,i=e.__webglObjects.length;i>t;t++){var r=e.__webglObjects[t].object;if(void 0===r.__webglInit){if(void 0!==r.__webglActive)k(r,e);L(r,e)}U(r)}};this.initMaterial=function(e,t,i,r){e.addEventListener("dispose",Bi);var a,n,o,s,l,c,h;if(e instanceof THREE.MeshDepthMaterial)h="depth";else if(e instanceof THREE.MeshNormalMaterial)h="normal";else if(e instanceof THREE.MeshBasicMaterial)h="basic";else if(e instanceof THREE.MeshLambertMaterial)h="lambert";else if(e instanceof THREE.MeshPhongMaterial)h="phong";else if(e instanceof THREE.LineBasicMaterial)h="basic";else if(e instanceof THREE.LineDashedMaterial)h="dashed";else if(e instanceof THREE.ParticleBasicMaterial)h="particle_basic";if(h)V(e,THREE.ShaderLib[h]);s=wt(t);c=Ht(t);l=_t(r);o={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:l,useVertexTexture:Di&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:c,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide};e.program=ct(h,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,o);var u=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var f,d="morphTarget";for(n=0;n<this.maxMorphTargets;n++){f=d+n;if(u[f]>=0)e.numSupportedMorphTargets++}}if(e.morphNormals){e.numSupportedMorphNormals=0;var f,d="morphNormal";for(n=0;n<this.maxMorphNormals;n++){f=d+n;if(u[f]>=0)e.numSupportedMorphNormals++}}e.uniformsList=[];for(a in e.uniforms)e.uniformsList.push([e.uniforms[a],a])};this.setFaceCulling=function(e,t){if(e===THREE.CullFaceNone)Ti.disable(Ti.CULL_FACE);else{if(t===THREE.FrontFaceDirectionCW)Ti.frontFace(Ti.CW);else Ti.frontFace(Ti.CCW);if(e===THREE.CullFaceBack)Ti.cullFace(Ti.BACK);else if(e===THREE.CullFaceFront)Ti.cullFace(Ti.FRONT);else Ti.cullFace(Ti.FRONT_AND_BACK);Ti.enable(Ti.CULL_FACE)}};this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide;var i=e.side===THREE.BackSide;if(qt!==t){if(t)Ti.disable(Ti.CULL_FACE);else Ti.enable(Ti.CULL_FACE);qt=t}if(Kt!==i){if(i)Ti.frontFace(Ti.CW);else Ti.frontFace(Ti.CCW);Kt=i}};this.setDepthTest=function(e){if(ei!==e){if(e)Ti.enable(Ti.DEPTH_TEST);else Ti.disable(Ti.DEPTH_TEST);ei=e}};this.setDepthWrite=function(e){if(ti!==e){Ti.depthMask(e);ti=e}};this.setBlending=function(e,t,i,r){if(e!==Zt){if(e===THREE.NoBlending)Ti.disable(Ti.BLEND);else if(e===THREE.AdditiveBlending){Ti.enable(Ti.BLEND);Ti.blendEquation(Ti.FUNC_ADD);Ti.blendFunc(Ti.SRC_ALPHA,Ti.ONE)}else if(e===THREE.SubtractiveBlending){Ti.enable(Ti.BLEND);Ti.blendEquation(Ti.FUNC_ADD);Ti.blendFunc(Ti.ZERO,Ti.ONE_MINUS_SRC_COLOR)}else if(e===THREE.MultiplyBlending){Ti.enable(Ti.BLEND);Ti.blendEquation(Ti.FUNC_ADD);Ti.blendFunc(Ti.ZERO,Ti.SRC_COLOR)}else if(e===THREE.CustomBlending)Ti.enable(Ti.BLEND);else{Ti.enable(Ti.BLEND);Ti.blendEquationSeparate(Ti.FUNC_ADD,Ti.FUNC_ADD);Ti.blendFuncSeparate(Ti.SRC_ALPHA,Ti.ONE_MINUS_SRC_ALPHA,Ti.ONE,Ti.ONE_MINUS_SRC_ALPHA)}Zt=e}if(e===THREE.CustomBlending){if(t!==Qt){Ti.blendEquation(bt(t));Qt=t}if(i!==$t||r!==Jt){Ti.blendFunc(bt(i),bt(r));$t=i;Jt=r}}else{Qt=null;$t=null;Jt=null}};this.setTexture=function(e,t){if(e.needsUpdate){if(!e.__webglInit){e.__webglInit=!0;e.addEventListener("dispose",ki);e.__webglTexture=Ti.createTexture();It.info.memory.textures++}Ti.activeTexture(Ti.TEXTURE0+t);Ti.bindTexture(Ti.TEXTURE_2D,e.__webglTexture);Ti.pixelStorei(Ti.UNPACK_FLIP_Y_WEBGL,e.flipY);Ti.pixelStorei(Ti.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);Ti.pixelStorei(Ti.UNPACK_ALIGNMENT,e.unpackAlignment);var i=e.image,r=pt(i.width)&&pt(i.height),a=bt(e.format),n=bt(e.type);mt(Ti.TEXTURE_2D,e,r);var o,s=e.mipmaps;if(e instanceof THREE.DataTexture)if(s.length>0&&r){for(var l=0,c=s.length;c>l;l++){o=s[l];Ti.texImage2D(Ti.TEXTURE_2D,l,a,o.width,o.height,0,a,n,o.data)}e.generateMipmaps=!1}else Ti.texImage2D(Ti.TEXTURE_2D,0,a,i.width,i.height,0,a,n,i.data);else if(e instanceof THREE.CompressedTexture)for(var l=0,c=s.length;c>l;l++){o=s[l];Ti.compressedTexImage2D(Ti.TEXTURE_2D,l,a,o.width,o.height,0,o.data)}else if(s.length>0&&r){for(var l=0,c=s.length;c>l;l++){o=s[l];Ti.texImage2D(Ti.TEXTURE_2D,l,a,a,n,o)}e.generateMipmaps=!1}else Ti.texImage2D(Ti.TEXTURE_2D,0,a,a,n,e.image);if(e.generateMipmaps&&r)Ti.generateMipmap(Ti.TEXTURE_2D);e.needsUpdate=!1;if(e.onUpdate)e.onUpdate()}else{Ti.activeTexture(Ti.TEXTURE0+t);Ti.bindTexture(Ti.TEXTURE_2D,e.__webglTexture)}};this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){if(void 0===e.depthBuffer)e.depthBuffer=!0;if(void 0===e.stencilBuffer)e.stencilBuffer=!0;e.addEventListener("dispose",zi);e.__webglTexture=Ti.createTexture();It.info.memory.textures++;var i=pt(e.width)&&pt(e.height),r=bt(e.format),a=bt(e.type);if(t){e.__webglFramebuffer=[];e.__webglRenderbuffer=[];Ti.bindTexture(Ti.TEXTURE_CUBE_MAP,e.__webglTexture);mt(Ti.TEXTURE_CUBE_MAP,e,i);for(var n=0;6>n;n++){e.__webglFramebuffer[n]=Ti.createFramebuffer();e.__webglRenderbuffer[n]=Ti.createRenderbuffer();Ti.texImage2D(Ti.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,r,e.width,e.height,0,r,a,null);yt(e.__webglFramebuffer[n],e,Ti.TEXTURE_CUBE_MAP_POSITIVE_X+n);Tt(e.__webglRenderbuffer[n],e)}if(i)Ti.generateMipmap(Ti.TEXTURE_CUBE_MAP)}else{e.__webglFramebuffer=Ti.createFramebuffer();if(e.shareDepthFrom)e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer;else e.__webglRenderbuffer=Ti.createRenderbuffer();Ti.bindTexture(Ti.TEXTURE_2D,e.__webglTexture);mt(Ti.TEXTURE_2D,e,i);Ti.texImage2D(Ti.TEXTURE_2D,0,r,e.width,e.height,0,r,a,null);yt(e.__webglFramebuffer,e,Ti.TEXTURE_2D);if(e.shareDepthFrom){if(e.depthBuffer&&!e.stencilBuffer)Ti.framebufferRenderbuffer(Ti.FRAMEBUFFER,Ti.DEPTH_ATTACHMENT,Ti.RENDERBUFFER,e.__webglRenderbuffer);else if(e.depthBuffer&&e.stencilBuffer)Ti.framebufferRenderbuffer(Ti.FRAMEBUFFER,Ti.DEPTH_STENCIL_ATTACHMENT,Ti.RENDERBUFFER,e.__webglRenderbuffer)}else Tt(e.__webglRenderbuffer,e);if(i)Ti.generateMipmap(Ti.TEXTURE_2D)}if(t)Ti.bindTexture(Ti.TEXTURE_CUBE_MAP,null);else Ti.bindTexture(Ti.TEXTURE_2D,null);Ti.bindRenderbuffer(Ti.RENDERBUFFER,null);Ti.bindFramebuffer(Ti.FRAMEBUFFER,null)}var o,s,l,c,h;if(e){if(t)o=e.__webglFramebuffer[e.activeCubeFace];else o=e.__webglFramebuffer;s=e.width;l=e.height;c=0;h=0}else{o=null;s=li;l=ci;c=oi;h=si}if(o!==Vt){Ti.bindFramebuffer(Ti.FRAMEBUFFER,o);Ti.viewport(c,h,s,l);Vt=o}hi=s;ui=l};this.shadowMapPlugin=new THREE.ShadowMapPlugin;this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new THREE.SpritePlugin);this.addPostPlugin(new THREE.LensFlarePlugin)};