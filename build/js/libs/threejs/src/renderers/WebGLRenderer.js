THREE.WebGLRenderer=function(e){function t(e){e.__webglVertexBuffer=Ot.createBuffer(),e.__webglColorBuffer=Ot.createBuffer(),Gt.info.memory.geometries++}function i(e){e.__webglVertexBuffer=Ot.createBuffer(),e.__webglColorBuffer=Ot.createBuffer(),e.__webglLineDistanceBuffer=Ot.createBuffer(),Gt.info.memory.geometries++}function r(e){e.__webglVertexBuffer=Ot.createBuffer(),e.__webglColorBuffer=Ot.createBuffer(),e.__webglNormalBuffer=Ot.createBuffer(),Gt.info.memory.geometries++}function n(e){e.__webglVertexBuffer=Ot.createBuffer(),e.__webglNormalBuffer=Ot.createBuffer(),e.__webglTangentBuffer=Ot.createBuffer(),e.__webglColorBuffer=Ot.createBuffer(),e.__webglUVBuffer=Ot.createBuffer(),e.__webglUV2Buffer=Ot.createBuffer(),e.__webglSkinIndicesBuffer=Ot.createBuffer(),e.__webglSkinWeightsBuffer=Ot.createBuffer(),e.__webglFaceBuffer=Ot.createBuffer(),e.__webglLineBuffer=Ot.createBuffer();var t,i;if(e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,i=e.numMorphTargets;i>t;t++)e.__webglMorphTargetsBuffers.push(Ot.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,i=e.numMorphNormals;i>t;t++)e.__webglMorphNormalsBuffers.push(Ot.createBuffer());Gt.info.memory.geometries++}function o(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Ot.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function a(e,t){var i=e.vertices.length,r=t.material;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var n in r.attributes){var o=r.attributes[n];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(i*a),o.buffer=Ot.createBuffer(),o.buffer.belongsToAttribute=n,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}}function s(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__sortArray=[],e.__webglParticleCount=i,a(e,t)}function l(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i,a(e,t)}function c(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__normalArray=new Float32Array(3*i),e.__webglVertexCount=i,a(e,t)}function h(e,t){var i=t.geometry,r=e.faces3,n=e.faces4,o=3*r.length+4*n.length,a=1*r.length+2*n.length,s=3*r.length+4*n.length,l=u(t,e),c=m(l),h=p(l),d=f(l);e.__vertexArray=new Float32Array(3*o),h&&(e.__normalArray=new Float32Array(3*o)),i.hasTangents&&(e.__tangentArray=new Float32Array(4*o)),d&&(e.__colorArray=new Float32Array(3*o)),c&&((i.faceUvs.length>0||i.faceVertexUvs.length>0)&&(e.__uvArray=new Float32Array(2*o)),(i.faceUvs.length>1||i.faceVertexUvs.length>1)&&(e.__uv2Array=new Float32Array(2*o))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*o),e.__skinWeightArray=new Float32Array(4*o)),e.__faceArray=new Uint16Array(3*a),e.__lineArray=new Uint16Array(2*s);var g,E;if(e.numMorphTargets)for(e.__morphTargetsArrays=[],g=0,E=e.numMorphTargets;E>g;g++)e.__morphTargetsArrays.push(new Float32Array(3*o));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],g=0,E=e.numMorphNormals;E>g;g++)e.__morphNormalsArrays.push(new Float32Array(3*o));if(e.__webglFaceCount=3*a,e.__webglLineCount=2*s,l.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var v in l.attributes){var y=l.attributes[v],T={};for(var x in y)T[x]=y[x];if(!T.__webglInitialized||T.createUniqueBuffers){T.__webglInitialized=!0;var R=1;"v2"===T.type?R=2:"v3"===T.type?R=3:"v4"===T.type?R=4:"c"===T.type&&(R=3),T.size=R,T.array=new Float32Array(o*R),T.buffer=Ot.createBuffer(),T.buffer.belongsToAttribute=v,y.needsUpdate=!0,T.__original=y}e.__webglCustomAttributesList.push(T)}}e.__inittedArrays=!0}function u(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function d(e){return e&&void 0!==e.shading&&e.shading===THREE.SmoothShading}function p(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:d(e)?THREE.SmoothShading:THREE.FlatShading}function f(e){return e.vertexColors?e.vertexColors:!1}function m(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial?!0:!1}function g(e){var t,i,r;for(t in e.attributes)r="index"===t?Ot.ELEMENT_ARRAY_BUFFER:Ot.ARRAY_BUFFER,i=e.attributes[t],void 0===i.numItems&&(i.numItems=i.array.length),i.buffer=Ot.createBuffer(),Ot.bindBuffer(r,i.buffer),Ot.bufferData(r,i.array,Ot.STATIC_DRAW)}function E(e,t,i){var r,n,o,a,s,l,c,h,u,d,p,f,m=e.vertices,g=m.length,E=e.colors,v=E.length,y=e.__vertexArray,T=e.__colorArray,x=e.__sortArray,R=e.verticesNeedUpdate,b=(e.elementsNeedUpdate,e.colorsNeedUpdate),_=e.__webglCustomAttributesList;if(i.sortParticles){for(xi.copy(Ti),xi.multiply(i.matrixWorld),r=0;g>r;r++)o=m[r],Ri.copy(o),Ri.applyProjection(xi),x[r]=[Ri.z,r];for(x.sort(H),r=0;g>r;r++)o=m[x[r][1]],a=3*r,y[a]=o.x,y[a+1]=o.y,y[a+2]=o.z;for(n=0;v>n;n++)a=3*n,l=E[x[n][1]],T[a]=l.r,T[a+1]=l.g,T[a+2]=l.b;if(_)for(c=0,h=_.length;h>c;c++)if(f=_[c],void 0===f.boundTo||"vertices"===f.boundTo)if(a=0,d=f.value.length,1===f.size)for(u=0;d>u;u++)s=x[u][1],f.array[u]=f.value[s];else if(2===f.size)for(u=0;d>u;u++)s=x[u][1],p=f.value[s],f.array[a]=p.x,f.array[a+1]=p.y,a+=2;else if(3===f.size)if("c"===f.type)for(u=0;d>u;u++)s=x[u][1],p=f.value[s],f.array[a]=p.r,f.array[a+1]=p.g,f.array[a+2]=p.b,a+=3;else for(u=0;d>u;u++)s=x[u][1],p=f.value[s],f.array[a]=p.x,f.array[a+1]=p.y,f.array[a+2]=p.z,a+=3;else if(4===f.size)for(u=0;d>u;u++)s=x[u][1],p=f.value[s],f.array[a]=p.x,f.array[a+1]=p.y,f.array[a+2]=p.z,f.array[a+3]=p.w,a+=4}else{if(R)for(r=0;g>r;r++)o=m[r],a=3*r,y[a]=o.x,y[a+1]=o.y,y[a+2]=o.z;if(b)for(n=0;v>n;n++)l=E[n],a=3*n,T[a]=l.r,T[a+1]=l.g,T[a+2]=l.b;if(_)for(c=0,h=_.length;h>c;c++)if(f=_[c],f.needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo))if(d=f.value.length,a=0,1===f.size)for(u=0;d>u;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;d>u;u++)p=f.value[u],f.array[a]=p.x,f.array[a+1]=p.y,a+=2;else if(3===f.size)if("c"===f.type)for(u=0;d>u;u++)p=f.value[u],f.array[a]=p.r,f.array[a+1]=p.g,f.array[a+2]=p.b,a+=3;else for(u=0;d>u;u++)p=f.value[u],f.array[a]=p.x,f.array[a+1]=p.y,f.array[a+2]=p.z,a+=3;else if(4===f.size)for(u=0;d>u;u++)p=f.value[u],f.array[a]=p.x,f.array[a+1]=p.y,f.array[a+2]=p.z,f.array[a+3]=p.w,a+=4}if((R||i.sortParticles)&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglVertexBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,y,t)),(b||i.sortParticles)&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglColorBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,T,t)),_)for(c=0,h=_.length;h>c;c++)f=_[c],(f.needsUpdate||i.sortParticles)&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,f.buffer),Ot.bufferData(Ot.ARRAY_BUFFER,f.array,t))}function v(e,t){var i,r,n,o,a,s,l,c,h,u,d,p,f=e.vertices,m=e.colors,g=e.lineDistances,E=f.length,v=m.length,y=g.length,T=e.__vertexArray,x=e.__colorArray,R=e.__lineDistanceArray,b=e.verticesNeedUpdate,_=e.colorsNeedUpdate,w=e.lineDistancesNeedUpdate,H=e.__webglCustomAttributesList;if(b){for(i=0;E>i;i++)o=f[i],a=3*i,T[a]=o.x,T[a+1]=o.y,T[a+2]=o.z;Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglVertexBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,T,t)}if(_){for(r=0;v>r;r++)s=m[r],a=3*r,x[a]=s.r,x[a+1]=s.g,x[a+2]=s.b;Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglColorBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,x,t)}if(w){for(n=0;y>n;n++)R[n]=g[n];Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglLineDistanceBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,R,t)}if(H)for(l=0,c=H.length;c>l;l++)if(p=H[l],p.needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo)){if(a=0,u=p.value.length,1===p.size)for(h=0;u>h;h++)p.array[h]=p.value[h];else if(2===p.size)for(h=0;u>h;h++)d=p.value[h],p.array[a]=d.x,p.array[a+1]=d.y,a+=2;else if(3===p.size)if("c"===p.type)for(h=0;u>h;h++)d=p.value[h],p.array[a]=d.r,p.array[a+1]=d.g,p.array[a+2]=d.b,a+=3;else for(h=0;u>h;h++)d=p.value[h],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,a+=3;else if(4===p.size)for(h=0;u>h;h++)d=p.value[h],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,p.array[a+3]=d.w,a+=4;Ot.bindBuffer(Ot.ARRAY_BUFFER,p.buffer),Ot.bufferData(Ot.ARRAY_BUFFER,p.array,t)}}function y(e,t){var i,r,n,o,a,s,l,c,h,u,d,p,f,m=e.vertices,g=e.colors,E=e.normals,v=m.length,y=g.length,T=E.length,x=e.__vertexArray,R=e.__colorArray,b=e.__normalArray,_=e.verticesNeedUpdate,w=e.colorsNeedUpdate,H=e.normalsNeedUpdate,M=e.__webglCustomAttributesList;if(_){for(i=0;v>i;i++)o=m[i],a=3*i,x[a]=o.x,x[a+1]=o.y,x[a+2]=o.z;Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglVertexBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,x,t)}if(w){for(r=0;y>r;r++)s=g[r],a=3*r,R[a]=s.r,R[a+1]=s.g,R[a+2]=s.b;Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglColorBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,R,t)}if(H){for(n=0;T>n;n++)l=E[n],a=3*n,b[a]=l.x,b[a+1]=l.y,b[a+2]=l.z;Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglNormalBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,b,t)}if(M)for(c=0,h=M.length;h>c;c++)if(p=M[c],p.needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo)){if(a=0,d=p.value.length,1===p.size)for(u=0;d>u;u++)p.array[u]=p.value[u];else if(2===p.size)for(u=0;d>u;u++)f=p.value[u],p.array[a]=f.x,p.array[a+1]=f.y,a+=2;else if(3===p.size)if("c"===p.type)for(u=0;d>u;u++)f=p.value[u],p.array[a]=f.r,p.array[a+1]=f.g,p.array[a+2]=f.b,a+=3;else for(u=0;d>u;u++)f=p.value[u],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,a+=3;else if(4===p.size)for(u=0;d>u;u++)f=p.value[u],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,p.array[a+3]=f.w,a+=4;Ot.bindBuffer(Ot.ARRAY_BUFFER,p.buffer),Ot.bufferData(Ot.ARRAY_BUFFER,p.array,t)}}function T(e,t,i,r,n){if(e.__inittedArrays){var o,a,s,l,c,h,u,d,g,E,v,y,T,x,R,b,_,w,H,M,S,C,A,D,P,L,F,N,I,U,O,z,k,B,V,j,G,W,X,Y,q,K,Z,Q,$,J,et,tt,it=p(n),rt=f(n),nt=m(n),ot=it===THREE.SmoothShading,at=0,st=0,lt=0,ct=0,ht=0,ut=0,dt=0,pt=0,ft=0,mt=0,gt=0,Et=0,vt=0,yt=e.__vertexArray,Tt=e.__uvArray,xt=e.__uv2Array,Rt=e.__normalArray,bt=e.__tangentArray,_t=e.__colorArray,wt=e.__skinIndexArray,Ht=e.__skinWeightArray,Mt=e.__morphTargetsArrays,St=e.__morphNormalsArrays,Ct=e.__webglCustomAttributesList,At=e.__faceArray,Dt=e.__lineArray,Pt=t.geometry,Lt=Pt.verticesNeedUpdate,Ft=Pt.elementsNeedUpdate,Nt=Pt.uvsNeedUpdate,It=Pt.normalsNeedUpdate,Ut=Pt.tangentsNeedUpdate,zt=Pt.colorsNeedUpdate,kt=Pt.morphTargetsNeedUpdate,Bt=Pt.vertices,Vt=e.faces3,jt=e.faces4,Gt=Pt.faces,Wt=Pt.faceVertexUvs[0],Xt=Pt.faceVertexUvs[1],Yt=(Pt.colors,Pt.skinIndices),qt=Pt.skinWeights,Kt=Pt.morphTargets,Zt=Pt.morphNormals;if(Lt){for(o=0,a=Vt.length;a>o;o++)l=Gt[Vt[o]],y=Bt[l.a],T=Bt[l.b],x=Bt[l.c],yt[st]=y.x,yt[st+1]=y.y,yt[st+2]=y.z,yt[st+3]=T.x,yt[st+4]=T.y,yt[st+5]=T.z,yt[st+6]=x.x,yt[st+7]=x.y,yt[st+8]=x.z,st+=9;for(o=0,a=jt.length;a>o;o++)l=Gt[jt[o]],y=Bt[l.a],T=Bt[l.b],x=Bt[l.c],R=Bt[l.d],yt[st]=y.x,yt[st+1]=y.y,yt[st+2]=y.z,yt[st+3]=T.x,yt[st+4]=T.y,yt[st+5]=T.z,yt[st+6]=x.x,yt[st+7]=x.y,yt[st+8]=x.z,yt[st+9]=R.x,yt[st+10]=R.y,yt[st+11]=R.z,st+=12;Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglVertexBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,yt,i)}if(kt)for(q=0,K=Kt.length;K>q;q++){for(gt=0,o=0,a=Vt.length;a>o;o++)$=Vt[o],l=Gt[$],y=Kt[q].vertices[l.a],T=Kt[q].vertices[l.b],x=Kt[q].vertices[l.c],Z=Mt[q],Z[gt]=y.x,Z[gt+1]=y.y,Z[gt+2]=y.z,Z[gt+3]=T.x,Z[gt+4]=T.y,Z[gt+5]=T.z,Z[gt+6]=x.x,Z[gt+7]=x.y,Z[gt+8]=x.z,n.morphNormals&&(ot?(J=Zt[q].vertexNormals[$],M=J.a,S=J.b,C=J.c):(M=Zt[q].faceNormals[$],S=M,C=M),Q=St[q],Q[gt]=M.x,Q[gt+1]=M.y,Q[gt+2]=M.z,Q[gt+3]=S.x,Q[gt+4]=S.y,Q[gt+5]=S.z,Q[gt+6]=C.x,Q[gt+7]=C.y,Q[gt+8]=C.z),gt+=9;for(o=0,a=jt.length;a>o;o++)$=jt[o],l=Gt[$],y=Kt[q].vertices[l.a],T=Kt[q].vertices[l.b],x=Kt[q].vertices[l.c],R=Kt[q].vertices[l.d],Z=Mt[q],Z[gt]=y.x,Z[gt+1]=y.y,Z[gt+2]=y.z,Z[gt+3]=T.x,Z[gt+4]=T.y,Z[gt+5]=T.z,Z[gt+6]=x.x,Z[gt+7]=x.y,Z[gt+8]=x.z,Z[gt+9]=R.x,Z[gt+10]=R.y,Z[gt+11]=R.z,n.morphNormals&&(ot?(J=Zt[q].vertexNormals[$],M=J.a,S=J.b,C=J.c,A=J.d):(M=Zt[q].faceNormals[$],S=M,C=M,A=M),Q=St[q],Q[gt]=M.x,Q[gt+1]=M.y,Q[gt+2]=M.z,Q[gt+3]=S.x,Q[gt+4]=S.y,Q[gt+5]=S.z,Q[gt+6]=C.x,Q[gt+7]=C.y,Q[gt+8]=C.z,Q[gt+9]=A.x,Q[gt+10]=A.y,Q[gt+11]=A.z),gt+=12;Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[q]),Ot.bufferData(Ot.ARRAY_BUFFER,Mt[q],i),n.morphNormals&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[q]),Ot.bufferData(Ot.ARRAY_BUFFER,St[q],i))}if(qt.length){for(o=0,a=Vt.length;a>o;o++)l=Gt[Vt[o]],N=qt[l.a],I=qt[l.b],U=qt[l.c],Ht[mt]=N.x,Ht[mt+1]=N.y,Ht[mt+2]=N.z,Ht[mt+3]=N.w,Ht[mt+4]=I.x,Ht[mt+5]=I.y,Ht[mt+6]=I.z,Ht[mt+7]=I.w,Ht[mt+8]=U.x,Ht[mt+9]=U.y,Ht[mt+10]=U.z,Ht[mt+11]=U.w,z=Yt[l.a],k=Yt[l.b],B=Yt[l.c],wt[mt]=z.x,wt[mt+1]=z.y,wt[mt+2]=z.z,wt[mt+3]=z.w,wt[mt+4]=k.x,wt[mt+5]=k.y,wt[mt+6]=k.z,wt[mt+7]=k.w,wt[mt+8]=B.x,wt[mt+9]=B.y,wt[mt+10]=B.z,wt[mt+11]=B.w,mt+=12;for(o=0,a=jt.length;a>o;o++)l=Gt[jt[o]],N=qt[l.a],I=qt[l.b],U=qt[l.c],O=qt[l.d],Ht[mt]=N.x,Ht[mt+1]=N.y,Ht[mt+2]=N.z,Ht[mt+3]=N.w,Ht[mt+4]=I.x,Ht[mt+5]=I.y,Ht[mt+6]=I.z,Ht[mt+7]=I.w,Ht[mt+8]=U.x,Ht[mt+9]=U.y,Ht[mt+10]=U.z,Ht[mt+11]=U.w,Ht[mt+12]=O.x,Ht[mt+13]=O.y,Ht[mt+14]=O.z,Ht[mt+15]=O.w,z=Yt[l.a],k=Yt[l.b],B=Yt[l.c],V=Yt[l.d],wt[mt]=z.x,wt[mt+1]=z.y,wt[mt+2]=z.z,wt[mt+3]=z.w,wt[mt+4]=k.x,wt[mt+5]=k.y,wt[mt+6]=k.z,wt[mt+7]=k.w,wt[mt+8]=B.x,wt[mt+9]=B.y,wt[mt+10]=B.z,wt[mt+11]=B.w,wt[mt+12]=V.x,wt[mt+13]=V.y,wt[mt+14]=V.z,wt[mt+15]=V.w,mt+=16;mt>0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,wt,i),Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,Ht,i))}if(zt&&rt){for(o=0,a=Vt.length;a>o;o++)l=Gt[Vt[o]],u=l.vertexColors,d=l.color,3===u.length&&rt===THREE.VertexColors?(D=u[0],P=u[1],L=u[2]):(D=d,P=d,L=d),_t[ft]=D.r,_t[ft+1]=D.g,_t[ft+2]=D.b,_t[ft+3]=P.r,_t[ft+4]=P.g,_t[ft+5]=P.b,_t[ft+6]=L.r,_t[ft+7]=L.g,_t[ft+8]=L.b,ft+=9;for(o=0,a=jt.length;a>o;o++)l=Gt[jt[o]],u=l.vertexColors,d=l.color,4===u.length&&rt===THREE.VertexColors?(D=u[0],P=u[1],L=u[2],F=u[3]):(D=d,P=d,L=d,F=d),_t[ft]=D.r,_t[ft+1]=D.g,_t[ft+2]=D.b,_t[ft+3]=P.r,_t[ft+4]=P.g,_t[ft+5]=P.b,_t[ft+6]=L.r,_t[ft+7]=L.g,_t[ft+8]=L.b,_t[ft+9]=F.r,_t[ft+10]=F.g,_t[ft+11]=F.b,ft+=12;ft>0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglColorBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,_t,i))}if(Ut&&Pt.hasTangents){for(o=0,a=Vt.length;a>o;o++)l=Gt[Vt[o]],g=l.vertexTangents,b=g[0],_=g[1],w=g[2],bt[dt]=b.x,bt[dt+1]=b.y,bt[dt+2]=b.z,bt[dt+3]=b.w,bt[dt+4]=_.x,bt[dt+5]=_.y,bt[dt+6]=_.z,bt[dt+7]=_.w,bt[dt+8]=w.x,bt[dt+9]=w.y,bt[dt+10]=w.z,bt[dt+11]=w.w,dt+=12;for(o=0,a=jt.length;a>o;o++)l=Gt[jt[o]],g=l.vertexTangents,b=g[0],_=g[1],w=g[2],H=g[3],bt[dt]=b.x,bt[dt+1]=b.y,bt[dt+2]=b.z,bt[dt+3]=b.w,bt[dt+4]=_.x,bt[dt+5]=_.y,bt[dt+6]=_.z,bt[dt+7]=_.w,bt[dt+8]=w.x,bt[dt+9]=w.y,bt[dt+10]=w.z,bt[dt+11]=w.w,bt[dt+12]=H.x,bt[dt+13]=H.y,bt[dt+14]=H.z,bt[dt+15]=H.w,dt+=16;Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglTangentBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,bt,i)}if(It&&it){for(o=0,a=Vt.length;a>o;o++)if(l=Gt[Vt[o]],c=l.vertexNormals,h=l.normal,3===c.length&&ot)for(j=0;3>j;j++)W=c[j],Rt[ut]=W.x,Rt[ut+1]=W.y,Rt[ut+2]=W.z,ut+=3;else for(j=0;3>j;j++)Rt[ut]=h.x,Rt[ut+1]=h.y,Rt[ut+2]=h.z,ut+=3;for(o=0,a=jt.length;a>o;o++)if(l=Gt[jt[o]],c=l.vertexNormals,h=l.normal,4===c.length&&ot)for(j=0;4>j;j++)W=c[j],Rt[ut]=W.x,Rt[ut+1]=W.y,Rt[ut+2]=W.z,ut+=3;else for(j=0;4>j;j++)Rt[ut]=h.x,Rt[ut+1]=h.y,Rt[ut+2]=h.z,ut+=3;Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglNormalBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,Rt,i)}if(Nt&&Wt&&nt){for(o=0,a=Vt.length;a>o;o++)if(s=Vt[o],E=Wt[s],void 0!==E)for(j=0;3>j;j++)X=E[j],Tt[lt]=X.x,Tt[lt+1]=X.y,lt+=2;for(o=0,a=jt.length;a>o;o++)if(s=jt[o],E=Wt[s],void 0!==E)for(j=0;4>j;j++)X=E[j],Tt[lt]=X.x,Tt[lt+1]=X.y,lt+=2;lt>0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglUVBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,Tt,i))}if(Nt&&Xt&&nt){for(o=0,a=Vt.length;a>o;o++)if(s=Vt[o],v=Xt[s],void 0!==v)for(j=0;3>j;j++)Y=v[j],xt[ct]=Y.x,xt[ct+1]=Y.y,ct+=2;for(o=0,a=jt.length;a>o;o++)if(s=jt[o],v=Xt[s],void 0!==v)for(j=0;4>j;j++)Y=v[j],xt[ct]=Y.x,xt[ct+1]=Y.y,ct+=2;ct>0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglUV2Buffer),Ot.bufferData(Ot.ARRAY_BUFFER,xt,i))}if(Ft){for(o=0,a=Vt.length;a>o;o++)At[ht]=at,At[ht+1]=at+1,At[ht+2]=at+2,ht+=3,Dt[pt]=at,Dt[pt+1]=at+1,Dt[pt+2]=at,Dt[pt+3]=at+2,Dt[pt+4]=at+1,Dt[pt+5]=at+2,pt+=6,at+=3;for(o=0,a=jt.length;a>o;o++)At[ht]=at,At[ht+1]=at+1,At[ht+2]=at+3,At[ht+3]=at+1,At[ht+4]=at+2,At[ht+5]=at+3,ht+=6,Dt[pt]=at,Dt[pt+1]=at+1,Dt[pt+2]=at,Dt[pt+3]=at+3,Dt[pt+4]=at+1,Dt[pt+5]=at+2,Dt[pt+6]=at+2,Dt[pt+7]=at+3,pt+=8,at+=4;Ot.bindBuffer(Ot.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Ot.bufferData(Ot.ELEMENT_ARRAY_BUFFER,At,i),Ot.bindBuffer(Ot.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Ot.bufferData(Ot.ELEMENT_ARRAY_BUFFER,Dt,i)}if(Ct)for(j=0,G=Ct.length;G>j;j++)if(tt=Ct[j],tt.__original.needsUpdate){if(Et=0,vt=0,1===tt.size){if(void 0===tt.boundTo||"vertices"===tt.boundTo){for(o=0,a=Vt.length;a>o;o++)l=Gt[Vt[o]],tt.array[Et]=tt.value[l.a],tt.array[Et+1]=tt.value[l.b],tt.array[Et+2]=tt.value[l.c],Et+=3;for(o=0,a=jt.length;a>o;o++)l=Gt[jt[o]],tt.array[Et]=tt.value[l.a],tt.array[Et+1]=tt.value[l.b],tt.array[Et+2]=tt.value[l.c],tt.array[Et+3]=tt.value[l.d],Et+=4}else if("faces"===tt.boundTo){for(o=0,a=Vt.length;a>o;o++)et=tt.value[Vt[o]],tt.array[Et]=et,tt.array[Et+1]=et,tt.array[Et+2]=et,Et+=3;for(o=0,a=jt.length;a>o;o++)et=tt.value[jt[o]],tt.array[Et]=et,tt.array[Et+1]=et,tt.array[Et+2]=et,tt.array[Et+3]=et,Et+=4}}else if(2===tt.size){if(void 0===tt.boundTo||"vertices"===tt.boundTo){for(o=0,a=Vt.length;a>o;o++)l=Gt[Vt[o]],y=tt.value[l.a],T=tt.value[l.b],x=tt.value[l.c],tt.array[Et]=y.x,tt.array[Et+1]=y.y,tt.array[Et+2]=T.x,tt.array[Et+3]=T.y,tt.array[Et+4]=x.x,tt.array[Et+5]=x.y,Et+=6;for(o=0,a=jt.length;a>o;o++)l=Gt[jt[o]],y=tt.value[l.a],T=tt.value[l.b],x=tt.value[l.c],R=tt.value[l.d],tt.array[Et]=y.x,tt.array[Et+1]=y.y,tt.array[Et+2]=T.x,tt.array[Et+3]=T.y,tt.array[Et+4]=x.x,tt.array[Et+5]=x.y,tt.array[Et+6]=R.x,tt.array[Et+7]=R.y,Et+=8}else if("faces"===tt.boundTo){for(o=0,a=Vt.length;a>o;o++)et=tt.value[Vt[o]],y=et,T=et,x=et,tt.array[Et]=y.x,tt.array[Et+1]=y.y,tt.array[Et+2]=T.x,tt.array[Et+3]=T.y,tt.array[Et+4]=x.x,tt.array[Et+5]=x.y,Et+=6;for(o=0,a=jt.length;a>o;o++)et=tt.value[jt[o]],y=et,T=et,x=et,R=et,tt.array[Et]=y.x,tt.array[Et+1]=y.y,tt.array[Et+2]=T.x,tt.array[Et+3]=T.y,tt.array[Et+4]=x.x,tt.array[Et+5]=x.y,tt.array[Et+6]=R.x,tt.array[Et+7]=R.y,Et+=8}}else if(3===tt.size){var Qt;if(Qt="c"===tt.type?["r","g","b"]:["x","y","z"],void 0===tt.boundTo||"vertices"===tt.boundTo){for(o=0,a=Vt.length;a>o;o++)l=Gt[Vt[o]],y=tt.value[l.a],T=tt.value[l.b],x=tt.value[l.c],tt.array[Et]=y[Qt[0]],tt.array[Et+1]=y[Qt[1]],tt.array[Et+2]=y[Qt[2]],tt.array[Et+3]=T[Qt[0]],tt.array[Et+4]=T[Qt[1]],tt.array[Et+5]=T[Qt[2]],tt.array[Et+6]=x[Qt[0]],tt.array[Et+7]=x[Qt[1]],tt.array[Et+8]=x[Qt[2]],Et+=9;for(o=0,a=jt.length;a>o;o++)l=Gt[jt[o]],y=tt.value[l.a],T=tt.value[l.b],x=tt.value[l.c],R=tt.value[l.d],tt.array[Et]=y[Qt[0]],tt.array[Et+1]=y[Qt[1]],tt.array[Et+2]=y[Qt[2]],tt.array[Et+3]=T[Qt[0]],tt.array[Et+4]=T[Qt[1]],tt.array[Et+5]=T[Qt[2]],tt.array[Et+6]=x[Qt[0]],tt.array[Et+7]=x[Qt[1]],tt.array[Et+8]=x[Qt[2]],tt.array[Et+9]=R[Qt[0]],tt.array[Et+10]=R[Qt[1]],tt.array[Et+11]=R[Qt[2]],Et+=12}else if("faces"===tt.boundTo){for(o=0,a=Vt.length;a>o;o++)et=tt.value[Vt[o]],y=et,T=et,x=et,tt.array[Et]=y[Qt[0]],tt.array[Et+1]=y[Qt[1]],tt.array[Et+2]=y[Qt[2]],tt.array[Et+3]=T[Qt[0]],tt.array[Et+4]=T[Qt[1]],tt.array[Et+5]=T[Qt[2]],tt.array[Et+6]=x[Qt[0]],tt.array[Et+7]=x[Qt[1]],tt.array[Et+8]=x[Qt[2]],Et+=9;for(o=0,a=jt.length;a>o;o++)et=tt.value[jt[o]],y=et,T=et,x=et,R=et,tt.array[Et]=y[Qt[0]],tt.array[Et+1]=y[Qt[1]],tt.array[Et+2]=y[Qt[2]],tt.array[Et+3]=T[Qt[0]],tt.array[Et+4]=T[Qt[1]],tt.array[Et+5]=T[Qt[2]],tt.array[Et+6]=x[Qt[0]],tt.array[Et+7]=x[Qt[1]],tt.array[Et+8]=x[Qt[2]],tt.array[Et+9]=R[Qt[0]],tt.array[Et+10]=R[Qt[1]],tt.array[Et+11]=R[Qt[2]],Et+=12}else if("faceVertices"===tt.boundTo){for(o=0,a=Vt.length;a>o;o++)et=tt.value[Vt[o]],y=et[0],T=et[1],x=et[2],tt.array[Et]=y[Qt[0]],tt.array[Et+1]=y[Qt[1]],tt.array[Et+2]=y[Qt[2]],tt.array[Et+3]=T[Qt[0]],tt.array[Et+4]=T[Qt[1]],tt.array[Et+5]=T[Qt[2]],tt.array[Et+6]=x[Qt[0]],tt.array[Et+7]=x[Qt[1]],tt.array[Et+8]=x[Qt[2]],Et+=9;for(o=0,a=jt.length;a>o;o++)et=tt.value[jt[o]],y=et[0],T=et[1],x=et[2],R=et[3],tt.array[Et]=y[Qt[0]],tt.array[Et+1]=y[Qt[1]],tt.array[Et+2]=y[Qt[2]],tt.array[Et+3]=T[Qt[0]],tt.array[Et+4]=T[Qt[1]],tt.array[Et+5]=T[Qt[2]],tt.array[Et+6]=x[Qt[0]],tt.array[Et+7]=x[Qt[1]],tt.array[Et+8]=x[Qt[2]],tt.array[Et+9]=R[Qt[0]],tt.array[Et+10]=R[Qt[1]],tt.array[Et+11]=R[Qt[2]],Et+=12}}else if(4===tt.size)if(void 0===tt.boundTo||"vertices"===tt.boundTo){for(o=0,a=Vt.length;a>o;o++)l=Gt[Vt[o]],y=tt.value[l.a],T=tt.value[l.b],x=tt.value[l.c],tt.array[Et]=y.x,tt.array[Et+1]=y.y,tt.array[Et+2]=y.z,tt.array[Et+3]=y.w,tt.array[Et+4]=T.x,tt.array[Et+5]=T.y,tt.array[Et+6]=T.z,tt.array[Et+7]=T.w,tt.array[Et+8]=x.x,tt.array[Et+9]=x.y,tt.array[Et+10]=x.z,tt.array[Et+11]=x.w,Et+=12;for(o=0,a=jt.length;a>o;o++)l=Gt[jt[o]],y=tt.value[l.a],T=tt.value[l.b],x=tt.value[l.c],R=tt.value[l.d],tt.array[Et]=y.x,tt.array[Et+1]=y.y,tt.array[Et+2]=y.z,tt.array[Et+3]=y.w,tt.array[Et+4]=T.x,tt.array[Et+5]=T.y,tt.array[Et+6]=T.z,tt.array[Et+7]=T.w,tt.array[Et+8]=x.x,tt.array[Et+9]=x.y,tt.array[Et+10]=x.z,tt.array[Et+11]=x.w,tt.array[Et+12]=R.x,tt.array[Et+13]=R.y,tt.array[Et+14]=R.z,tt.array[Et+15]=R.w,Et+=16}else if("faces"===tt.boundTo){for(o=0,a=Vt.length;a>o;o++)et=tt.value[Vt[o]],y=et,T=et,x=et,tt.array[Et]=y.x,tt.array[Et+1]=y.y,tt.array[Et+2]=y.z,tt.array[Et+3]=y.w,tt.array[Et+4]=T.x,tt.array[Et+5]=T.y,tt.array[Et+6]=T.z,tt.array[Et+7]=T.w,tt.array[Et+8]=x.x,tt.array[Et+9]=x.y,tt.array[Et+10]=x.z,tt.array[Et+11]=x.w,Et+=12;for(o=0,a=jt.length;a>o;o++)et=tt.value[jt[o]],y=et,T=et,x=et,R=et,tt.array[Et]=y.x,tt.array[Et+1]=y.y,tt.array[Et+2]=y.z,tt.array[Et+3]=y.w,tt.array[Et+4]=T.x,tt.array[Et+5]=T.y,tt.array[Et+6]=T.z,tt.array[Et+7]=T.w,tt.array[Et+8]=x.x,tt.array[Et+9]=x.y,tt.array[Et+10]=x.z,tt.array[Et+11]=x.w,tt.array[Et+12]=R.x,tt.array[Et+13]=R.y,tt.array[Et+14]=R.z,tt.array[Et+15]=R.w,Et+=16}else if("faceVertices"===tt.boundTo){for(o=0,a=Vt.length;a>o;o++)et=tt.value[Vt[o]],y=et[0],T=et[1],x=et[2],tt.array[Et]=y.x,tt.array[Et+1]=y.y,tt.array[Et+2]=y.z,tt.array[Et+3]=y.w,tt.array[Et+4]=T.x,tt.array[Et+5]=T.y,tt.array[Et+6]=T.z,tt.array[Et+7]=T.w,tt.array[Et+8]=x.x,tt.array[Et+9]=x.y,tt.array[Et+10]=x.z,tt.array[Et+11]=x.w,Et+=12;for(o=0,a=jt.length;a>o;o++)et=tt.value[jt[o]],y=et[0],T=et[1],x=et[2],R=et[3],tt.array[Et]=y.x,tt.array[Et+1]=y.y,tt.array[Et+2]=y.z,tt.array[Et+3]=y.w,tt.array[Et+4]=T.x,tt.array[Et+5]=T.y,tt.array[Et+6]=T.z,tt.array[Et+7]=T.w,tt.array[Et+8]=x.x,tt.array[Et+9]=x.y,tt.array[Et+10]=x.z,tt.array[Et+11]=x.w,tt.array[Et+12]=R.x,tt.array[Et+13]=R.y,tt.array[Et+14]=R.z,tt.array[Et+15]=R.w,Et+=16}Ot.bindBuffer(Ot.ARRAY_BUFFER,tt.buffer),Ot.bufferData(Ot.ARRAY_BUFFER,tt.array,i)}r&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function x(e,t,i){var r,n,o=e.attributes;for(r in o)n=o[r],n.needsUpdate&&("index"===r?(Ot.bindBuffer(Ot.ELEMENT_ARRAY_BUFFER,n.buffer),Ot.bufferData(Ot.ELEMENT_ARRAY_BUFFER,n.array,t)):(Ot.bindBuffer(Ot.ARRAY_BUFFER,n.buffer),Ot.bufferData(Ot.ARRAY_BUFFER,n.array,t)),n.needsUpdate=!1),i&&!n.dynamic&&(n.array=null)}function R(e){vi[e]||(Ot.enableVertexAttribArray(e),vi[e]=!0)}function b(){for(var e in vi)vi[e]&&(Ot.disableVertexAttribArray(e),vi[e]=!1)}function _(e,t,i){var r=e.program.attributes;if(-1!==i.morphTargetBase&&r.position>=0?(Ot.bindBuffer(Ot.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[i.morphTargetBase]),R(r.position),Ot.vertexAttribPointer(r.position,3,Ot.FLOAT,!1,0,0)):r.position>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,t.__webglVertexBuffer),R(r.position),Ot.vertexAttribPointer(r.position,3,Ot.FLOAT,!1,0,0)),i.morphTargetForcedOrder.length)for(var n=0,o=i.morphTargetForcedOrder,a=i.morphTargetInfluences;n<e.numSupportedMorphTargets&&n<o.length;)r["morphTarget"+n]>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[n]]),R(r["morphTarget"+n]),Ot.vertexAttribPointer(r["morphTarget"+n],3,Ot.FLOAT,!1,0,0)),r["morphNormal"+n]>=0&&e.morphNormals&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[n]]),R(r["morphNormal"+n]),Ot.vertexAttribPointer(r["morphNormal"+n],3,Ot.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[n]=a[o[n]],n++;else{var s,l,c=[],a=i.morphTargetInfluences,h=a.length;for(l=0;h>l;l++)s=a[l],s>0&&c.push([s,l]);c.length>e.numSupportedMorphTargets?(c.sort(H),c.length=e.numSupportedMorphTargets):c.length>e.numSupportedMorphNormals?c.sort(H):0===c.length&&c.push([0,0]);for(var u,n=0;n<e.numSupportedMorphTargets;)c[n]?(u=c[n][1],r["morphTarget"+n]>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u]),R(r["morphTarget"+n]),Ot.vertexAttribPointer(r["morphTarget"+n],3,Ot.FLOAT,!1,0,0)),r["morphNormal"+n]>=0&&e.morphNormals&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[u]),R(r["morphNormal"+n]),Ot.vertexAttribPointer(r["morphNormal"+n],3,Ot.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[n]=a[u]):i.__webglMorphTargetInfluences[n]=0,n++}null!==e.program.uniforms.morphTargetInfluences&&Ot.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}function w(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function H(e,t){return t[0]-e[0]}function M(e,t,i){if(e.length)for(var r=0,n=e.length;n>r;r++)Yt=null,Qt=null,ii=-1,ai=-1,si=-1,ei=-1,ti=-1,Zt=-1,Kt=-1,_i=!0,e[r].render(t,i,gi,Ei),Yt=null,Qt=null,ii=-1,ai=-1,si=-1,ei=-1,ti=-1,Zt=-1,Kt=-1,_i=!0}function S(e,t,i,r,n,o,a,s){var l,c,h,u,d,p,f;t?(d=e.length-1,p=-1,f=-1):(d=0,p=e.length,f=1);for(var m=d;m!==p;m+=f)if(l=e[m],l.render){if(c=l.object,h=l.buffer,s)u=s;else{if(u=l[i],!u)continue;a&&Gt.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),Gt.setDepthTest(u.depthTest),Gt.setDepthWrite(u.depthWrite),st(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}Gt.setMaterialFaces(u),h instanceof THREE.BufferGeometry?Gt.renderBufferDirect(r,n,o,u,h,c):Gt.renderBuffer(r,n,o,u,h,c)}}function C(e,t,i,r,n,o,a){for(var s,l,c,h=0,u=e.length;u>h;h++)if(s=e[h],l=s.object,l.visible){if(a)c=a;else{if(c=s[t],!c)continue;o&&Gt.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst),Gt.setDepthTest(c.depthTest),Gt.setDepthWrite(c.depthWrite),st(c.polygonOffset,c.polygonOffsetFactor,c.polygonOffsetUnits)}Gt.renderImmediateObject(i,r,n,c,l)}}function A(e){var t=e.object,i=t.material;i.transparent?(e.transparent=i,e.opaque=null):(e.opaque=i,e.transparent=null)}function D(e){var t,i,r,n=e.object,o=e.buffer;r=n.material,r instanceof THREE.MeshFaceMaterial?(i=o.materialIndex,t=r.materials[i],t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=r,t&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)))}function P(e,t){var i,r,n,o,a,s,l={},c=e.morphTargets.length,h=e.morphNormals.length,u=t instanceof THREE.MeshFaceMaterial;for(e.geometryGroups={},i=0,r=e.faces.length;r>i;i++)n=e.faces[i],o=u?n.materialIndex:0,void 0===l[o]&&(l[o]={hash:o,counter:0}),s=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:c,numMorphNormals:h}),a=n instanceof THREE.Face3?3:4,e.geometryGroups[s].vertices+a>65535&&(l[o].counter+=1,s=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:c,numMorphNormals:h})),n instanceof THREE.Face3?e.geometryGroups[s].faces3.push(i):e.geometryGroups[s].faces4.push(i),e.geometryGroups[s].vertices+=a;e.geometryGroupsList=[];for(var d in e.geometryGroups)e.geometryGroups[d].id=$t++,e.geometryGroupsList.push(e.geometryGroups[d])}function L(e,o){var a,u,d,p;if(void 0===e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new THREE.Matrix4,e._normalMatrix=new THREE.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",Oi)),u=e.geometry,void 0===u);else if(u instanceof THREE.BufferGeometry)g(u);else if(e instanceof THREE.Mesh){d=e.material,void 0===u.geometryGroups&&P(u,d);for(a in u.geometryGroups)p=u.geometryGroups[a],p.__webglVertexBuffer||(n(p),h(p,e),u.verticesNeedUpdate=!0,u.morphTargetsNeedUpdate=!0,u.elementsNeedUpdate=!0,u.uvsNeedUpdate=!0,u.normalsNeedUpdate=!0,u.tangentsNeedUpdate=!0,u.colorsNeedUpdate=!0)}else e instanceof THREE.Ribbon?u.__webglVertexBuffer||(r(u),c(u,e),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0,u.normalsNeedUpdate=!0):e instanceof THREE.Line?u.__webglVertexBuffer||(i(u),l(u,e),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0,u.lineDistancesNeedUpdate=!0):e instanceof THREE.ParticleSystem&&(u.__webglVertexBuffer||(t(u),s(u,e),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0));if(void 0===e.__webglActive){if(e instanceof THREE.Mesh){if(u=e.geometry,u instanceof THREE.BufferGeometry)F(o.__webglObjects,u,e);else if(u instanceof THREE.Geometry)for(a in u.geometryGroups)p=u.geometryGroups[a],F(o.__webglObjects,p,e)}else e instanceof THREE.Ribbon||e instanceof THREE.Line||e instanceof THREE.ParticleSystem?(u=e.geometry,F(o.__webglObjects,u,e)):e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback?N(o.__webglObjectsImmediate,e):e instanceof THREE.Sprite?o.__webglSprites.push(e):e instanceof THREE.LensFlare&&o.__webglFlares.push(e);e.__webglActive=!0}}function F(e,t,i){e.push({id:null,buffer:t,object:i,opaque:null,transparent:null,z:0})}function N(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function I(e){var t,i,r,n=e.geometry;if(n instanceof THREE.BufferGeometry)x(n,Ot.DYNAMIC_DRAW,!n.dynamic);else if(e instanceof THREE.Mesh){for(var o=0,a=n.geometryGroupsList.length;a>o;o++)t=n.geometryGroupsList[o],r=u(e,t),n.buffersNeedUpdate&&h(t,e),i=r.attributes&&U(r),(n.verticesNeedUpdate||n.morphTargetsNeedUpdate||n.elementsNeedUpdate||n.uvsNeedUpdate||n.normalsNeedUpdate||n.colorsNeedUpdate||n.tangentsNeedUpdate||i)&&T(t,e,Ot.DYNAMIC_DRAW,!n.dynamic,r);n.verticesNeedUpdate=!1,n.morphTargetsNeedUpdate=!1,n.elementsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.tangentsNeedUpdate=!1,n.buffersNeedUpdate=!1,r.attributes&&O(r)}else e instanceof THREE.Ribbon?(r=u(e,n),i=r.attributes&&U(r),(n.verticesNeedUpdate||n.colorsNeedUpdate||n.normalsNeedUpdate||i)&&y(n,Ot.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,n.normalsNeedUpdate=!1,r.attributes&&O(r)):e instanceof THREE.Line?(r=u(e,n),i=r.attributes&&U(r),(n.verticesNeedUpdate||n.colorsNeedUpdate||n.lineDistancesNeedUpdate||i)&&v(n,Ot.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,n.lineDistancesNeedUpdate=!1,r.attributes&&O(r)):e instanceof THREE.ParticleSystem&&(r=u(e,n),i=r.attributes&&U(r),(n.verticesNeedUpdate||n.colorsNeedUpdate||e.sortParticles||i)&&E(n,Ot.DYNAMIC_DRAW,e),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,r.attributes&&O(r))}function U(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function O(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function z(e,t){e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Ribbon||e instanceof THREE.Line?k(t.__webglObjects,e):e instanceof THREE.Sprite?B(t.__webglSprites,e):e instanceof THREE.LensFlare?B(t.__webglFlares,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&k(t.__webglObjectsImmediate,e),delete e.__webglActive}function k(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function B(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function V(e,t){e.uniforms=THREE.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader
}function j(e,t,i,r,n){Jt=0,r.needsUpdate&&(r.program&&Wi(r),Gt.initMaterial(r,t,i,n),r.needsUpdate=!1),r.morphTargets&&(n.__webglMorphTargetInfluences||(n.__webglMorphTargetInfluences=new Float32Array(Gt.maxMorphTargets)));var o=!1,a=r.program,s=a.uniforms,l=r.uniforms;if(a!==Yt&&(Ot.useProgram(a),Yt=a,o=!0),r.id!==Kt&&(Kt=r.id,o=!0),(o||e!==Qt)&&(Ot.uniformMatrix4fv(s.projectionMatrix,!1,e.projectionMatrix.elements),e!==Qt&&(Qt=e)),r.skinning)if(Di&&n.useVertexTexture){if(null!==s.boneTexture){var c=et();Ot.uniform1i(s.boneTexture,c),Gt.setTexture(n.boneTexture,c)}}else null!==s.boneGlobalMatrices&&Ot.uniformMatrix4fv(s.boneGlobalMatrices,!1,n.boneMatrices);return o&&(i&&r.fog&&q(l,i),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights)&&(_i&&(ot(a,t),_i=!1),Q(l,wi)),(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)&&G(l,r),r instanceof THREE.LineBasicMaterial?W(l,r):r instanceof THREE.LineDashedMaterial?(W(l,r),X(l,r)):r instanceof THREE.ParticleBasicMaterial?Y(l,r):r instanceof THREE.MeshPhongMaterial?K(l,r):r instanceof THREE.MeshLambertMaterial?Z(l,r):r instanceof THREE.MeshDepthMaterial?(l.mNear.value=e.near,l.mFar.value=e.far,l.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(l.opacity.value=r.opacity),n.receiveShadow&&!r._shadowPass&&$(l,t),tt(a,r.uniformsList),(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&null!==s.cameraPosition&&(Ri.getPositionFromMatrix(e.matrixWorld),Ot.uniform3f(s.cameraPosition,Ri.x,Ri.y,Ri.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&null!==s.viewMatrix&&Ot.uniformMatrix4fv(s.viewMatrix,!1,e.matrixWorldInverse.elements)),J(s,n),null!==s.modelMatrix&&Ot.uniformMatrix4fv(s.modelMatrix,!1,n.matrixWorld.elements),a}function G(e,t){e.opacity.value=t.opacity,Gt.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var i;if(t.map?i=t.map:t.specularMap?i=t.specularMap:t.normalMap?i=t.normalMap:t.bumpMap&&(i=t.bumpMap),void 0!==i){var r=i.offset,n=i.repeat;e.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,e.reflectivity.value=Gt.gammaInput?t.reflectivity:t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof THREE.CubeRefractionMapping}function W(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function X(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function Y(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=Ct.height/2,e.map.value=t.map}function q(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}function K(e,t){e.shininess.value=t.shininess,Gt.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Z(e,t){Gt.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Q(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function $(e,t){if(e.shadowMatrix)for(var i=0,r=0,n=t.length;n>r;r++){var o=t[r];o.castShadow&&(o instanceof THREE.SpotLight||o instanceof THREE.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[i]=o.shadowMap,e.shadowMapSize.value[i]=o.shadowMapSize,e.shadowMatrix.value[i]=o.shadowMatrix,e.shadowDarkness.value[i]=o.shadowDarkness,e.shadowBias.value[i]=o.shadowBias,i++)}}function J(e,t){Ot.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&Ot.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function et(){var e=Jt;return e>=Hi&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Hi),Jt+=1,e}function tt(e,t){var i,r,n,o,a,s,l,c,h,u,d;for(h=0,u=t.length;u>h;h++)if(o=e.uniforms[t[h][1]])if(i=t[h][0],n=i.type,r=i.value,"i"===n)Ot.uniform1i(o,r);else if("f"===n)Ot.uniform1f(o,r);else if("v2"===n)Ot.uniform2f(o,r.x,r.y);else if("v3"===n)Ot.uniform3f(o,r.x,r.y,r.z);else if("v4"===n)Ot.uniform4f(o,r.x,r.y,r.z,r.w);else if("c"===n)Ot.uniform3f(o,r.r,r.g,r.b);else if("iv1"===n)Ot.uniform1iv(o,r);else if("iv"===n)Ot.uniform3iv(o,r);else if("fv1"===n)Ot.uniform1fv(o,r);else if("fv"===n)Ot.uniform3fv(o,r);else if("v2v"===n){for(void 0===i._array&&(i._array=new Float32Array(2*r.length)),l=0,c=r.length;c>l;l++)d=2*l,i._array[d]=r[l].x,i._array[d+1]=r[l].y;Ot.uniform2fv(o,i._array)}else if("v3v"===n){for(void 0===i._array&&(i._array=new Float32Array(3*r.length)),l=0,c=r.length;c>l;l++)d=3*l,i._array[d]=r[l].x,i._array[d+1]=r[l].y,i._array[d+2]=r[l].z;Ot.uniform3fv(o,i._array)}else if("v4v"===n){for(void 0===i._array&&(i._array=new Float32Array(4*r.length)),l=0,c=r.length;c>l;l++)d=4*l,i._array[d]=r[l].x,i._array[d+1]=r[l].y,i._array[d+2]=r[l].z,i._array[d+3]=r[l].w;Ot.uniform4fv(o,i._array)}else if("m4"===n)void 0===i._array&&(i._array=new Float32Array(16)),r.flattenToArray(i._array),Ot.uniformMatrix4fv(o,!1,i._array);else if("m4v"===n){for(void 0===i._array&&(i._array=new Float32Array(16*r.length)),l=0,c=r.length;c>l;l++)r[l].flattenToArrayOffset(i._array,16*l);Ot.uniformMatrix4fv(o,!1,i._array)}else if("t"===n){if(a=r,s=et(),Ot.uniform1i(o,s),!a)continue;a.image instanceof Array&&6===a.image.length?Et(a,s):a instanceof THREE.WebGLRenderTargetCube?vt(a,s):Gt.setTexture(a,s)}else if("tv"===n){for(void 0===i._array&&(i._array=[]),l=0,c=i.value.length;c>l;l++)i._array[l]=et();for(Ot.uniform1iv(o,i._array),l=0,c=i.value.length;c>l;l++)a=i.value[l],s=i._array[l],a&&Gt.setTexture(a,s)}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+n)}function it(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function rt(e,t,i,r){e[t]=i.r*i.r*r,e[t+1]=i.g*i.g*r,e[t+2]=i.b*i.b*r}function nt(e,t,i,r){e[t]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function ot(e,t){var i,r,n,o,a,s,l,c,h,u=0,d=0,p=0,f=wi,m=f.directional.colors,g=f.directional.positions,E=f.point.colors,v=f.point.positions,y=f.point.distances,T=f.spot.colors,x=f.spot.positions,R=f.spot.distances,b=f.spot.directions,_=f.spot.anglesCos,w=f.spot.exponents,H=f.hemi.skyColors,M=f.hemi.groundColors,S=f.hemi.positions,C=0,A=0,D=0,P=0,L=0,F=0,N=0,I=0,U=0,O=0,z=0,k=0;for(i=0,r=t.length;r>i;i++)if(n=t[i],!n.onlyShadow)if(o=n.color,l=n.intensity,h=n.distance,n instanceof THREE.AmbientLight){if(!n.visible)continue;Gt.gammaInput?(u+=o.r*o.r,d+=o.g*o.g,p+=o.b*o.b):(u+=o.r,d+=o.g,p+=o.b)}else if(n instanceof THREE.DirectionalLight){if(L+=1,!n.visible)continue;if(bi.getPositionFromMatrix(n.matrixWorld),Ri.getPositionFromMatrix(n.target.matrixWorld),bi.sub(Ri),bi.normalize(),0===bi.x&&0===bi.y&&0===bi.z)continue;U=3*C,g[U]=bi.x,g[U+1]=bi.y,g[U+2]=bi.z,Gt.gammaInput?rt(m,U,o,l*l):nt(m,U,o,l),C+=1}else if(n instanceof THREE.PointLight){if(F+=1,!n.visible)continue;O=3*A,Gt.gammaInput?rt(E,O,o,l*l):nt(E,O,o,l),Ri.getPositionFromMatrix(n.matrixWorld),v[O]=Ri.x,v[O+1]=Ri.y,v[O+2]=Ri.z,y[A]=h,A+=1}else if(n instanceof THREE.SpotLight){if(N+=1,!n.visible)continue;z=3*D,Gt.gammaInput?rt(T,z,o,l*l):nt(T,z,o,l),Ri.getPositionFromMatrix(n.matrixWorld),x[z]=Ri.x,x[z+1]=Ri.y,x[z+2]=Ri.z,R[D]=h,bi.copy(Ri),Ri.getPositionFromMatrix(n.target.matrixWorld),bi.sub(Ri),bi.normalize(),b[z]=bi.x,b[z+1]=bi.y,b[z+2]=bi.z,_[D]=Math.cos(n.angle),w[D]=n.exponent,D+=1}else if(n instanceof THREE.HemisphereLight){if(I+=1,!n.visible)continue;if(bi.getPositionFromMatrix(n.matrixWorld),bi.normalize(),0===bi.x&&0===bi.y&&0===bi.z)continue;k=3*P,S[k]=bi.x,S[k+1]=bi.y,S[k+2]=bi.z,a=n.color,s=n.groundColor,Gt.gammaInput?(c=l*l,rt(H,k,a,c),rt(M,k,s,c)):(nt(H,k,a,l),nt(M,k,s,l)),P+=1}for(i=3*C,r=Math.max(m.length,3*L);r>i;i++)m[i]=0;for(i=3*A,r=Math.max(E.length,3*F);r>i;i++)E[i]=0;for(i=3*D,r=Math.max(T.length,3*N);r>i;i++)T[i]=0;for(i=3*P,r=Math.max(H.length,3*I);r>i;i++)H[i]=0;for(i=3*P,r=Math.max(M.length,3*I);r>i;i++)M[i]=0;f.directional.length=C,f.point.length=A,f.spot.length=D,f.hemi.length=P,f.ambient[0]=u,f.ambient[1]=d,f.ambient[2]=p}function at(e){e!==ui&&(Ot.lineWidth(e),ui=e)}function st(e,t,i){li!==e&&(e?Ot.enable(Ot.POLYGON_OFFSET_FILL):Ot.disable(Ot.POLYGON_OFFSET_FILL),li=e),!e||ci===t&&hi===i||(Ot.polygonOffset(t,i),ci=t,hi=i)}function lt(e){var t,i,r=[];for(var n in e)t=e[n],t!==!1&&(i="#define "+n+" "+t,r.push(i));return r.join("\n")}function ct(e,t,i,r,n,o,a){var s,l,c,h,u,d=[];e?d.push(e):(d.push(t),d.push(i));for(c in o)d.push(c),d.push(o[c]);for(s in a)d.push(s),d.push(a[s]);for(u=d.join(),s=0,l=Wt.length;l>s;s++){var p=Wt[s];if(p.code===u)return p.usedTimes++,p.program}var f="SHADOWMAP_TYPE_BASIC";a.shadowMapType===THREE.PCFShadowMap?f="SHADOWMAP_TYPE_PCF":a.shadowMapType===THREE.PCFSoftShadowMap&&(f="SHADOWMAP_TYPE_PCF_SOFT");var m=lt(o);h=Ot.createProgram();var g=["precision "+At+" float;",m,Ai?"#define VERTEX_TEXTURES":"",Gt.gammaInput?"#define GAMMA_INPUT":"",Gt.gammaOutput?"#define GAMMA_OUTPUT":"",Gt.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,"#define MAX_BONES "+a.maxBones,a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.boneTextureWidth?"#define N_BONE_PIXEL_X "+a.boneTextureWidth.toFixed(1):"",a.boneTextureHeight?"#define N_BONE_PIXEL_Y "+a.boneTextureHeight.toFixed(1):"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals?"#define USE_MORPHNORMALS":"",a.perPixel?"#define PHONG_PER_PIXEL":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+f:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),E=["precision "+At+" float;",a.bumpMap||a.normalMap?"#extension GL_OES_standard_derivatives : enable":"",m,"#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"",Gt.gammaInput?"#define GAMMA_INPUT":"",Gt.gammaOutput?"#define GAMMA_OUTPUT":"",Gt.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.metal?"#define METAL":"",a.perPixel?"#define PHONG_PER_PIXEL":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+f:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),v=pt("vertex",g+i),y=pt("fragment",E+t);Ot.attachShader(h,v),Ot.attachShader(h,y),Ot.linkProgram(h),Ot.getProgramParameter(h,Ot.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+Ot.getProgramParameter(h,Ot.VALIDATE_STATUS)+", gl error ["+Ot.getError()+"]"),Ot.deleteShader(y),Ot.deleteShader(v),h.uniforms={},h.attributes={};var T,x,R,b;T=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],a.useVertexTexture?T.push("boneTexture"):T.push("boneGlobalMatrices");for(x in r)T.push(x);for(ht(h,T),T=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],b=0;b<a.maxMorphTargets;b++)T.push("morphTarget"+b);for(b=0;b<a.maxMorphNormals;b++)T.push("morphNormal"+b);for(R in n)T.push(R);return ut(h,T),h.id=Xt++,Wt.push({program:h,code:u,usedTimes:1}),Gt.info.memory.programs=Wt.length,h}function ht(e,t){var i,r,n;for(i=0,r=t.length;r>i;i++)n=t[i],e.uniforms[n]=Ot.getUniformLocation(e,n)}function ut(e,t){var i,r,n;for(i=0,r=t.length;r>i;i++)n=t[i],e.attributes[n]=Ot.getAttribLocation(e,n)}function dt(e){for(var t=e.split("\n"),i=0,r=t.length;r>i;i++)t[i]=i+1+": "+t[i];return t.join("\n")}function pt(e,t){var i;return"fragment"===e?i=Ot.createShader(Ot.FRAGMENT_SHADER):"vertex"===e&&(i=Ot.createShader(Ot.VERTEX_SHADER)),Ot.shaderSource(i,t),Ot.compileShader(i),Ot.getShaderParameter(i,Ot.COMPILE_STATUS)?i:(console.error(Ot.getShaderInfoLog(i)),console.error(dt(t)),null)}function ft(e){return 0===(e&e-1)}function mt(e,t,i){i?(Ot.texParameteri(e,Ot.TEXTURE_WRAP_S,bt(t.wrapS)),Ot.texParameteri(e,Ot.TEXTURE_WRAP_T,bt(t.wrapT)),Ot.texParameteri(e,Ot.TEXTURE_MAG_FILTER,bt(t.magFilter)),Ot.texParameteri(e,Ot.TEXTURE_MIN_FILTER,bt(t.minFilter))):(Ot.texParameteri(e,Ot.TEXTURE_WRAP_S,Ot.CLAMP_TO_EDGE),Ot.texParameteri(e,Ot.TEXTURE_WRAP_T,Ot.CLAMP_TO_EDGE),Ot.texParameteri(e,Ot.TEXTURE_MAG_FILTER,Rt(t.magFilter)),Ot.texParameteri(e,Ot.TEXTURE_MIN_FILTER,Rt(t.minFilter))),Vt&&t.type!==THREE.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(Ot.texParameterf(e,Vt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Ci)),t.__oldAnisotropy=t.anisotropy)}function gt(e,t){if(e.width<=t&&e.height<=t)return e;var i=Math.max(e.width,e.height),r=Math.floor(e.width*t/i),n=Math.floor(e.height*t/i),o=document.createElement("canvas");o.width=r,o.height=n;var a=o.getContext("2d");return a.drawImage(e,0,0,e.width,e.height,0,0,r,n),o}function Et(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",zi),e.image.__webglTextureCube=Ot.createTexture(),Gt.info.memory.textures++),Ot.activeTexture(Ot.TEXTURE0+t),Ot.bindTexture(Ot.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),Ot.pixelStorei(Ot.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof THREE.CompressedTexture,r=[],n=0;6>n;n++)r[n]=Gt.autoScaleCubemaps&&!i?gt(e.image[n],Si):e.image[n];var o=r[0],a=ft(o.width)&&ft(o.height),s=bt(e.format),l=bt(e.type);mt(Ot.TEXTURE_CUBE_MAP,e,a);for(var n=0;6>n;n++)if(i)for(var c,h=r[n].mipmaps,u=0,d=h.length;d>u;u++)c=h[u],Ot.compressedTexImage2D(Ot.TEXTURE_CUBE_MAP_POSITIVE_X+n,u,s,c.width,c.height,0,c.data);else Ot.texImage2D(Ot.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,s,s,l,r[n]);e.generateMipmaps&&a&&Ot.generateMipmap(Ot.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Ot.activeTexture(Ot.TEXTURE0+t),Ot.bindTexture(Ot.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function vt(e,t){Ot.activeTexture(Ot.TEXTURE0+t),Ot.bindTexture(Ot.TEXTURE_CUBE_MAP,e.__webglTexture)}function yt(e,t,i){Ot.bindFramebuffer(Ot.FRAMEBUFFER,e),Ot.framebufferTexture2D(Ot.FRAMEBUFFER,Ot.COLOR_ATTACHMENT0,i,t.__webglTexture,0)}function Tt(e,t){Ot.bindRenderbuffer(Ot.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Ot.renderbufferStorage(Ot.RENDERBUFFER,Ot.DEPTH_COMPONENT16,t.width,t.height),Ot.framebufferRenderbuffer(Ot.FRAMEBUFFER,Ot.DEPTH_ATTACHMENT,Ot.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Ot.renderbufferStorage(Ot.RENDERBUFFER,Ot.DEPTH_STENCIL,t.width,t.height),Ot.framebufferRenderbuffer(Ot.FRAMEBUFFER,Ot.DEPTH_STENCIL_ATTACHMENT,Ot.RENDERBUFFER,e)):Ot.renderbufferStorage(Ot.RENDERBUFFER,Ot.RGBA4,t.width,t.height)}function xt(e){e instanceof THREE.WebGLRenderTargetCube?(Ot.bindTexture(Ot.TEXTURE_CUBE_MAP,e.__webglTexture),Ot.generateMipmap(Ot.TEXTURE_CUBE_MAP),Ot.bindTexture(Ot.TEXTURE_CUBE_MAP,null)):(Ot.bindTexture(Ot.TEXTURE_2D,e.__webglTexture),Ot.generateMipmap(Ot.TEXTURE_2D),Ot.bindTexture(Ot.TEXTURE_2D,null))}function Rt(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?Ot.NEAREST:Ot.LINEAR}function bt(e){if(e===THREE.RepeatWrapping)return Ot.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Ot.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Ot.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Ot.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Ot.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Ot.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Ot.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Ot.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Ot.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Ot.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Ot.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Ot.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Ot.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Ot.BYTE;if(e===THREE.ShortType)return Ot.SHORT;if(e===THREE.UnsignedShortType)return Ot.UNSIGNED_SHORT;if(e===THREE.IntType)return Ot.INT;if(e===THREE.UnsignedIntType)return Ot.UNSIGNED_INT;if(e===THREE.FloatType)return Ot.FLOAT;if(e===THREE.AlphaFormat)return Ot.ALPHA;if(e===THREE.RGBFormat)return Ot.RGB;if(e===THREE.RGBAFormat)return Ot.RGBA;if(e===THREE.LuminanceFormat)return Ot.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Ot.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return Ot.FUNC_ADD;if(e===THREE.SubtractEquation)return Ot.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Ot.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Ot.ZERO;if(e===THREE.OneFactor)return Ot.ONE;if(e===THREE.SrcColorFactor)return Ot.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Ot.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Ot.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Ot.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Ot.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Ot.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Ot.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Ot.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Ot.SRC_ALPHA_SATURATE;if(void 0!==jt){if(e===THREE.RGB_S3TC_DXT1_Format)return jt.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return jt.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return jt.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return jt.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function _t(e){if(Di&&e&&e.useVertexTexture)return 1024;var t=Ot.getParameter(Ot.MAX_VERTEX_UNIFORM_VECTORS),i=Math.floor((t-20)/4),r=i;return void 0!==e&&e instanceof THREE.SkinnedMesh&&(r=Math.min(e.bones.length,r),r<e.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")),r}function wt(e){for(var t=0,i=0,r=0,n=0,o=0,a=e.length;a>o;o++){var s=e[o];s.onlyShadow||(s instanceof THREE.DirectionalLight&&t++,s instanceof THREE.PointLight&&i++,s instanceof THREE.SpotLight&&r++,s instanceof THREE.HemisphereLight&&n++)}return{directional:t,point:i,spot:r,hemi:n}}function Ht(e){for(var t=0,i=0,r=e.length;r>i;i++){var n=e[i];n.castShadow&&(n instanceof THREE.SpotLight&&t++,n instanceof THREE.DirectionalLight&&!n.shadowCascade&&t++)}return t}function Mt(){try{if(!(Ot=Ct.getContext("experimental-webgl",{alpha:Dt,premultipliedAlpha:Pt,antialias:Lt,stencil:Ft,preserveDrawingBuffer:Nt})))throw"Error creating WebGL context."}catch(e){console.error(e)}zt=Ot.getExtension("OES_texture_float"),kt=Ot.getExtension("OES_texture_float_linear"),Bt=Ot.getExtension("OES_standard_derivatives"),Vt=Ot.getExtension("EXT_texture_filter_anisotropic")||Ot.getExtension("MOZ_EXT_texture_filter_anisotropic")||Ot.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),jt=Ot.getExtension("WEBGL_compressed_texture_s3tc")||Ot.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Ot.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),zt||console.log("THREE.WebGLRenderer: Float textures not supported."),Bt||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),Vt||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),jt||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===Ot.getShaderPrecisionFormat&&(Ot.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}function St(){Ot.clearColor(0,0,0,1),Ot.clearDepth(1),Ot.clearStencil(0),Ot.enable(Ot.DEPTH_TEST),Ot.depthFunc(Ot.LEQUAL),Ot.frontFace(Ot.CCW),Ot.cullFace(Ot.BACK),Ot.enable(Ot.CULL_FACE),Ot.enable(Ot.BLEND),Ot.blendEquation(Ot.FUNC_ADD),Ot.blendFunc(Ot.SRC_ALPHA,Ot.ONE_MINUS_SRC_ALPHA),Ot.clearColor(It.r,It.g,It.b,Ut)}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var Ct=void 0!==e.canvas?e.canvas:document.createElement("canvas"),At=void 0!==e.precision?e.precision:"highp",Dt=void 0!==e.alpha?e.alpha:!0,Pt=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,Lt=void 0!==e.antialias?e.antialias:!1,Ft=void 0!==e.stencil?e.stencil:!0,Nt=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,It=new THREE.Color(0),Ut=0;void 0!==e.clearColor&&(console.warn("DEPRECATED: clearColor in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),It.setHex(e.clearColor)),void 0!==e.clearAlpha&&(console.warn("DEPRECATED: clearAlpha in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),Ut=e.clearAlpha),this.domElement=Ct,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Ot,zt,kt,Bt,Vt,jt,Gt=this,Wt=[],Xt=0,Yt=null,qt=null,Kt=-1,Zt=null,Qt=null,$t=0,Jt=0,ei=-1,ti=-1,ii=-1,ri=-1,ni=-1,oi=-1,ai=-1,si=-1,li=null,ci=null,hi=null,ui=null,di=0,pi=0,fi=0,mi=0,gi=0,Ei=0,vi={},yi=new THREE.Frustum,Ti=new THREE.Matrix4,xi=new THREE.Matrix4,Ri=new THREE.Vector3,bi=new THREE.Vector3,_i=!0,wi={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};Mt(),St(),this.context=Ot;var Hi=Ot.getParameter(Ot.MAX_TEXTURE_IMAGE_UNITS),Mi=Ot.getParameter(Ot.MAX_VERTEX_TEXTURE_IMAGE_UNITS);Ot.getParameter(Ot.MAX_TEXTURE_SIZE);var Si=Ot.getParameter(Ot.MAX_CUBE_MAP_TEXTURE_SIZE),Ci=Vt?Ot.getParameter(Vt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Ai=Mi>0,Di=Ai&&zt;jt?Ot.getParameter(Ot.COMPRESSED_TEXTURE_FORMATS):[];var Pi=Ot.getShaderPrecisionFormat(Ot.VERTEX_SHADER,Ot.HIGH_FLOAT),Li=Ot.getShaderPrecisionFormat(Ot.VERTEX_SHADER,Ot.MEDIUM_FLOAT);Ot.getShaderPrecisionFormat(Ot.VERTEX_SHADER,Ot.LOW_FLOAT);var Fi=Ot.getShaderPrecisionFormat(Ot.FRAGMENT_SHADER,Ot.HIGH_FLOAT),Ni=Ot.getShaderPrecisionFormat(Ot.FRAGMENT_SHADER,Ot.MEDIUM_FLOAT);Ot.getShaderPrecisionFormat(Ot.FRAGMENT_SHADER,Ot.LOW_FLOAT),Ot.getShaderPrecisionFormat(Ot.VERTEX_SHADER,Ot.HIGH_INT),Ot.getShaderPrecisionFormat(Ot.VERTEX_SHADER,Ot.MEDIUM_INT),Ot.getShaderPrecisionFormat(Ot.VERTEX_SHADER,Ot.LOW_INT),Ot.getShaderPrecisionFormat(Ot.FRAGMENT_SHADER,Ot.HIGH_INT),Ot.getShaderPrecisionFormat(Ot.FRAGMENT_SHADER,Ot.MEDIUM_INT),Ot.getShaderPrecisionFormat(Ot.FRAGMENT_SHADER,Ot.LOW_INT);var Ii=Pi.precision>0&&Fi.precision>0,Ui=Li.precision>0&&Ni.precision>0;"highp"!==At||Ii||(Ui?(At="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(At="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==At||Ui||(At="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Ot},this.supportsVertexTextures=function(){return Ai},this.supportsFloatTextures=function(){return zt},this.supportsStandardDerivatives=function(){return Bt},this.supportsCompressedTextureS3TC=function(){return jt},this.getMaxAnisotropy=function(){return Ci},this.getPrecision=function(){return At},this.setSize=function(e,t,i){Ct.width=e*this.devicePixelRatio,Ct.height=t*this.devicePixelRatio,1!==this.devicePixelRatio&&i!==!1&&(Ct.style.width=e+"px",Ct.style.height=t+"px"),this.setViewport(0,0,Ct.width,Ct.height)},this.setViewport=function(e,t,i,r){di=void 0!==e?e:0,pi=void 0!==t?t:0,fi=void 0!==i?i:Ct.width,mi=void 0!==r?r:Ct.height,Ot.viewport(di,pi,fi,mi)},this.setScissor=function(e,t,i,r){Ot.scissor(e,t,i,r)},this.enableScissorTest=function(e){e?Ot.enable(Ot.SCISSOR_TEST):Ot.disable(Ot.SCISSOR_TEST)},this.setClearColor=function(e,t){It.set(e),Ut=void 0!==t?t:1,Ot.clearColor(It.r,It.g,It.b,Ut)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return It},this.getClearAlpha=function(){return Ut},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=Ot.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=Ot.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=Ot.STENCIL_BUFFER_BIT),Ot.clear(r)},this.clearTarget=function(e,t,i,r){this.setRenderTarget(e),this.clear(t,i,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){Yt=null,ii=-1,ai=-1,si=-1,Zt=-1,Kt=-1,_i=!0,ei=-1,ti=-1,this.shadowMapPlugin.update(e,t)};var Oi=function(e){var t=e.target;t.removeEventListener("dispose",Oi),Vi(t),Gt.info.memory.geometries--},zi=function(e){var t=e.target;t.removeEventListener("dispose",zi),ji(t),Gt.info.memory.textures--},ki=function(e){var t=e.target;t.removeEventListener("dispose",ki),Gi(t),Gt.info.memory.textures--},Bi=function(e){var t=e.target;t.removeEventListener("dispose",Bi),Wi(t)},Vi=function(e){if(e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&Ot.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Ot.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Ot.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Ot.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Ot.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Ot.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Ot.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Ot.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Ot.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Ot.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Ot.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.geometryGroups)for(var t in e.geometryGroups){var i=e.geometryGroups[t];if(void 0!==i.numMorphTargets)for(var r=0,n=i.numMorphTargets;n>r;r++)Ot.deleteBuffer(i.__webglMorphTargetsBuffers[r]);if(void 0!==i.numMorphNormals)for(var r=0,n=i.numMorphNormals;n>r;r++)Ot.deleteBuffer(i.__webglMorphNormalsBuffers[r]);o(i)}o(e)},ji=function(e){if(e.image&&e.image.__webglTextureCube)Ot.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,Ot.deleteTexture(e.__webglTexture)}},Gi=function(e){if(e&&e.__webglTexture)if(Ot.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;6>t;t++)Ot.deleteFramebuffer(e.__webglFramebuffer[t]),Ot.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Ot.deleteFramebuffer(e.__webglFramebuffer),Ot.deleteRenderbuffer(e.__webglRenderbuffer)},Wi=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var i,r,n,o=!1;for(i=0,r=Wt.length;r>i;i++)if(n=Wt[i],n.program===t){n.usedTimes--,0===n.usedTimes&&(o=!0);break}if(o===!0){var a=[];for(i=0,r=Wt.length;r>i;i++)n=Wt[i],n.program!==t&&a.push(n);Wt=a,Ot.deleteProgram(t),Gt.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Ot.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Ot.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Ot.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Ot.createBuffer()),e.hasPositions&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglVertexBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,e.positionArray,Ot.DYNAMIC_DRAW),Ot.enableVertexAttribArray(t.attributes.position),Ot.vertexAttribPointer(t.attributes.position,3,Ot.FLOAT,!1,0,0)),e.hasNormals){if(Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglNormalBuffer),i.shading===THREE.FlatShading){var r,n,o,a,s,l,c,h,u,d,p,f,m,g,E=3*e.count;for(g=0;E>g;g+=9)m=e.normalArray,a=m[g],c=m[g+1],d=m[g+2],s=m[g+3],h=m[g+4],p=m[g+5],l=m[g+6],u=m[g+7],f=m[g+8],r=(a+s+l)/3,n=(c+h+u)/3,o=(d+p+f)/3,m[g]=r,m[g+1]=n,m[g+2]=o,m[g+3]=r,m[g+4]=n,m[g+5]=o,m[g+6]=r,m[g+7]=n,m[g+8]=o}Ot.bufferData(Ot.ARRAY_BUFFER,e.normalArray,Ot.DYNAMIC_DRAW),Ot.enableVertexAttribArray(t.attributes.normal),Ot.vertexAttribPointer(t.attributes.normal,3,Ot.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglUvBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,e.uvArray,Ot.DYNAMIC_DRAW),Ot.enableVertexAttribArray(t.attributes.uv),Ot.vertexAttribPointer(t.attributes.uv,2,Ot.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==THREE.NoColors&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,e.__webglColorBuffer),Ot.bufferData(Ot.ARRAY_BUFFER,e.colorArray,Ot.DYNAMIC_DRAW),Ot.enableVertexAttribArray(t.attributes.color),Ot.vertexAttribPointer(t.attributes.color,3,Ot.FLOAT,!1,0,0)),Ot.drawArrays(Ot.TRIANGLES,0,e.count),e.count=0
},this.renderBufferDirect=function(e,t,i,r,n,o){if(r.visible!==!1){var a,s,l,c,h=j(e,t,i,r,o),u=h.attributes,d=n.attributes,p=!1,f=r.wireframe?1:0,m=16777215*n.id+2*h.id+f;if(m!==Zt&&(Zt=m,p=!0),p&&b(),o instanceof THREE.Mesh){var g=d.index;if(g){var E=n.offsets;E.length>1&&(p=!0);for(var v=0,y=E.length;y>v;v++){var T=E[v].index;if(p){for(s in d)"index"!==s&&(l=u[s],a=d[s],c=a.itemSize,l>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,a.buffer),R(l),Ot.vertexAttribPointer(l,c,Ot.FLOAT,!1,0,4*T*c)));Ot.bindBuffer(Ot.ELEMENT_ARRAY_BUFFER,g.buffer)}Ot.drawElements(Ot.TRIANGLES,E[v].count,Ot.UNSIGNED_SHORT,2*E[v].start),Gt.info.render.calls++,Gt.info.render.vertices+=E[v].count,Gt.info.render.faces+=E[v].count/3}}else{if(p)for(s in d)"index"!==s&&(l=u[s],a=d[s],c=a.itemSize,l>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,a.buffer),R(l),Ot.vertexAttribPointer(l,c,Ot.FLOAT,!1,0,0)));var x=n.attributes.position;Ot.drawArrays(Ot.TRIANGLES,0,x.numItems/3),Gt.info.render.calls++,Gt.info.render.vertices+=x.numItems/3,Gt.info.render.faces+=x.numItems/3/3}}else if(o instanceof THREE.ParticleSystem){if(p){for(s in d)l=u[s],a=d[s],c=a.itemSize,l>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,a.buffer),R(l),Ot.vertexAttribPointer(l,c,Ot.FLOAT,!1,0,0));var x=d.position;Ot.drawArrays(Ot.POINTS,0,x.numItems/3),Gt.info.render.calls++,Gt.info.render.points+=x.numItems/3}}else if(o instanceof THREE.Line&&p){for(s in d)l=u[s],a=d[s],c=a.itemSize,l>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,a.buffer),R(l),Ot.vertexAttribPointer(l,c,Ot.FLOAT,!1,0,0));var _=o.type===THREE.LineStrip?Ot.LINE_STRIP:Ot.LINES;at(r.linewidth);var x=d.position;Ot.drawArrays(_,0,x.numItems/3),Gt.info.render.calls++,Gt.info.render.points+=x.numItems}}},this.renderBuffer=function(e,t,i,r,n,o){if(r.visible!==!1){var a,s,l,c=j(e,t,i,r,o),h=c.attributes,u=!1,d=r.wireframe?1:0,p=16777215*n.id+2*c.id+d;if(p!==Zt&&(Zt=p,u=!0),u&&b(),!r.morphTargets&&h.position>=0?u&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,n.__webglVertexBuffer),R(h.position),Ot.vertexAttribPointer(h.position,3,Ot.FLOAT,!1,0,0)):o.morphTargetBase&&_(r,n,o),u){if(n.__webglCustomAttributesList)for(s=0,l=n.__webglCustomAttributesList.length;l>s;s++)a=n.__webglCustomAttributesList[s],h[a.buffer.belongsToAttribute]>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,a.buffer),R(h[a.buffer.belongsToAttribute]),Ot.vertexAttribPointer(h[a.buffer.belongsToAttribute],a.size,Ot.FLOAT,!1,0,0));h.color>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,n.__webglColorBuffer),R(h.color),Ot.vertexAttribPointer(h.color,3,Ot.FLOAT,!1,0,0)),h.normal>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,n.__webglNormalBuffer),R(h.normal),Ot.vertexAttribPointer(h.normal,3,Ot.FLOAT,!1,0,0)),h.tangent>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,n.__webglTangentBuffer),R(h.tangent),Ot.vertexAttribPointer(h.tangent,4,Ot.FLOAT,!1,0,0)),h.uv>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,n.__webglUVBuffer),R(h.uv),Ot.vertexAttribPointer(h.uv,2,Ot.FLOAT,!1,0,0)),h.uv2>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,n.__webglUV2Buffer),R(h.uv2),Ot.vertexAttribPointer(h.uv2,2,Ot.FLOAT,!1,0,0)),r.skinning&&h.skinIndex>=0&&h.skinWeight>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,n.__webglSkinIndicesBuffer),R(h.skinIndex),Ot.vertexAttribPointer(h.skinIndex,4,Ot.FLOAT,!1,0,0),Ot.bindBuffer(Ot.ARRAY_BUFFER,n.__webglSkinWeightsBuffer),R(h.skinWeight),Ot.vertexAttribPointer(h.skinWeight,4,Ot.FLOAT,!1,0,0)),h.lineDistance>=0&&(Ot.bindBuffer(Ot.ARRAY_BUFFER,n.__webglLineDistanceBuffer),R(h.lineDistance),Ot.vertexAttribPointer(h.lineDistance,1,Ot.FLOAT,!1,0,0))}if(o instanceof THREE.Mesh)r.wireframe?(at(r.wireframeLinewidth),u&&Ot.bindBuffer(Ot.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),Ot.drawElements(Ot.LINES,n.__webglLineCount,Ot.UNSIGNED_SHORT,0)):(u&&Ot.bindBuffer(Ot.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),Ot.drawElements(Ot.TRIANGLES,n.__webglFaceCount,Ot.UNSIGNED_SHORT,0)),Gt.info.render.calls++,Gt.info.render.vertices+=n.__webglFaceCount,Gt.info.render.faces+=n.__webglFaceCount/3;else if(o instanceof THREE.Line){var f=o.type===THREE.LineStrip?Ot.LINE_STRIP:Ot.LINES;at(r.linewidth),Ot.drawArrays(f,0,n.__webglLineCount),Gt.info.render.calls++}else o instanceof THREE.ParticleSystem?(Ot.drawArrays(Ot.POINTS,0,n.__webglParticleCount),Gt.info.render.calls++,Gt.info.render.points+=n.__webglParticleCount):o instanceof THREE.Ribbon&&(Ot.drawArrays(Ot.TRIANGLE_STRIP,0,n.__webglVertexCount),Gt.info.render.calls++)}},this.render=function(e,t,i,r){if(t instanceof THREE.Camera==!1)return console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera."),void 0;var n,o,a,s,l,c=e.__lights,h=e.fog;for(Kt=-1,_i=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),Ti.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),yi.setFromMatrix(Ti),this.autoUpdateObjects&&this.initWebGLObjects(e),M(this.renderPluginsPre,e,t),Gt.info.render.calls=0,Gt.info.render.vertices=0,Gt.info.render.faces=0,Gt.info.render.points=0,this.setRenderTarget(i),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),l=e.__webglObjects,n=0,o=l.length;o>n;n++)a=l[n],s=a.object,a.id=n,a.render=!1,s.visible&&((s instanceof THREE.Mesh||s instanceof THREE.ParticleSystem)&&s.frustumCulled&&!yi.intersectsObject(s)||(it(s,t),D(a),a.render=!0,this.sortObjects===!0&&(null!==s.renderDepth?a.z=s.renderDepth:(Ri.getPositionFromMatrix(s.matrixWorld),Ri.applyProjection(Ti),a.z=Ri.z))));for(this.sortObjects&&l.sort(w),l=e.__webglObjectsImmediate,n=0,o=l.length;o>n;n++)a=l[n],s=a.object,s.visible&&(it(s,t),A(a));if(e.overrideMaterial){var u=e.overrideMaterial;this.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),this.setDepthTest(u.depthTest),this.setDepthWrite(u.depthWrite),st(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits),S(e.__webglObjects,!1,"",t,c,h,!0,u),C(e.__webglObjectsImmediate,"",t,c,h,!1,u)}else{var u=null;this.setBlending(THREE.NoBlending),S(e.__webglObjects,!0,"opaque",t,c,h,!1,u),C(e.__webglObjectsImmediate,"opaque",t,c,h,!1,u),S(e.__webglObjects,!1,"transparent",t,c,h,!0,u),C(e.__webglObjectsImmediate,"transparent",t,c,h,!0,u)}M(this.renderPluginsPost,e,t),i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter&&xt(i),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,i,r,n){var o=j(e,t,i,r,n);Zt=-1,Gt.setMaterialFaces(r),n.immediateRenderCallback?n.immediateRenderCallback(o,Ot,yi):n.render(function(e){Gt.renderBufferImmediate(e,o,r)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)L(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)z(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,i=e.__webglObjects.length;i>t;t++){var r=e.__webglObjects[t].object;void 0===r.__webglInit&&(void 0!==r.__webglActive&&z(r,e),L(r,e)),I(r)}},this.initMaterial=function(e,t,i,r){e.addEventListener("dispose",Bi);var n,o,a,s,l,c,h;e instanceof THREE.MeshDepthMaterial?h="depth":e instanceof THREE.MeshNormalMaterial?h="normal":e instanceof THREE.MeshBasicMaterial?h="basic":e instanceof THREE.MeshLambertMaterial?h="lambert":e instanceof THREE.MeshPhongMaterial?h="phong":e instanceof THREE.LineBasicMaterial?h="basic":e instanceof THREE.LineDashedMaterial?h="dashed":e instanceof THREE.ParticleBasicMaterial&&(h="particle_basic"),h&&V(e,THREE.ShaderLib[h]),s=wt(t),c=Ht(t),l=_t(r),a={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:l,useVertexTexture:Di&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:c,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide},e.program=ct(h,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,a);var u=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var d,p="morphTarget";for(o=0;o<this.maxMorphTargets;o++)d=p+o,u[d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var d,p="morphNormal";for(o=0;o<this.maxMorphNormals;o++)d=p+o,u[d]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(n in e.uniforms)e.uniformsList.push([e.uniforms[n],n])},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?Ot.disable(Ot.CULL_FACE):(t===THREE.FrontFaceDirectionCW?Ot.frontFace(Ot.CW):Ot.frontFace(Ot.CCW),e===THREE.CullFaceBack?Ot.cullFace(Ot.BACK):e===THREE.CullFaceFront?Ot.cullFace(Ot.FRONT):Ot.cullFace(Ot.FRONT_AND_BACK),Ot.enable(Ot.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide,i=e.side===THREE.BackSide;ei!==t&&(t?Ot.disable(Ot.CULL_FACE):Ot.enable(Ot.CULL_FACE),ei=t),ti!==i&&(i?Ot.frontFace(Ot.CW):Ot.frontFace(Ot.CCW),ti=i)},this.setDepthTest=function(e){ai!==e&&(e?Ot.enable(Ot.DEPTH_TEST):Ot.disable(Ot.DEPTH_TEST),ai=e)},this.setDepthWrite=function(e){si!==e&&(Ot.depthMask(e),si=e)},this.setBlending=function(e,t,i,r){e!==ii&&(e===THREE.NoBlending?Ot.disable(Ot.BLEND):e===THREE.AdditiveBlending?(Ot.enable(Ot.BLEND),Ot.blendEquation(Ot.FUNC_ADD),Ot.blendFunc(Ot.SRC_ALPHA,Ot.ONE)):e===THREE.SubtractiveBlending?(Ot.enable(Ot.BLEND),Ot.blendEquation(Ot.FUNC_ADD),Ot.blendFunc(Ot.ZERO,Ot.ONE_MINUS_SRC_COLOR)):e===THREE.MultiplyBlending?(Ot.enable(Ot.BLEND),Ot.blendEquation(Ot.FUNC_ADD),Ot.blendFunc(Ot.ZERO,Ot.SRC_COLOR)):e===THREE.CustomBlending?Ot.enable(Ot.BLEND):(Ot.enable(Ot.BLEND),Ot.blendEquationSeparate(Ot.FUNC_ADD,Ot.FUNC_ADD),Ot.blendFuncSeparate(Ot.SRC_ALPHA,Ot.ONE_MINUS_SRC_ALPHA,Ot.ONE,Ot.ONE_MINUS_SRC_ALPHA)),ii=e),e===THREE.CustomBlending?(t!==ri&&(Ot.blendEquation(bt(t)),ri=t),(i!==ni||r!==oi)&&(Ot.blendFunc(bt(i),bt(r)),ni=i,oi=r)):(ri=null,ni=null,oi=null)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",zi),e.__webglTexture=Ot.createTexture(),Gt.info.memory.textures++),Ot.activeTexture(Ot.TEXTURE0+t),Ot.bindTexture(Ot.TEXTURE_2D,e.__webglTexture),Ot.pixelStorei(Ot.UNPACK_FLIP_Y_WEBGL,e.flipY),Ot.pixelStorei(Ot.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Ot.pixelStorei(Ot.UNPACK_ALIGNMENT,e.unpackAlignment);var i=e.image,r=ft(i.width)&&ft(i.height),n=bt(e.format),o=bt(e.type);mt(Ot.TEXTURE_2D,e,r);var a,s=e.mipmaps;if(e instanceof THREE.DataTexture)if(s.length>0&&r){for(var l=0,c=s.length;c>l;l++)a=s[l],Ot.texImage2D(Ot.TEXTURE_2D,l,n,a.width,a.height,0,n,o,a.data);e.generateMipmaps=!1}else Ot.texImage2D(Ot.TEXTURE_2D,0,n,i.width,i.height,0,n,o,i.data);else if(e instanceof THREE.CompressedTexture)for(var l=0,c=s.length;c>l;l++)a=s[l],Ot.compressedTexImage2D(Ot.TEXTURE_2D,l,n,a.width,a.height,0,a.data);else if(s.length>0&&r){for(var l=0,c=s.length;c>l;l++)a=s[l],Ot.texImage2D(Ot.TEXTURE_2D,l,n,n,o,a);e.generateMipmaps=!1}else Ot.texImage2D(Ot.TEXTURE_2D,0,n,n,o,e.image);e.generateMipmaps&&r&&Ot.generateMipmap(Ot.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Ot.activeTexture(Ot.TEXTURE0+t),Ot.bindTexture(Ot.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",ki),e.__webglTexture=Ot.createTexture(),Gt.info.memory.textures++;var i=ft(e.width)&&ft(e.height),r=bt(e.format),n=bt(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Ot.bindTexture(Ot.TEXTURE_CUBE_MAP,e.__webglTexture),mt(Ot.TEXTURE_CUBE_MAP,e,i);for(var o=0;6>o;o++)e.__webglFramebuffer[o]=Ot.createFramebuffer(),e.__webglRenderbuffer[o]=Ot.createRenderbuffer(),Ot.texImage2D(Ot.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r,e.width,e.height,0,r,n,null),yt(e.__webglFramebuffer[o],e,Ot.TEXTURE_CUBE_MAP_POSITIVE_X+o),Tt(e.__webglRenderbuffer[o],e);i&&Ot.generateMipmap(Ot.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Ot.createFramebuffer(),e.__webglRenderbuffer=e.shareDepthFrom?e.shareDepthFrom.__webglRenderbuffer:Ot.createRenderbuffer(),Ot.bindTexture(Ot.TEXTURE_2D,e.__webglTexture),mt(Ot.TEXTURE_2D,e,i),Ot.texImage2D(Ot.TEXTURE_2D,0,r,e.width,e.height,0,r,n,null),yt(e.__webglFramebuffer,e,Ot.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Ot.framebufferRenderbuffer(Ot.FRAMEBUFFER,Ot.DEPTH_ATTACHMENT,Ot.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Ot.framebufferRenderbuffer(Ot.FRAMEBUFFER,Ot.DEPTH_STENCIL_ATTACHMENT,Ot.RENDERBUFFER,e.__webglRenderbuffer):Tt(e.__webglRenderbuffer,e),i&&Ot.generateMipmap(Ot.TEXTURE_2D);t?Ot.bindTexture(Ot.TEXTURE_CUBE_MAP,null):Ot.bindTexture(Ot.TEXTURE_2D,null),Ot.bindRenderbuffer(Ot.RENDERBUFFER,null),Ot.bindFramebuffer(Ot.FRAMEBUFFER,null)}var a,s,l,c,h;e?(a=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,s=e.width,l=e.height,c=0,h=0):(a=null,s=fi,l=mi,c=di,h=pi),a!==qt&&(Ot.bindFramebuffer(Ot.FRAMEBUFFER,a),Ot.viewport(c,h,s,l),qt=a),gi=s,Ei=l},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)};