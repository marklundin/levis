THREE.JSONLoader=function(e){THREE.Loader.call(this,e);this.withCredentials=!1};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.load=function(e,t,i){i=i&&"string"==typeof i?i:this.extractUrlBase(e);this.onLoadStart();this.loadAjaxJSON(this,e,t,i)};THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,r,a){var o=new XMLHttpRequest;var n=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText);var l=e.parse(s,r);i(l.geometry,l.materials)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+o.status+"]");else if(o.readyState===o.LOADING){if(a){if(0===n)n=o.getResponseHeader("Content-Length");a({total:n,loaded:o.responseText.length})}}else if(o.readyState===o.HEADERS_RECEIVED)if(void 0!==a)n=o.getResponseHeader("Content-Length")};o.open("GET",t,!0);o.withCredentials=this.withCredentials;o.send(null)};THREE.JSONLoader.prototype.parse=function(e,t){function i(t){function i(e,t){return e&1<<t}var r,a,n,s,l,c,h,u,f,d,p,m,v,g,E,y,T,x,b,_,R,w,H,S,M,C,A,D=e.faces,P=e.vertices,L=e.normals,N=e.colors,F=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)if(e.uvs[r].length)F++;for(r=0;F>r;r++){o.faceUvs[r]=[];o.faceVertexUvs[r]=[]}}s=0;l=P.length;for(;l>s;){_=new THREE.Vector3;_.x=P[s++]*t;_.y=P[s++]*t;_.z=P[s++]*t;o.vertices.push(_)}s=0;l=D.length;for(;l>s;){p=D[s++];m=i(p,0);v=i(p,1);g=i(p,2);E=i(p,3);y=i(p,4);T=i(p,5);x=i(p,6);b=i(p,7);if(m){R=new THREE.Face4;R.a=D[s++];R.b=D[s++];R.c=D[s++];R.d=D[s++];c=4}else{R=new THREE.Face3;R.a=D[s++];R.b=D[s++];R.c=D[s++];c=3}if(v){d=D[s++];R.materialIndex=d}n=o.faces.length;if(g)for(r=0;F>r;r++){S=e.uvs[r];f=D[s++];C=S[2*f];A=S[2*f+1];o.faceUvs[r][n]=new THREE.Vector2(C,A)}if(E)for(r=0;F>r;r++){S=e.uvs[r];M=[];for(a=0;c>a;a++){f=D[s++];C=S[2*f];A=S[2*f+1];M[a]=new THREE.Vector2(C,A)}o.faceVertexUvs[r][n]=M}if(y){u=3*D[s++];H=new THREE.Vector3;H.x=L[u++];H.y=L[u++];H.z=L[u];R.normal=H}if(T)for(r=0;c>r;r++){u=3*D[s++];H=new THREE.Vector3;H.x=L[u++];H.y=L[u++];H.z=L[u];R.vertexNormals.push(H)}if(x){h=D[s++];w=new THREE.Color(N[h]);R.color=w}if(b)for(r=0;c>r;r++){h=D[s++];w=new THREE.Color(N[h]);R.vertexColors.push(w)}o.faces.push(R)}}function r(){var t,i,r,a,n,s,l,c,h,u;if(e.skinWeights)for(t=0,i=e.skinWeights.length;i>t;t+=2){r=e.skinWeights[t];a=e.skinWeights[t+1];n=0;s=0;o.skinWeights.push(new THREE.Vector4(r,a,n,s))}if(e.skinIndices)for(t=0,i=e.skinIndices.length;i>t;t+=2){l=e.skinIndices[t];c=e.skinIndices[t+1];h=0;u=0;o.skinIndices.push(new THREE.Vector4(l,c,h,u))}o.bones=e.bones;o.animation=e.animation}function a(t){if(void 0!==e.morphTargets){var i,r,a,n,s,l;for(i=0,r=e.morphTargets.length;r>i;i++){o.morphTargets[i]={};o.morphTargets[i].name=e.morphTargets[i].name;o.morphTargets[i].vertices=[];s=o.morphTargets[i].vertices;l=e.morphTargets[i].vertices;for(a=0,n=l.length;n>a;a+=3){var c=new THREE.Vector3;c.x=l[a]*t;c.y=l[a+1]*t;c.z=l[a+2]*t;s.push(c)}}}if(void 0!==e.morphColors){var i,r,h,u,f,d,p;for(i=0,r=e.morphColors.length;r>i;i++){o.morphColors[i]={};o.morphColors[i].name=e.morphColors[i].name;o.morphColors[i].colors=[];f=o.morphColors[i].colors;d=e.morphColors[i].colors;for(h=0,u=d.length;u>h;h+=3){p=new THREE.Color(16755200);p.setRGB(d[h],d[h+1],d[h+2]);f.push(p)}}}}var o=new THREE.Geometry,n=void 0!==e.scale?1/e.scale:1;i(n);r();a(n);o.computeCentroids();o.computeFaceNormals();o.computeBoundingSphere();if(void 0===e.materials)return{geometry:o};else{var s=this.initMaterials(e.materials,t);if(this.needsTangents(s))o.computeTangents();return{geometry:o,materials:s}}};